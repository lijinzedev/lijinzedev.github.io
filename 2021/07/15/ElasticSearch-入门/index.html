<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>ElasticSearch 入门 | Curiosity的博客</title><meta name="keywords" content="中间件,elk"><meta name="author" content="Curiosity"><meta name="copyright" content="Curiosity"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="环境:  树莓派4b ubuntu 20 es 7.13.2   一 ElasticSearch  什么是Elasticsearch? 官网  Elasticsearch 是一个分布式的开源搜索和分析引擎，适用于所有类型的数据，包括文本、数字、地理空间、结构化和非结构化数据。Elasticsearch 在 Apache Lucene 的基础上开发而成，由 Elasticsearch N.V.（即现">
<meta property="og:type" content="article">
<meta property="og:title" content="ElasticSearch 入门">
<meta property="og:url" content="https://lijinzedev.github.io/2021/07/15/ElasticSearch-%E5%85%A5%E9%97%A8/index.html">
<meta property="og:site_name" content="Curiosity的博客">
<meta property="og:description" content="环境:  树莓派4b ubuntu 20 es 7.13.2   一 ElasticSearch  什么是Elasticsearch? 官网  Elasticsearch 是一个分布式的开源搜索和分析引擎，适用于所有类型的数据，包括文本、数字、地理空间、结构化和非结构化数据。Elasticsearch 在 Apache Lucene 的基础上开发而成，由 Elasticsearch N.V.（即现">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://user-images.githubusercontent.com/41108332/105622748-e2c5b580-5e4e-11eb-95c9-b22cdfdd632b.png">
<meta property="article:published_time" content="2021-07-15T21:03:54.000Z">
<meta property="article:modified_time" content="2024-07-19T06:03:08.429Z">
<meta property="article:author" content="Curiosity">
<meta property="article:tag" content="中间件">
<meta property="article:tag" content="elk">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://user-images.githubusercontent.com/41108332/105622748-e2c5b580-5e4e-11eb-95c9-b22cdfdd632b.png"><link rel="shortcut icon" href="https://user-images.githubusercontent.com/41108332/105622748-e2c5b580-5e4e-11eb-95c9-b22cdfdd632b.png"><link rel="canonical" href="https://lijinzedev.github.io/2021/07/15/ElasticSearch-%E5%85%A5%E9%97%A8/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'mediumZoom',
  Snackbar: undefined,
  source: {
    jQuery: 'https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js',
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/js/jquery.justifiedGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/css/justifiedGallery.min.css'
    },
    fancybox: {
      js: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js',
      css: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: true,
  isanchor: false
};

const saveToLocal = {
  // ttl 單位是 天
  set: function setWithExpiry(key, value, ttl) {
    if (ttl === 0) return
    const now = new Date()
    const expiryDay = ttl * 86400000
    const item = {
      value: value,
      expiry: now.getTime() + expiryDay,
    }
    localStorage.setItem(key, JSON.stringify(item))
  },

  get: function getWithExpiry(key) {
    const itemStr = localStorage.getItem(key)

    if (!itemStr) {
      return undefined
    }
    const item = JSON.parse(itemStr)
    const now = new Date()

    if (now.getTime() > item.expiry) {
      localStorage.removeItem(key)
      return undefined
    }
    return item.value
  }
}

// https://stackoverflow.com/questions/16839698/jquery-getscript-alternative-in-native-javascript
const getScript = url => new Promise((resolve, reject) => {
  const script = document.createElement('script')
  script.src = url
  script.async = true
  script.onerror = reject
  script.onload = script.onreadystatechange = function() {
    const loadState = this.readyState
    if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
    script.onload = script.onreadystatechange = null
    resolve()
  }
  document.head.appendChild(script)
})</script><script id="config_change">var GLOBAL_CONFIG_SITE = { 
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2024-07-19 06:03:08'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(function () {  window.activateDarkMode = function () {
    document.documentElement.setAttribute('data-theme', 'dark')
    if (document.querySelector('meta[name="theme-color"]') !== null) {
      document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
    }
  }
  window.activateLightMode = function () {
    document.documentElement.setAttribute('data-theme', 'light')
   if (document.querySelector('meta[name="theme-color"]') !== null) {
      document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
    }
  }
  const autoChangeMode = 'false'
  const t = saveToLocal.get('theme')
  if (autoChangeMode === '1') {
    const isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
    const isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
    const isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
    const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified
    if (t === undefined) {
      if (isLightMode) activateLightMode()
      else if (isDarkMode) activateDarkMode()
      else if (isNotSpecified || hasNoSupport) {
        const now = new Date()
        const hour = now.getHours()
        const isNight = hour <= 6 || hour >= 18
        isNight ? activateDarkMode() : activateLightMode()
      }
      window.matchMedia('(prefers-color-scheme: dark)').addListener(function (e) {
        if (saveToLocal.get('theme') === undefined) {
          e.matches ? activateDarkMode() : activateLightMode()
        }
      })
    } else if (t === 'light') activateLightMode()
    else activateDarkMode()
  } else if (autoChangeMode === '2') {
    const now = new Date()
    const hour = now.getHours()
    const isNight = hour <= 6 || hour >= 18
    if (t === undefined) isNight ? activateDarkMode() : activateLightMode()
    else if (t === 'light') activateLightMode()
    else activateDarkMode()
  } else {
    if (t === 'dark') activateDarkMode()
    else if (t === 'light') activateLightMode()
  }const asideStatus = saveToLocal.get('aside-status')
if (asideStatus !== undefined) {
   if (asideStatus === 'hide') {
     document.documentElement.classList.add('hide-aside')
   } else {
     document.documentElement.classList.remove('hide-aside')
   }
}})()</script><meta name="generator" content="Hexo 5.4.2"><link rel="stylesheet" href="/css/prism.css" type="text/css"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="author-avatar"><img class="avatar-img" data-lazy-src="https://user-images.githubusercontent.com/41108332/105622748-e2c5b580-5e4e-11eb-95c9-b22cdfdd632b.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data"><div class="data-item is-center"><div class="data-item-link"><a href="/archives/"><div class="headline">文章</div><div class="length-num">155</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/tags/"><div class="headline">标签</div><div class="length-num">83</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/categories/"><div class="headline">分类</div><div class="length-num">112</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> 关于</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">Curiosity的博客</a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> 关于</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">ElasticSearch 入门</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2021-07-15T21:03:54.000Z" title="发表于 2021-07-15 21:03:54">2021-07-15</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2024-07-19T06:03:08.429Z" title="更新于 2024-07-19 06:03:08">2024-07-19</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E4%B8%AD%E9%97%B4%E4%BB%B6/">中间件</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E4%B8%AD%E9%97%B4%E4%BB%B6/elk/">elk</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><p>环境:</p>
<ul>
<li>树莓派4b ubuntu 20</li>
<li>es 7.13.2</li>
</ul>
<h1 id="一-elasticsearch"><a class="markdownIt-Anchor" href="#一-elasticsearch"></a> 一 ElasticSearch</h1>
<h3 id="什么是elasticsearch"><a class="markdownIt-Anchor" href="#什么是elasticsearch"></a> 什么是Elasticsearch?</h3>
<p><a target="_blank" rel="noopener" href="https://link.segmentfault.com/?url=https%3A%2F%2Fwww.elastic.co%2Fcn%2Fwhat-is%2Felasticsearch">官网</a></p>
<blockquote>
<p>Elasticsearch 是一个分布式的开源搜索和分析引擎，适用于所有类型的数据，包括文本、数字、地理空间、结构化和非结构化数据。Elasticsearch 在 Apache Lucene 的基础上开发而成，由 Elasticsearch N.V.（即现在的 Elastic）于 2010 年首次发布。Elasticsearch 以其简单的 REST 风格 API、分布式特性、速度和可扩展性而闻名，是 Elastic Stack 的核心组件；Elastic Stack 是适用于数据采集、充实、存储、分析和可视化的一组开源工具。人们通常将 Elastic Stack 称为 ELK Stack（代指 Elasticsearch、Logstash 和 Kibana），目前 Elastic Stack 包括一系列丰富的轻量型数据采集代理，这些代理统称为 Beats，可用来向 Elasticsearch 发送数据</p>
</blockquote>
<p>着重功能就是用来做<strong>数据的检索和分析</strong></p>
<ul>
<li><strong>应用程序搜索</strong></li>
<li>网站搜索</li>
<li>企业搜索</li>
<li><strong>日志处理和分析</strong></li>
<li>基础设施<strong>指标和容器监测</strong></li>
<li>应用程序性能监测</li>
<li>地理空间<strong>数据分析和可视化</strong></li>
<li>安全分析</li>
<li>业务分析</li>
</ul>
<h3 id="mysql也能实现elasticsearch的功能-为什么还需要elasticsearch"><a class="markdownIt-Anchor" href="#mysql也能实现elasticsearch的功能-为什么还需要elasticsearch"></a> mysql也能实现Elasticsearch的功能 为什么还需要Elasticsearch</h3>
<p>mysql当然也能实现数据的搜索和分析 例如求年龄的平均值 avg 分组group by 等等 但是我们说术业有专攻，</p>
<p>而mysql专攻于持久化的存储与管理 ，也就是crud 。如果真的使用mysql做海量数据的检索和分析，Elasticsearch更在行，能在秒级给我们响应我们感兴趣的数据，而mysql单表达到百万数据，我们需要进行一些检索和查询都是一些比较慢的操作，比较浪费性能。例如在一些电商系统里面，需要对商品的不同属性按照不同的关键字来检索商品，我们如果用mysql来做，mysql肯定承受不了那么大的压力，而Elasticsearch可以帮我们做到这些。</p>
<h3 id="了解elk"><a class="markdownIt-Anchor" href="#了解elk"></a> 了解ELK</h3>
<p>ELK是Elasticsearch、Logstash、Kibana三大开源框架首字母大写简称。市面上也被成为Elastit Stack。其中Elasticsearch是一个基于Lucene、分布式、通过Restful方式进行交互的近实时搜索平台框架。像类似百度、谷歌这种大数据全文搜索引擎的场景都可以使用Elasticsearch作为底层支持框架，可见Elasticsearch提供的搜索能力确实强大,市面上很多时候我们简称Elasticsearch为es。Logstash是ELK的中央数据流引擎，用于从不同目标（文件/数据存储/MQ）收集的不同格式数据，经过过滤后支持输出到不同目的地(文件/MQ/redis/elasticsearch/kafka等 )。Kibana可以将elasticsearch的数据通过友好的页面展示出来，提供实时分析的功能.</p>
<p>市面上很多开发只要提到ELK能够一致说出它是一个日志分析架构技术栈总称，但实际上ELK不仅仅适用于日志分析，它还可以支持其它任何数据分析和收集的场景，日志分析和收集只是更具有代表性。并非唯一性。</p>
<p><img src= "/img/loading.gif" data-lazy-src="https://raw.githubusercontent.com/lijinzedev/picture/main/img20210715231735.png" alt="image-20210202103726630"></p>
<h2 id="1-环境搭建"><a class="markdownIt-Anchor" href="#1-环境搭建"></a> 1 环境搭建</h2>
<h3 id="1-编写docker-compose文件"><a class="markdownIt-Anchor" href="#1-编写docker-compose文件"></a> 1 编写docker-compose文件</h3>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">&#x27;3&#x27;</span></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">elasticsearch:</span></span><br><span class="line">    <span class="attr">image:</span>  <span class="string">arm64v8/elasticsearch:7.13.2</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">es</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/home/docker/elasticsearch/data:/usr/share/elasticsearch/data:rw</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/home/docker/elasticsearch/conf/elasticsearch.yml:/usr/share/elasticsearch/config/elasticsearch.yml</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/home/docker/elasticsearch/logs:/user/share/elasticsearch/logs:rw</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/home/docker/elasticsearch/plugins:/usr/share/elasticsearch/plugins</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">&quot;9200:9200&quot;</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">&quot;9300:9300&quot;</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">discovery.type=single-node</span></span><br><span class="line">  <span class="attr">es-head:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">aichenk/elasticsearch-head:5-alpine</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">es-head</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;9100:9100&quot;</span></span><br><span class="line">  <span class="attr">kibana:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">arm64v8/kibana:7.13.2</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">kibana</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">ELASTICSEARCH_URL=http://elasticsearch:9200</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;5601:5601&quot;</span></span><br><span class="line">    <span class="attr">depends_on:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">elasticsearch</span></span><br><span class="line"> </span><br></pre></td></tr></table></figure>
<ul>
<li>
<p><strong>注意</strong>：宿主机的目录需要赋权，否则启动会报 <strong>failed to bind service AccessDeniedException</strong> 错误</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">chmod</span> /home/docker/elasticsearch/data</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="2-编写elasticsearchyml文件"><a class="markdownIt-Anchor" href="#2-编写elasticsearchyml文件"></a> 2 编写elasticsearch.yml文件</h3>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">bootstrap.memory_lock:</span> <span class="literal">false</span></span><br><span class="line"><span class="attr">cluster.name:</span> <span class="string">&quot;es-server&quot;</span></span><br><span class="line"><span class="attr">node.name:</span> <span class="string">node-1</span></span><br><span class="line"><span class="attr">node.master:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">node.data:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">network.host:</span> <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span></span><br><span class="line"><span class="attr">http.port:</span> <span class="number">9200</span></span><br><span class="line"><span class="attr">path.logs:</span> <span class="string">/usr/share/elasticsearch/logs</span></span><br><span class="line"><span class="attr">http.cors.enabled:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">http.cors.allow-origin:</span> <span class="string">&quot;*&quot;</span></span><br><span class="line"><span class="attr">xpack.security.audit.enabled:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure>
<h3 id="3-汉化kibana"><a class="markdownIt-Anchor" href="#3-汉化kibana"></a> 3 汉化kibana</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看目录下是否又中文json</span></span><br><span class="line"><span class="built_in">ls</span> /usr/share/kibana/x-pack/plugins/translations/translations</span><br><span class="line"><span class="comment"># 更改配置文件</span></span><br><span class="line"><span class="built_in">cd</span> /usr/share/kibana/config</span><br><span class="line">vi kibana.yml</span><br><span class="line">添加i18n.locale: <span class="string">&quot;zh-CN&quot;</span></span><br><span class="line"><span class="comment"># 重启容器</span></span><br><span class="line">docker-compose restart kibana</span><br></pre></td></tr></table></figure>
<h1 id="elasticsearch安装"><a class="markdownIt-Anchor" href="#elasticsearch安装"></a> ElasticSearch安装</h1>
<p>下载地址:<a target="_blank" rel="noopener" href="https://www.elastic.co/cn/downloads/elasticsearch">https://www.elastic.co/cn/downloads/elasticsearch</a></p>
<blockquote>
<p>Windows 下安装</p>
</blockquote>
<ol>
<li>解压</li>
</ol>
<p><img src= "/img/loading.gif" data-lazy-src="https://raw.githubusercontent.com/lijinzedev/picture/main/img20210715231645.png" alt="image-20210202093348097"></p>
<ol>
<li>
<p>熟悉目录</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">bin 启动文件</span><br><span class="line">config 配置文件</span><br><span class="line">	log4j 日志配置文件</span><br><span class="line">	jvm.options java虚拟机相关的配置</span><br><span class="line">	ElasticSearch.yml ElasticSearch的配置文件 默认9200端口</span><br><span class="line">lib 相关jar包</span><br><span class="line">logs 日志</span><br><span class="line">modules 功能模块</span><br><span class="line">plugins 插件</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h1 id="二-核心概念"><a class="markdownIt-Anchor" href="#二-核心概念"></a> 二  核心概念</h1>
<blockquote>
<p>ElasticSearch是面向文档的,关系型数据库</p>
</blockquote>
<table>
<thead>
<tr>
<th>DB</th>
<th>ElastciSearch</th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td>数据库(datebase)</td>
<td>索引(indices)</td>
<td></td>
</tr>
<tr>
<td>表(tables)</td>
<td>types</td>
<td>逐渐弃用</td>
</tr>
<tr>
<td>行(row)</td>
<td>documents</td>
<td></td>
</tr>
<tr>
<td>字段(columns)</td>
<td>fields</td>
<td></td>
</tr>
</tbody>
</table>
<blockquote>
<p>elasticesarch 中可以包含多个索引数据库.每个索引中可以包含多个类型(表)每个类型下又包含多个文档(行),每个文档又包含多个字段(列)</p>
</blockquote>
<p><strong>物理设计:</strong></p>
<blockquote>
<p>elasticsearch 在后台把每个索引划分成多个分片,每分片可以在集群中不同的服务器之间迁移</p>
</blockquote>
<p><strong>逻辑设计:</strong></p>
<p>一个索引类型中，包含多个文档，比如说文档1，文档2。当我们索引一篇文档时，可以通过这样的一各顺序找到它:索引》类型文档ID，通过这个组合我们就能索引到某个具体的文档。注意:ID不必是整数，实际上它是个字符串</p>
<blockquote>
<p>文档</p>
</blockquote>
<p>即为一条条数据</p>
<p>之前说elasticsearch是面向文档的，那么就意味着索引和搜索数据的最小单位是文档，elasticsearch中，文档有几个重要属性︰</p>
<ul>
<li>自我包含，一篇文档同时包含字段和对应的值，也就是同时包含key:value !</li>
<li>可以是层次型的，一个文档中包含自文档，复杂的逻辑实体就是这么来的!</li>
<li>灵活的结构，文档不依赖预先定义的模式，我们知道关系型数据库中，要提前定义字段才能使用，在elasticsearch中，对于字段是非常灵活的，有时候，我们可以忽略该字段，或者动态的添加一个新的字段。</li>
</ul>
<p>尽管我们可以随意的新增或者忽略某个字段，但是，每个字段的类型非常重要，比如一个年龄字段类型，可以是字符串也可以是整形。因为elasticsearch会保存字段和类型之间的映射及其他的设置。这种映射具体到每个映射的每种类型，这也是为什么在elasticsearch中，类型有时候也称为映射类型。</p>
<blockquote>
<p>类型</p>
</blockquote>
<p>类型是文档的逻辑容器，就像关系型数据库一样，表格是行的容器。类型中对于字段的定义称为映射，比如name映射为字符串类型。我们说文档是无模式的，它们不需要拥有映射中所定义的所有字段，比如新增一个字段，那么elasticsearch是怎么做的呢?elasticsearch会自动的将新字段加入映射，但是这个字段的不确定它是什么类型，elasticsearch就开始猜，如果这个值是18，那么elasticsearch会认为它是整形。但是elasticsearch也可能猜不对，所以最安全的方式就是提前定义好所需要的映射，这点跟关系型数据库殊途同归了，先定义好字段，然后再使用，别整什么幺蛾子。</p>
<blockquote>
<p>索引</p>
</blockquote>
<p>就是数据库</p>
<p>索引是映射类型的容器，elasticsearch中的索引是一个非常大的文档集合。索引存储了映射类型的字段和其他设置。然后它们被存储到了各个分片上了。我们来研究下分片是如何工作的。</p>
<p><strong>物理设计︰节点和分片如何工作</strong></p>
<p><img src= "/img/loading.gif" data-lazy-src="https://raw.githubusercontent.com/lijinzedev/picture/main/img20210715232747.png" alt="image-20210202134028863"></p>
<p>一个集群至少有一个节点，而一个节点就是一个elasricsearch进程，节点可以有多个索引默认的，如果你创建索引，那么索引将会有个5个分片( primary shard ,又称主分片)构成的，每一个主分片会有一个副本( replica shard ,又称复制分片)</p>
<p><img src= "/img/loading.gif" data-lazy-src="https://raw.githubusercontent.com/lijinzedev/picture/main/img20210715232744.png" alt="image-20210202134053761"></p>
<p>上图是一个有3个节点的集群，可以看到主分片和对应的复制分片都不会在同一个节点内，这样有利于某个节点挂掉了，数据也不至于丢失。实际上，一个分片是一个Lucene索引，一个包含倒排索引的文件目录，倒排索引的结构使得elasticsearch在不扫描全部文档的情况下，就能告诉你哪些文档包含特定的关键字。不过，等等，倒排索引是什么鬼?</p>
<blockquote>
<p>倒排索引</p>
</blockquote>
<p>elasticsearch使用的是一种称为倒排索引的结构，采用Lucene倒排索作为底层。这种结构适用于快速的全文搜索，一个索引文档中所有不重复的列表构成，对于每一个词，都有一个包含它的文档列表。例如，现在有两个文档，每个文档包含如下内容∶</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Study every day,good good up to forever <span class="comment"># 文档1包含的内容</span></span><br><span class="line">To forever, study every day, good good up <span class="comment"># 文档2包含的内容</span></span><br></pre></td></tr></table></figure>
<p>为了创建倒排索引，我们首先要将每个文档拆分成独立的词(或称为词条或者tokens)，然后创建一个包含所有不重复的词条的排序列表，然后列出每个词条出现在哪个文档:</p>
<p><img src= "/img/loading.gif" data-lazy-src="https://raw.githubusercontent.com/lijinzedev/picture/main/img20210715232730.png" alt="image-20210202134510063"></p>
<p>现在，我们试图搜索to forever，只需要查看包含每个词条的文档</p>
<p><img src= "/img/loading.gif" data-lazy-src="https://raw.githubusercontent.com/lijinzedev/picture/main/img20210715232727.png" alt="image-20210202134535705"></p>
<p>两个文档都匹配，但是第一个文档比第二个匹配程度更高。如果没有别的条件，现在，这两个包含关键字的文档都将返回。再来看一个示例，比如我们通过博客标签来搜索博客文章。那么倒排索引列表就是这样的一个结构:</p>
<p><img src= "/img/loading.gif" data-lazy-src="https://raw.githubusercontent.com/lijinzedev/picture/main/img20210715232724.png" alt="image-20210202134608841"></p>
<p>如果要搜索含有python标签的文章，那相对于查找所有原始数据而言，查找倒排索引后的数据将会快的多。只需要查看标签这一栏，然后获取相关的文章ID即可。完全过滤掉无关的所有数据，提高效率!</p>
<p>elasticsearch的索引和Lucene的索引对比</p>
<p>在elasticsearch中，索引（库)这个词被频繁使用，这就是术语的使用。在elasticsearch中，索引被分为多个分片，每份分片是一个Lucene的索引。所以一个elasticsearch索引是由多个Lucene索引组成的。别问为什么，谁让elasticsearch使用Lucene作为底层呢!如无特指，说起索引都是指elasticsearch的索引。</p>
<h2 id="1-elasticsearch相关的数据类型"><a class="markdownIt-Anchor" href="#1-elasticsearch相关的数据类型"></a> 1 ElasticSearch相关的数据类型</h2>
<ul>
<li>字符串类型：text、keyword</li>
<li>数值类型：long、integer、short、byte、doule、float、half float、scaled float</li>
<li>日期类型：date</li>
<li>布尔值类型：boolean</li>
<li>二进制类型：binary</li>
<li>等等…</li>
</ul>
<h1 id="三-ik分词器"><a class="markdownIt-Anchor" href="#三-ik分词器"></a> 三 IK分词器</h1>
<p>分词：即把一段中文或者别的划分成一个个的关键字，我们在搜索时候会把自己的信息进行分词，会把数据库中或者索引库中的数据进行分词，然后进行一个匹配操作，默认的中文分词是将每个字看成一个词，这显然是不符合要求的，所以我们需要安装中文分词器IK来解决这个问题。</p>
<p><strong>使用中文，建议使用IK分词器！</strong></p>
<h2 id="1-安装"><a class="markdownIt-Anchor" href="#1-安装"></a> 1 <a target="_blank" rel="noopener" href="https://github.com/medcl/elasticsearch-analysis-ik">安装</a></h2>
<p>download or compile</p>
<ul>
<li>
<p>optional 1 - download pre-build package from here: <a target="_blank" rel="noopener" href="https://github.com/medcl/elasticsearch-analysis-ik/releases">https://github.com/medcl/elasticsearch-analysis-ik/releases</a></p>
<p>create plugin folder <code>cd your-es-root/plugins/ &amp;&amp; mkdir ik</code></p>
<p>unzip plugin to folder <code>your-es-root/plugins/ik</code></p>
</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看插件</span></span><br><span class="line">docker <span class="built_in">exec</span> elasticsearch elasticsearch-plugin list</span><br></pre></td></tr></table></figure>
<h2 id="2-测试"><a class="markdownIt-Anchor" href="#2-测试"></a> 2 测试</h2>
<ul>
<li>ik_smart 最少切分</li>
</ul>
<p><img src= "/img/loading.gif" data-lazy-src="https://raw.githubusercontent.com/lijinzedev/picture/main/img20210717005958.png" alt="image-20210717005956619"></p>
<ul>
<li>ik_max_word为最细粒度划分，字典！穷尽所有可能</li>
</ul>
<p><img src= "/img/loading.gif" data-lazy-src="https://raw.githubusercontent.com/lijinzedev/picture/main/img20210717010025.png" alt="image-20210717010023634"></p>
<h2 id="3-ik分词器增加自己的配置保存后需要重启"><a class="markdownIt-Anchor" href="#3-ik分词器增加自己的配置保存后需要重启"></a> 3 IK分词器增加自己的配置（保存后，需要重启）</h2>
<blockquote>
<p>IKAnalyzer.cfg.xml<code>can be located at</code>{conf}/analysis-ik/config/IKAnalyzer.cfg.xml<code>or</code>{plugins}/elasticsearch-analysis-ik-*/config/IKAnalyzer.cfg.xml</p>
</blockquote>
<p>在ik的config目录下添加新的字典文件</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">properties</span> <span class="keyword">SYSTEM</span> <span class="string">&quot;http://java.sun.com/dtd/properties.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">comment</span>&gt;</span>IK Analyzer 扩展配置<span class="tag">&lt;/<span class="name">comment</span>&gt;</span></span><br><span class="line">	<span class="comment">&lt;!--用户可以在这里配置自己的扩展字典 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">entry</span> <span class="attr">key</span>=<span class="string">&quot;ext_dict&quot;</span>&gt;</span>custom/mydict.dic;custom/single_word_low_freq.dic<span class="tag">&lt;/<span class="name">entry</span>&gt;</span></span><br><span class="line">	 <span class="comment">&lt;!--用户可以在这里配置自己的扩展停止词字典--&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">entry</span> <span class="attr">key</span>=<span class="string">&quot;ext_stopwords&quot;</span>&gt;</span>custom/ext_stopword.dic<span class="tag">&lt;/<span class="name">entry</span>&gt;</span></span><br><span class="line"> 	<span class="comment">&lt;!--用户可以在这里配置远程扩展字典 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">entry</span> <span class="attr">key</span>=<span class="string">&quot;remote_ext_dict&quot;</span>&gt;</span>location<span class="tag">&lt;/<span class="name">entry</span>&gt;</span></span><br><span class="line"> 	<span class="comment">&lt;!--用户可以在这里配置远程扩展停止词字典--&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">entry</span> <span class="attr">key</span>=<span class="string">&quot;remote_ext_stopwords&quot;</span>&gt;</span>http://xxx.com/xxx.dic<span class="tag">&lt;/<span class="name">entry</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h1 id="四-基础操作"><a class="markdownIt-Anchor" href="#四-基础操作"></a> 四 基础操作</h1>
<p>基本Rest风格命令说明</p>
<table>
<thead>
<tr>
<th>method</th>
<th>url地址</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>PUT</td>
<td>127.0.0.1:9200/索引名称/类型名称/文档id</td>
<td>创建文档（指定id）</td>
</tr>
<tr>
<td>POST</td>
<td>127.0.0.1:9200/索引名称/类型名称</td>
<td>创建文档(随机文档ID)</td>
</tr>
<tr>
<td>POST</td>
<td>127.0.0.1:9200/索引名称/类型名称/文档id/_update</td>
<td>修改文档</td>
</tr>
<tr>
<td>DELETE</td>
<td>127.0.01:9200/索引名称/类型名称/文档id</td>
<td>删除文档</td>
</tr>
<tr>
<td>GET</td>
<td>127.0.01:9200/索引名称/类型名称/文档id</td>
<td>查询文档通过ID</td>
</tr>
<tr>
<td>POST</td>
<td>127.0.0.1:9200/索引名称/类型名称/_search</td>
<td>查询所有数据</td>
</tr>
</tbody>
</table>
<h2 id="1-基础测试"><a class="markdownIt-Anchor" href="#1-基础测试"></a> 1 基础测试</h2>
<h3 id="1-创建索引"><a class="markdownIt-Anchor" href="#1-创建索引"></a> 1 创建索引</h3>
<blockquote>
<p>PUT /索引名/[文档名]/ID {请求体}</p>
</blockquote>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable constant_">PUT</span> /test/type1/<span class="number">1</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;name&quot;</span><span class="symbol">:<span class="string">&quot;jack&quot;</span></span>,</span><br><span class="line">  <span class="string">&quot;age&quot;</span><span class="symbol">:<span class="string">&quot;18&quot;</span></span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src= "/img/loading.gif" data-lazy-src="https://raw.githubusercontent.com/lijinzedev/picture/main/img20210717120116.png" alt="image-20210717120114392"></p>
<h3 id="2-添加字段类型"><a class="markdownIt-Anchor" href="#2-添加字段类型"></a> 2 添加字段类型</h3>
<blockquote>
<p>类似于mysql建表</p>
</blockquote>
<p><a target="_blank" rel="noopener" href="https://www.elastic.co/guide/en/elasticsearch/reference/current/keyword.html">官网教程</a></p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable constant_">PUT</span> my-index-<span class="number">000001</span></span><br><span class="line"> </span><br><span class="line">  <span class="string">&quot;mappings&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;properties&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;name&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;type&quot;</span>:  <span class="string">&quot;text&quot;</span></span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="string">&quot;age&quot;</span><span class="symbol">:</span>&#123;</span><br><span class="line">        <span class="string">&quot;type&quot;</span><span class="symbol">:<span class="string">&quot;long&quot;</span></span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src= "/img/loading.gif" data-lazy-src="https://raw.githubusercontent.com/lijinzedev/picture/main/img20210717131809.png" alt="image-20210717131808699"></p>
<h3 id="3-获取索引信息"><a class="markdownIt-Anchor" href="#3-获取索引信息"></a> 3 获取索引信息</h3>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable constant_">GET</span> my-index-<span class="number">000001</span></span><br></pre></td></tr></table></figure>
<p><img src= "/img/loading.gif" data-lazy-src="https://raw.githubusercontent.com/lijinzedev/picture/main/img20210717132026.png" alt="image-20210717132024549"></p>
<blockquote>
<p>注意： 如果文档没有指定类型，ES会默认配置字段类型</p>
</blockquote>
<h3 id="4-获取健康信息"><a class="markdownIt-Anchor" href="#4-获取健康信息"></a> 4 获取健康信息</h3>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable constant_">GET</span> /_cat/health</span><br></pre></td></tr></table></figure>
<h3 id="5-获取索引情况"><a class="markdownIt-Anchor" href="#5-获取索引情况"></a> 5 获取索引情况</h3>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable constant_">GET</span> /_cat/indices?v</span><br></pre></td></tr></table></figure>
<h3 id="6-修改数据"><a class="markdownIt-Anchor" href="#6-修改数据"></a> 6 修改数据</h3>
<blockquote>
<p>PUT会造成覆盖不推荐，POST更灵活</p>
</blockquote>
<p><strong>PUT方式修改  不推荐</strong></p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable constant_">PUT</span> /test/type1/<span class="number">1</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;name&quot;</span><span class="symbol">:<span class="string">&quot;jack&quot;</span></span>,</span><br><span class="line"><span class="string">&quot;age&quot;</span><span class="symbol">:<span class="string">&quot;18&quot;</span></span>&#125;</span><br></pre></td></tr></table></figure>
<p><img src= "/img/loading.gif" data-lazy-src="https://raw.githubusercontent.com/lijinzedev/picture/main/img20210717203231.png" alt="image-20210717203220827"></p>
<p><strong>POST方式修改 推荐</strong></p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable constant_">POST</span> /test/type1/<span class="number">1</span>/_update</span><br><span class="line">&#123;</span><br><span class="line"> <span class="string">&quot;doc&quot;</span><span class="symbol">:</span>&#123;</span><br><span class="line">     <span class="string">&quot;name&quot;</span><span class="symbol">:<span class="string">&quot;jack123&quot;</span></span></span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable constant_">GET</span> /test/type1/<span class="number">1</span>/</span><br></pre></td></tr></table></figure>
<p><img src= "/img/loading.gif" data-lazy-src="https://raw.githubusercontent.com/lijinzedev/picture/main/img20210717203516.png" alt="image-20210717203514944"></p>
<h3 id="7-删除索引"><a class="markdownIt-Anchor" href="#7-删除索引"></a> 7 删除索引</h3>
<blockquote>
<p>根据请求判断删除索引还是删除文档记录</p>
<p>写文档就直接删除文档，写库就直接删除库</p>
</blockquote>
<h2 id="2-文档基本操作"><a class="markdownIt-Anchor" href="#2-文档基本操作"></a> 2 文档基本操作</h2>
<h3 id="1-基本操作"><a class="markdownIt-Anchor" href="#1-基本操作"></a> 1 基本操作</h3>
<blockquote>
<p>添加基础数据</p>
</blockquote>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable constant_">PUT</span> /cur/user/<span class="number">1</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;name&quot;</span><span class="symbol">:<span class="string">&quot;curiosity&quot;</span></span>,</span><br><span class="line">  <span class="string">&quot;local&quot;</span><span class="symbol">:<span class="string">&quot;南非&quot;</span></span>,</span><br><span class="line">  <span class="string">&quot;home&quot;</span><span class="symbol">:</span>[<span class="string">&quot;湖南&quot;</span>,<span class="string">&quot;湖北&quot;</span>]</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable constant_">PUT</span> /cur/user/<span class="number">2</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;name&quot;</span><span class="symbol">:<span class="string">&quot;张三&quot;</span></span>,</span><br><span class="line">  <span class="string">&quot;local&quot;</span><span class="symbol">:<span class="string">&quot;阿拉伯&quot;</span></span>,</span><br><span class="line">  <span class="string">&quot;home&quot;</span><span class="symbol">:</span>[<span class="string">&quot;山东&quot;</span>,<span class="string">&quot;河南&quot;</span>]</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable constant_">PUT</span> /cur/user/<span class="number">3</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;name&quot;</span><span class="symbol">:<span class="string">&quot;李四&quot;</span></span>,</span><br><span class="line">  <span class="string">&quot;local&quot;</span><span class="symbol">:<span class="string">&quot;熬鹰哥特&quot;</span></span>,</span><br><span class="line">  <span class="string">&quot;home&quot;</span><span class="symbol">:</span>[<span class="string">&quot;海南&quot;</span>,<span class="string">&quot;重庆&quot;</span>]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>Version代表更新次数</p>
</blockquote>
<p><img src= "/img/loading.gif" data-lazy-src="https://raw.githubusercontent.com/lijinzedev/picture/main/img20210717205120.png" alt="image-20210717205106399"></p>
<h4 id="1-条件查询"><a class="markdownIt-Anchor" href="#1-条件查询"></a> 1 条件查询</h4>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable constant_">GET</span> cur/user/_search?q=<span class="symbol">name:</span>李四</span><br></pre></td></tr></table></figure>
<h3 id="2-复杂操作"><a class="markdownIt-Anchor" href="#2-复杂操作"></a> 2 复杂操作</h3>
<h4 id="1-query-查询匹配条件"><a class="markdownIt-Anchor" href="#1-query-查询匹配条件"></a> 1 query 查询匹配条件</h4>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable constant_">GET</span> cur/user/_search</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;query&quot;</span><span class="symbol">:</span>&#123;</span><br><span class="line">    <span class="string">&quot;match&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;name&quot;</span>: <span class="string">&quot;李四&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src= "/img/loading.gif" data-lazy-src="https://raw.githubusercontent.com/lijinzedev/picture/main/img20210717201703.png" alt="image-20210717211040017"></p>
<p><strong>hits:</strong></p>
<ul>
<li>索引和文档信息</li>
<li>查询结果总数</li>
<li>查询的具体文档</li>
<li>max_score可以判断谁是最匹配的结果</li>
</ul>
<h4 id="2-_source-指定查询出来的字段"><a class="markdownIt-Anchor" href="#2-_source-指定查询出来的字段"></a> 2 _source 指定查询出来的字段</h4>
<blockquote>
<p>类似于mysql的 select 字段</p>
</blockquote>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable constant_">GET</span> cur/user/_search</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;query&quot;</span><span class="symbol">:</span>&#123;</span><br><span class="line">    <span class="string">&quot;match&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;name&quot;</span>: <span class="string">&quot;李四&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">&quot;_source&quot;</span><span class="symbol">:</span>[<span class="string">&quot;name&quot;</span>,<span class="string">&quot;local&quot;</span>]</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><img src= "/img/loading.gif" data-lazy-src="https://raw.githubusercontent.com/lijinzedev/picture/main/img20210717202338.png" alt="image-20210717202337149"></p>
<h4 id="3-sort-排序"><a class="markdownIt-Anchor" href="#3-sort-排序"></a> 3 sort 排序</h4>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable constant_">GET</span> cur/user/_search</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;query&quot;</span><span class="symbol">:</span>&#123;</span><br><span class="line">    <span class="string">&quot;match&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;name&quot;</span>: <span class="string">&quot;李四&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">&quot;_source&quot;</span><span class="symbol">:</span>[<span class="string">&quot;name&quot;</span>,<span class="string">&quot;local&quot;</span>],</span><br><span class="line">  <span class="string">&quot;sort&quot;</span><span class="symbol">:</span>[</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="string">&quot;age&quot;</span><span class="symbol">:</span>&#123;</span><br><span class="line">        <span class="string">&quot;order&quot;</span><span class="symbol">:<span class="string">&quot;asc&quot;</span></span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="4-from-size分页"><a class="markdownIt-Anchor" href="#4-from-size分页"></a> 4 from size分页</h4>
<blockquote>
<p>数据下标从0开始</p>
</blockquote>
<ul>
<li>from 设置从第几个数据开始</li>
<li>size 返回多少条数据</li>
</ul>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable constant_">GET</span> cur/user/_search</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;query&quot;</span><span class="symbol">:</span>&#123;</span><br><span class="line">    <span class="string">&quot;match&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;name&quot;</span>: <span class="string">&quot;李四&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">&quot;_source&quot;</span><span class="symbol">:</span>[<span class="string">&quot;name&quot;</span>,<span class="string">&quot;local&quot;</span>],</span><br><span class="line">  <span class="string">&quot;from&quot;</span><span class="symbol">:</span><span class="number">0</span>,</span><br><span class="line">  <span class="string">&quot;size&quot;</span><span class="symbol">:</span><span class="number">2</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h4 id="5-布尔查询"><a class="markdownIt-Anchor" href="#5-布尔查询"></a> 5 布尔查询</h4>
<blockquote>
<p>类似于where语句</p>
</blockquote>
<ul>
<li>must 相当于mysql里面的 and</li>
<li>should 相当于mysql里面的 or</li>
<li>must_not 相当于 !=</li>
</ul>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable constant_">GET</span> cur/user/_search</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;query&quot;</span><span class="symbol">:</span>&#123;</span><br><span class="line">    <span class="string">&quot;bool&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;must&quot;</span>: [</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="string">&quot;match&quot;</span>: &#123;</span><br><span class="line">               <span class="string">&quot;name&quot;</span>: <span class="string">&quot;李四&quot;</span></span><br><span class="line">          &#125;,</span><br><span class="line">          <span class="string">&quot;match&quot;</span>: &#123;</span><br><span class="line">               <span class="string">&quot;name&quot;</span>: <span class="string">&quot;李四&quot;</span><span class="number">123</span></span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      ]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="6-filter-过滤"><a class="markdownIt-Anchor" href="#6-filter-过滤"></a> 6 filter 过滤</h4>
<blockquote>
<p>例如：过滤区间</p>
</blockquote>
<ul>
<li>gt &gt;</li>
<li>gte &gt;=</li>
<li>lt &lt;</li>
<li>lte &lt;=</li>
</ul>
<blockquote>
<p>筛选数据</p>
</blockquote>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable constant_">GET</span> cur/user/_search</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;query&quot;</span><span class="symbol">:</span>&#123;</span><br><span class="line">    <span class="string">&quot;bool&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;must&quot;</span>: [</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="string">&quot;match&quot;</span>: &#123;</span><br><span class="line">               <span class="string">&quot;name&quot;</span>: <span class="string">&quot;李四&quot;</span></span><br><span class="line">          &#125;</span><br><span class="line">          </span><br><span class="line">        &#125;</span><br><span class="line">  </span><br><span class="line">      ], </span><br><span class="line">      <span class="string">&quot;filter&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;range&quot;</span><span class="symbol">:</span>&#123;</span><br><span class="line">          <span class="string">&quot;age&quot;</span><span class="symbol">:</span>&#123;</span><br><span class="line">             <span class="string">&quot;lt&quot;</span>: <span class="number">20</span></span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h4 id="7-多条件"><a class="markdownIt-Anchor" href="#7-多条件"></a> 7 多条件</h4>
<blockquote>
<p>多条件使用空格隔开，只要满足其中一个结果就可以被查出来</p>
<p>这个时候可以通过分值基本的判断</p>
</blockquote>
<p><img src= "/img/loading.gif" data-lazy-src="https://raw.githubusercontent.com/lijinzedev/picture/main/img20210717214320.png" alt="image-20210717214317982"></p>
<h4 id="8-term-查询"><a class="markdownIt-Anchor" href="#8-term-查询"></a> 8 term 查询</h4>
<blockquote>
<p>term查询直接通过倒排索引指定的词条进行精确查找</p>
</blockquote>
<p><strong>分词：</strong></p>
<ul>
<li>
<p>term： 直接查询精确的</p>
</li>
<li>
<p>match 会使用分词器解析！（先分析文档，然后在通过分析的文档记性查询）</p>
</li>
</ul>
<p><strong>keyword 类型的不会被分词器解析</strong></p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable constant_">PUT</span> testdb</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;mappings&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;properties&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;name&quot;</span><span class="symbol">:</span>&#123;</span><br><span class="line">        <span class="string">&quot;type&quot;</span>: <span class="string">&quot;text&quot;</span></span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="string">&quot;desc&quot;</span><span class="symbol">:</span>&#123;</span><br><span class="line">        <span class="string">&quot;type&quot;</span>: <span class="string">&quot;keyword&quot;</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable constant_">PUT</span> testdb/_doc/<span class="number">1</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;name&quot;</span><span class="symbol">:<span class="string">&quot;我的家在东北&quot;</span></span>,</span><br><span class="line">  <span class="string">&quot;desc&quot;</span><span class="symbol">:<span class="string">&quot;我的家在东北&quot;</span></span></span><br><span class="line">&#125;</span><br><span class="line"><span class="variable constant_">PUT</span> testdb/_doc/<span class="number">3</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;name&quot;</span><span class="symbol">:<span class="string">&quot;我的家在东北&quot;</span></span>,</span><br><span class="line">  <span class="string">&quot;desc&quot;</span><span class="symbol">:<span class="string">&quot;我的家在东北3&quot;</span></span></span><br><span class="line">&#125;</span><br><span class="line"><span class="variable constant_">GET</span> _analyze</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;analyzer&quot;</span>: <span class="string">&quot;keyword&quot;</span></span><br><span class="line">  , <span class="string">&quot;text&quot;</span>: <span class="string">&quot;我的家在东北&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable constant_">GET</span> _analyze</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;analyzer&quot;</span>: <span class="string">&quot;standard&quot;</span></span><br><span class="line">  , <span class="string">&quot;text&quot;</span>: <span class="string">&quot;我的家在东北&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="variable constant_">GET</span> testdb/_search</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;query&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;term&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;desc&quot;</span>: <span class="string">&quot;我&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><img src= "/img/loading.gif" data-lazy-src="https://raw.githubusercontent.com/lijinzedev/picture/main/img20210717220621.png" alt="image-20210717215353565"></p>
<h4 id="9-多个值精确查询"><a class="markdownIt-Anchor" href="#9-多个值精确查询"></a> 9 多个值精确查询</h4>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable constant_">GET</span> testdb/_search</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;query&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;bool&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;should&quot;</span>: [</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="string">&quot;term&quot;</span>: &#123;</span><br><span class="line">            <span class="string">&quot;desc&quot;</span>: <span class="string">&quot;我的家在东北&quot;</span></span><br><span class="line">          &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">                &#123;</span><br><span class="line">          <span class="string">&quot;term&quot;</span>: &#123;</span><br><span class="line">            <span class="string">&quot;desc&quot;</span>: <span class="string">&quot;我的家在东北2&quot;</span></span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      ]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="10-高亮查询heighligh"><a class="markdownIt-Anchor" href="#10-高亮查询heighligh"></a> 10 高亮查询heighligh</h4>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="variable constant_">GET</span> cur/user/_search</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;query&quot;</span><span class="symbol">:</span>&#123;</span><br><span class="line">    <span class="string">&quot;match&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;name&quot;</span>: <span class="string">&quot;李四&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">&quot;highlight&quot;</span><span class="symbol">:</span>&#123;</span><br><span class="line">    <span class="string">&quot;fields&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;name&quot;</span><span class="symbol">:</span>&#123;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><img src= "/img/loading.gif" data-lazy-src="https://raw.githubusercontent.com/lijinzedev/picture/main/img20210717220627.png" alt="image-20210717220617879"></p>
<p><strong>自定义高亮</strong></p>
<p><img src= "/img/loading.gif" data-lazy-src="https://raw.githubusercontent.com/lijinzedev/picture/main/img20210717213317.png" alt="image-20210717213257144"></p>
<h1 id="五-集成springboot"><a class="markdownIt-Anchor" href="#五-集成springboot"></a> 五 集成SpringBoot</h1>
<p><a target="_blank" rel="noopener" href="https://www.elastic.co/guide/en/elasticsearch/client/java-rest/current/java-rest-high-getting-started-initialization.html">官方文档</a></p>
<p><strong>注意：</strong></p>
<blockquote>
<p>注意es的版本避免不必要的错误</p>
</blockquote>
<p><img src= "/img/loading.gif" data-lazy-src="https://raw.githubusercontent.com/lijinzedev/picture/main/img20210717224136.png" alt="image-20210717224133923"></p>
<h2 id="1-创建索引-2"><a class="markdownIt-Anchor" href="#1-创建索引-2"></a> 1 创建索引</h2>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">testCreateIndex</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    <span class="comment">// 创建索引请求</span></span><br><span class="line">    <span class="type">CreateIndexRequest</span> <span class="variable">request</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CreateIndexRequest</span>(<span class="string">&quot;boot_index&quot;</span>);</span><br><span class="line">    <span class="comment">// 执行请求</span></span><br><span class="line">    <span class="keyword">final</span> <span class="type">CreateIndexResponse</span> <span class="variable">createIndexResponse</span> <span class="operator">=</span> restHighLevelClient.indices().create(request, RequestOptions.DEFAULT);</span><br><span class="line">    System.out.println(createIndexResponse);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="2-判断索引是否存在"><a class="markdownIt-Anchor" href="#2-判断索引是否存在"></a> 2 判断索引是否存在</h2>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="comment">// 获取索引判断是否存在</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">getIndex</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    <span class="comment">// 获取索引请求</span></span><br><span class="line">    <span class="type">GetIndexRequest</span> <span class="variable">request</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">GetIndexRequest</span>(<span class="string">&quot;boot_index&quot;</span>);</span><br><span class="line">    <span class="comment">// 执行请求</span></span><br><span class="line">    <span class="keyword">final</span> <span class="type">boolean</span> <span class="variable">exists</span> <span class="operator">=</span> restHighLevelClient.indices().exists(request, RequestOptions.DEFAULT);</span><br><span class="line">    System.out.println(exists);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="3-删除索引"><a class="markdownIt-Anchor" href="#3-删除索引"></a> 3 删除索引</h2>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="comment">// 删除索引</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">deletreIndex</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    <span class="comment">// 获取索引请求</span></span><br><span class="line">    <span class="type">DeleteIndexRequest</span> <span class="variable">request</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DeleteIndexRequest</span>(<span class="string">&quot;boot_index&quot;</span>);</span><br><span class="line">    <span class="comment">// 执行请求</span></span><br><span class="line">    <span class="keyword">final</span> <span class="type">AcknowledgedResponse</span> <span class="variable">delete</span> <span class="operator">=</span> restHighLevelClient.indices().delete(request, RequestOptions.DEFAULT);</span><br><span class="line">    System.out.println(delete.isAcknowledged());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="4-创建文档"><a class="markdownIt-Anchor" href="#4-创建文档"></a> 4 创建文档</h2>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="comment">//  创建文档</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">createDecument</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line">    user.setUser(<span class="string">&quot;漩涡鸣人&quot;</span>);</span><br><span class="line">    user.setAge(<span class="number">17</span>);</span><br><span class="line">    <span class="comment">// 创建请求</span></span><br><span class="line">    <span class="type">IndexRequest</span> <span class="variable">request</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">IndexRequest</span>(<span class="string">&quot;boot_index&quot;</span>);</span><br><span class="line">    <span class="comment">// 规则 put /boot_index/_doc/1</span></span><br><span class="line">    request.id(<span class="string">&quot;1&quot;</span>);</span><br><span class="line">    request.timeout(TimeValue.timeValueSeconds(<span class="number">1</span>));</span><br><span class="line">    request.timeout(<span class="string">&quot;1s&quot;</span>);</span><br><span class="line">    <span class="type">ObjectMapper</span> <span class="variable">mapper</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectMapper</span>();</span><br><span class="line">    <span class="keyword">final</span> <span class="type">String</span> <span class="variable">string</span> <span class="operator">=</span> mapper.writeValueAsString(user);</span><br><span class="line">    request.source(string, XContentType.JSON);</span><br><span class="line">    <span class="keyword">final</span> <span class="type">IndexResponse</span> <span class="variable">index</span> <span class="operator">=</span> restHighLevelClient.index(request, RequestOptions.DEFAULT);</span><br><span class="line">    System.out.println(index.status().getStatus());</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="5-获取文档判断是否存在"><a class="markdownIt-Anchor" href="#5-获取文档判断是否存在"></a> 5 获取文档判断是否存在</h2>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="comment">//  获取文档</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">getDecument</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 创建请求</span></span><br><span class="line">    <span class="type">GetRequest</span> <span class="variable">request</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">GetRequest</span>(<span class="string">&quot;boot_index&quot;</span>, <span class="string">&quot;1&quot;</span>);</span><br><span class="line">    <span class="comment">// 不获取返回的_source 的上下文</span></span><br><span class="line">    request.fetchSourceContext(<span class="keyword">new</span> <span class="title class_">FetchSourceContext</span>(<span class="literal">false</span>));</span><br><span class="line">    request.storedFields(<span class="string">&quot;_none_&quot;</span>);</span><br><span class="line">    <span class="keyword">final</span> <span class="type">boolean</span> <span class="variable">exists</span> <span class="operator">=</span> restHighLevelClient.exists(request, RequestOptions.DEFAULT);</span><br><span class="line">    System.out.println(exists);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h2 id="6-获取文档"><a class="markdownIt-Anchor" href="#6-获取文档"></a> 6 获取文档</h2>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="comment">//  获取文档</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">getDecumentSource</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 创建请求</span></span><br><span class="line">    <span class="type">GetRequest</span> <span class="variable">request</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">GetRequest</span>(<span class="string">&quot;boot_index&quot;</span>, <span class="string">&quot;1&quot;</span>);</span><br><span class="line">    <span class="keyword">final</span> <span class="type">GetResponse</span> <span class="variable">documentFields</span> <span class="operator">=</span> restHighLevelClient.get(request, RequestOptions.DEFAULT);</span><br><span class="line">    System.out.println(documentFields.getSourceAsString());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="7-更新文档"><a class="markdownIt-Anchor" href="#7-更新文档"></a> 7 更新文档</h2>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="comment">//  更新</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">update</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 创建请求</span></span><br><span class="line">    <span class="type">UpdateRequest</span> <span class="variable">request</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UpdateRequest</span>(<span class="string">&quot;boot_index&quot;</span>, <span class="string">&quot;1&quot;</span>);</span><br><span class="line">    <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line">    user.setUser(<span class="string">&quot;纳鲁托&quot;</span>);</span><br><span class="line">    user.setAge(<span class="number">17</span>);</span><br><span class="line">    <span class="type">ObjectMapper</span> <span class="variable">mapper</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectMapper</span>();</span><br><span class="line">    <span class="keyword">final</span> <span class="type">String</span> <span class="variable">string</span> <span class="operator">=</span> mapper.writeValueAsString(user);</span><br><span class="line">    request.doc(string,XContentType.JSON);</span><br><span class="line">    <span class="keyword">final</span> <span class="type">UpdateResponse</span> <span class="variable">update</span> <span class="operator">=</span> restHighLevelClient.update(request, RequestOptions.DEFAULT);</span><br><span class="line">    System.out.println(update.getGetResult());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="8-删除文档"><a class="markdownIt-Anchor" href="#8-删除文档"></a> 8 删除文档</h2>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="comment">//  删除</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">delete</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建请求</span></span><br><span class="line"><span class="type">DeleteRequest</span> <span class="variable">request</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DeleteRequest</span>(<span class="string">&quot;boot_index&quot;</span>, <span class="string">&quot;1&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">final</span> <span class="type">DeleteResponse</span> <span class="variable">delete</span> <span class="operator">=</span> restHighLevelClient.delete(request, RequestOptions.DEFAULT);</span><br><span class="line">System.out.println(delete.status());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="9-批量操作"><a class="markdownIt-Anchor" href="#9-批量操作"></a> 9 批量操作</h2>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="comment">//  批量导入</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">taskBulkRequest</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 创建请求</span></span><br><span class="line">    <span class="type">BulkRequest</span> <span class="variable">request</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BulkRequest</span>(<span class="string">&quot;boot_index&quot;</span>);</span><br><span class="line">    List&lt;User&gt; list = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">        list.add(<span class="keyword">new</span> <span class="title class_">User</span>(<span class="string">&quot;测试&quot;</span>+i,i));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">ObjectMapper</span> <span class="variable">mapper</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectMapper</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; list.size(); i++) &#123;</span><br><span class="line">        request.add(<span class="keyword">new</span> <span class="title class_">IndexRequest</span>(<span class="string">&quot;boot_index&quot;</span>).id(i+<span class="string">&quot;&quot;</span>).</span><br><span class="line">                    source(mapper.writeValueAsString(list.get(i)),XContentType.JSON));</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">final</span> <span class="type">BulkResponse</span> <span class="variable">bulk</span> <span class="operator">=</span> restHighLevelClient.bulk(request, RequestOptions.DEFAULT);</span><br><span class="line">    System.out.println(bulk.status());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="10-查询"><a class="markdownIt-Anchor" href="#10-查询"></a> 10 查询</h2>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="comment">//  查询</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">query</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    <span class="type">SearchRequest</span> <span class="variable">searchRequest</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SearchRequest</span>(<span class="string">&quot;boot_index&quot;</span>);</span><br><span class="line">    <span class="type">SearchSourceBuilder</span> <span class="variable">searchRequestBuilder</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SearchSourceBuilder</span>();</span><br><span class="line">    <span class="comment">// 精确</span></span><br><span class="line">    <span class="keyword">final</span> <span class="type">TermQueryBuilder</span> <span class="variable">termQueryBuilder</span> <span class="operator">=</span> QueryBuilders.termQuery(<span class="string">&quot;user&quot;</span>, <span class="string">&quot;测试1&quot;</span>);</span><br><span class="line">    <span class="comment">// 匹配所有</span></span><br><span class="line">    <span class="keyword">final</span> <span class="type">MatchAllQueryBuilder</span> <span class="variable">matchAllQueryBuilder</span> <span class="operator">=</span> QueryBuilders.matchAllQuery();</span><br><span class="line">    searchRequestBuilder.query(matchAllQueryBuilder);</span><br><span class="line">    searchRequest.source(searchRequestBuilder);</span><br><span class="line">    <span class="keyword">final</span> <span class="type">SearchResponse</span> <span class="variable">search</span> <span class="operator">=</span> restHighLevelClient.search(searchRequest,RequestOptions.DEFAULT);</span><br><span class="line">    <span class="keyword">final</span> <span class="type">String</span> <span class="variable">s</span> <span class="operator">=</span> Arrays.stream(search.getHits().getHits()).collect(Collectors.toList()).toString();</span><br><span class="line">    System.out.println(s);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">Curiosity</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://lijinzedev.github.io/2021/07/15/ElasticSearch-%E5%85%A5%E9%97%A8/">https://lijinzedev.github.io/2021/07/15/ElasticSearch-%E5%85%A5%E9%97%A8/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://lijinzedev.github.io" target="_blank">Curiosity的博客</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E4%B8%AD%E9%97%B4%E4%BB%B6/">中间件</a><a class="post-meta__tags" href="/tags/elk/">elk</a></div><div class="post_share"><div class="social-share" data-image="https://user-images.githubusercontent.com/41108332/105622748-e2c5b580-5e4e-11eb-95c9-b22cdfdd632b.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2021/07/18/RabbitMQ/"><img class="prev-cover" data-lazy-src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">RabbitMQ入门</div></div></a></div><div class="next-post pull-right"><a href="/2021/07/14/docker-%E7%BD%91%E7%BB%9C%E4%B9%8Bmacvaln/"><img class="next-cover" data-lazy-src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">docker 网络之macvaln</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span> 相关推荐</span></div><div class="relatedPosts-list"><div><a href="/2021/04/02/Nginx配置HTTPS/" title="Nginx配置HTTPS"><img class="cover" data-lazy-src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-04-02</div><div class="title">Nginx配置HTTPS</div></div></a></div><div><a href="/2022/07/22/RocketMQ-docker-集群笔记/" title="RocketMQ-docker-集群笔记"><img class="cover" data-lazy-src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-07-22</div><div class="title">RocketMQ-docker-集群笔记</div></div></a></div><div><a href="/2021/08/03/Sharding-JDBC数据脱敏/" title="Sharding-JDBC数据脱敏"><img class="cover" data-lazy-src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-08-03</div><div class="title">Sharding-JDBC数据脱敏</div></div></a></div><div><a href="/2020/12/21/nginx-入门/" title="nginx 入门"><img class="cover" data-lazy-src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2020-12-21</div><div class="title">nginx 入门</div></div></a></div><div><a href="/2021/08/10/EMQX入门/" title="EMQX入门"><img class="cover" data-lazy-src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-08-10</div><div class="title">EMQX入门</div></div></a></div><div><a href="/2020/12/26/Redis基础入门/" title="Redis基础入门"><img class="cover" data-lazy-src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2020-12-26</div><div class="title">Redis基础入门</div></div></a></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="card-info-avatar is-center"><img class="avatar-img" data-lazy-src="https://user-images.githubusercontent.com/41108332/105622748-e2c5b580-5e4e-11eb-95c9-b22cdfdd632b.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/><div class="author-info__name">Curiosity</div><div class="author-info__description">SpringBoot | Mybatis | Java | Mysql</div></div><div class="card-info-data"><div class="card-info-data-item is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">155</div></a></div><div class="card-info-data-item is-center"><a href="/tags/"><div class="headline">标签</div><div class="length-num">83</div></a></div><div class="card-info-data-item is-center"><a href="/categories/"><div class="headline">分类</div><div class="length-num">112</div></a></div></div><a class="button--animated" id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/lijinzedev"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/lijinzedev" target="_blank" title="Github"><i class="fab fa-github"></i></a><a class="social-icon" href="mailto:2533755010@gmail.com" target="_blank" title="Email"><i class="fas fa-envelope"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn card-announcement-animation"></i><span>公告</span></div><div class="announcement_content">万般皆下品,唯有读书高</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%B8%80-elasticsearch"><span class="toc-number">1.</span> <span class="toc-text"> 一 ElasticSearch</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%80%E4%B9%88%E6%98%AFelasticsearch"><span class="toc-number">1.0.1.</span> <span class="toc-text"> 什么是Elasticsearch?</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#mysql%E4%B9%9F%E8%83%BD%E5%AE%9E%E7%8E%B0elasticsearch%E7%9A%84%E5%8A%9F%E8%83%BD-%E4%B8%BA%E4%BB%80%E4%B9%88%E8%BF%98%E9%9C%80%E8%A6%81elasticsearch"><span class="toc-number">1.0.2.</span> <span class="toc-text"> mysql也能实现Elasticsearch的功能 为什么还需要Elasticsearch</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%86%E8%A7%A3elk"><span class="toc-number">1.0.3.</span> <span class="toc-text"> 了解ELK</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA"><span class="toc-number">1.1.</span> <span class="toc-text"> 1 环境搭建</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E7%BC%96%E5%86%99docker-compose%E6%96%87%E4%BB%B6"><span class="toc-number">1.1.1.</span> <span class="toc-text"> 1 编写docker-compose文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E7%BC%96%E5%86%99elasticsearchyml%E6%96%87%E4%BB%B6"><span class="toc-number">1.1.2.</span> <span class="toc-text"> 2 编写elasticsearch.yml文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E6%B1%89%E5%8C%96kibana"><span class="toc-number">1.1.3.</span> <span class="toc-text"> 3 汉化kibana</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#elasticsearch%E5%AE%89%E8%A3%85"><span class="toc-number">2.</span> <span class="toc-text"> ElasticSearch安装</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BA%8C-%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5"><span class="toc-number">3.</span> <span class="toc-text"> 二  核心概念</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-elasticsearch%E7%9B%B8%E5%85%B3%E7%9A%84%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B"><span class="toc-number">3.1.</span> <span class="toc-text"> 1 ElasticSearch相关的数据类型</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%B8%89-ik%E5%88%86%E8%AF%8D%E5%99%A8"><span class="toc-number">4.</span> <span class="toc-text"> 三 IK分词器</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-%E5%AE%89%E8%A3%85"><span class="toc-number">4.1.</span> <span class="toc-text"> 1 安装</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-%E6%B5%8B%E8%AF%95"><span class="toc-number">4.2.</span> <span class="toc-text"> 2 测试</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-ik%E5%88%86%E8%AF%8D%E5%99%A8%E5%A2%9E%E5%8A%A0%E8%87%AA%E5%B7%B1%E7%9A%84%E9%85%8D%E7%BD%AE%E4%BF%9D%E5%AD%98%E5%90%8E%E9%9C%80%E8%A6%81%E9%87%8D%E5%90%AF"><span class="toc-number">4.3.</span> <span class="toc-text"> 3 IK分词器增加自己的配置（保存后，需要重启）</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%9B%9B-%E5%9F%BA%E7%A1%80%E6%93%8D%E4%BD%9C"><span class="toc-number">5.</span> <span class="toc-text"> 四 基础操作</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-%E5%9F%BA%E7%A1%80%E6%B5%8B%E8%AF%95"><span class="toc-number">5.1.</span> <span class="toc-text"> 1 基础测试</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E5%88%9B%E5%BB%BA%E7%B4%A2%E5%BC%95"><span class="toc-number">5.1.1.</span> <span class="toc-text"> 1 创建索引</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E6%B7%BB%E5%8A%A0%E5%AD%97%E6%AE%B5%E7%B1%BB%E5%9E%8B"><span class="toc-number">5.1.2.</span> <span class="toc-text"> 2 添加字段类型</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E8%8E%B7%E5%8F%96%E7%B4%A2%E5%BC%95%E4%BF%A1%E6%81%AF"><span class="toc-number">5.1.3.</span> <span class="toc-text"> 3 获取索引信息</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-%E8%8E%B7%E5%8F%96%E5%81%A5%E5%BA%B7%E4%BF%A1%E6%81%AF"><span class="toc-number">5.1.4.</span> <span class="toc-text"> 4 获取健康信息</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-%E8%8E%B7%E5%8F%96%E7%B4%A2%E5%BC%95%E6%83%85%E5%86%B5"><span class="toc-number">5.1.5.</span> <span class="toc-text"> 5 获取索引情况</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-%E4%BF%AE%E6%94%B9%E6%95%B0%E6%8D%AE"><span class="toc-number">5.1.6.</span> <span class="toc-text"> 6 修改数据</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-%E5%88%A0%E9%99%A4%E7%B4%A2%E5%BC%95"><span class="toc-number">5.1.7.</span> <span class="toc-text"> 7 删除索引</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-%E6%96%87%E6%A1%A3%E5%9F%BA%E6%9C%AC%E6%93%8D%E4%BD%9C"><span class="toc-number">5.2.</span> <span class="toc-text"> 2 文档基本操作</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E5%9F%BA%E6%9C%AC%E6%93%8D%E4%BD%9C"><span class="toc-number">5.2.1.</span> <span class="toc-text"> 1 基本操作</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-%E6%9D%A1%E4%BB%B6%E6%9F%A5%E8%AF%A2"><span class="toc-number">5.2.1.1.</span> <span class="toc-text"> 1 条件查询</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E5%A4%8D%E6%9D%82%E6%93%8D%E4%BD%9C"><span class="toc-number">5.2.2.</span> <span class="toc-text"> 2 复杂操作</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-query-%E6%9F%A5%E8%AF%A2%E5%8C%B9%E9%85%8D%E6%9D%A1%E4%BB%B6"><span class="toc-number">5.2.2.1.</span> <span class="toc-text"> 1 query 查询匹配条件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-_source-%E6%8C%87%E5%AE%9A%E6%9F%A5%E8%AF%A2%E5%87%BA%E6%9D%A5%E7%9A%84%E5%AD%97%E6%AE%B5"><span class="toc-number">5.2.2.2.</span> <span class="toc-text"> 2 _source 指定查询出来的字段</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-sort-%E6%8E%92%E5%BA%8F"><span class="toc-number">5.2.2.3.</span> <span class="toc-text"> 3 sort 排序</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-from-size%E5%88%86%E9%A1%B5"><span class="toc-number">5.2.2.4.</span> <span class="toc-text"> 4 from size分页</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-%E5%B8%83%E5%B0%94%E6%9F%A5%E8%AF%A2"><span class="toc-number">5.2.2.5.</span> <span class="toc-text"> 5 布尔查询</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-filter-%E8%BF%87%E6%BB%A4"><span class="toc-number">5.2.2.6.</span> <span class="toc-text"> 6 filter 过滤</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7-%E5%A4%9A%E6%9D%A1%E4%BB%B6"><span class="toc-number">5.2.2.7.</span> <span class="toc-text"> 7 多条件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#8-term-%E6%9F%A5%E8%AF%A2"><span class="toc-number">5.2.2.8.</span> <span class="toc-text"> 8 term 查询</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#9-%E5%A4%9A%E4%B8%AA%E5%80%BC%E7%B2%BE%E7%A1%AE%E6%9F%A5%E8%AF%A2"><span class="toc-number">5.2.2.9.</span> <span class="toc-text"> 9 多个值精确查询</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#10-%E9%AB%98%E4%BA%AE%E6%9F%A5%E8%AF%A2heighligh"><span class="toc-number">5.2.2.10.</span> <span class="toc-text"> 10 高亮查询heighligh</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BA%94-%E9%9B%86%E6%88%90springboot"><span class="toc-number">6.</span> <span class="toc-text"> 五 集成SpringBoot</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-%E5%88%9B%E5%BB%BA%E7%B4%A2%E5%BC%95-2"><span class="toc-number">6.1.</span> <span class="toc-text"> 1 创建索引</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-%E5%88%A4%E6%96%AD%E7%B4%A2%E5%BC%95%E6%98%AF%E5%90%A6%E5%AD%98%E5%9C%A8"><span class="toc-number">6.2.</span> <span class="toc-text"> 2 判断索引是否存在</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-%E5%88%A0%E9%99%A4%E7%B4%A2%E5%BC%95"><span class="toc-number">6.3.</span> <span class="toc-text"> 3 删除索引</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-%E5%88%9B%E5%BB%BA%E6%96%87%E6%A1%A3"><span class="toc-number">6.4.</span> <span class="toc-text"> 4 创建文档</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-%E8%8E%B7%E5%8F%96%E6%96%87%E6%A1%A3%E5%88%A4%E6%96%AD%E6%98%AF%E5%90%A6%E5%AD%98%E5%9C%A8"><span class="toc-number">6.5.</span> <span class="toc-text"> 5 获取文档判断是否存在</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-%E8%8E%B7%E5%8F%96%E6%96%87%E6%A1%A3"><span class="toc-number">6.6.</span> <span class="toc-text"> 6 获取文档</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7-%E6%9B%B4%E6%96%B0%E6%96%87%E6%A1%A3"><span class="toc-number">6.7.</span> <span class="toc-text"> 7 更新文档</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#8-%E5%88%A0%E9%99%A4%E6%96%87%E6%A1%A3"><span class="toc-number">6.8.</span> <span class="toc-text"> 8 删除文档</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#9-%E6%89%B9%E9%87%8F%E6%93%8D%E4%BD%9C"><span class="toc-number">6.9.</span> <span class="toc-text"> 9 批量操作</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#10-%E6%9F%A5%E8%AF%A2"><span class="toc-number">6.10.</span> <span class="toc-text"> 10 查询</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2024/07/19/%E5%BC%80%E5%9C%BA/" title="无题"><img data-lazy-src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="无题"/></a><div class="content"><a class="title" href="/2024/07/19/%E5%BC%80%E5%9C%BA/" title="无题">无题</a><time datetime="2024-07-19T06:03:08.609Z" title="发表于 2024-07-19 06:03:08">2024-07-19</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/07/18/git-%E6%81%A2%E5%A4%8D%E6%96%87%E4%BB%B6%E8%84%9A%E6%9C%AC/" title="git 恢复文件脚本">git 恢复文件脚本</a><time datetime="2024-07-18T17:43:13.000Z" title="发表于 2024-07-18 17:43:13">2024-07-18</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/05/13/centos7-%E5%AE%89%E8%A3%85datahub/" title="centos7 安装datahub">centos7 安装datahub</a><time datetime="2024-05-13T13:49:07.000Z" title="发表于 2024-05-13 13:49:07">2024-05-13</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/04/22/windows-Java%E5%A4%9A%E7%89%88%E6%9C%AC%E5%88%87%E6%8D%A2/" title="windows Java多版本切换">windows Java多版本切换</a><time datetime="2024-04-22T10:37:48.000Z" title="发表于 2024-04-22 10:37:48">2024-04-22</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/04/05/Ubuntu%E8%BD%AF%E4%BB%B6%E6%BA%90/" title="Ubuntu软件源">Ubuntu软件源</a><time datetime="2024-04-05T23:33:57.000Z" title="发表于 2024-04-05 23:33:57">2024-04-05</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2024 By Curiosity</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><div class="search-dialog__title" id="local-search-title">本地搜索</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div></div><hr/><div id="local-search-results"></div><span class="search-close-button"><i class="fas fa-times"></i></span></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/medium-zoom/dist/medium-zoom.min.js"></script><script src="https://cdn.jsdelivr.net/npm/vanilla-lazyload/dist/lazyload.iife.min.js"></script><script src="/js/search/local-search.js"></script><div class="js-pjax"></div><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>