<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Redis基础入门 | Curiosity的博客</title><meta name="keywords" content="redis"><meta name="author" content="Curiosity"><meta name="copyright" content="Curiosity"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="Redis 基础入门  1 什么是NoSQL  Not Only SQL  特点  解耦（数据之间不存在关系） 方便扩展 大数据量高性能(一秒写八万，读取11万，细颗粒缓存，性能较高) 数据类型是多样性的，不需要事先设计数据库，随取随用  3V+3高  大数据时代的3V，主要描述问题  海量Volume 多样Variety 实时Velocity   大数据时代的3高，主要是对程序的要求  高并发">
<meta property="og:type" content="article">
<meta property="og:title" content="Redis基础入门">
<meta property="og:url" content="https://lijinzedev.github.io/2020/12/26/Redis%E5%9F%BA%E7%A1%80%E5%85%A5%E9%97%A8/index.html">
<meta property="og:site_name" content="Curiosity的博客">
<meta property="og:description" content="Redis 基础入门  1 什么是NoSQL  Not Only SQL  特点  解耦（数据之间不存在关系） 方便扩展 大数据量高性能(一秒写八万，读取11万，细颗粒缓存，性能较高) 数据类型是多样性的，不需要事先设计数据库，随取随用  3V+3高  大数据时代的3V，主要描述问题  海量Volume 多样Variety 实时Velocity   大数据时代的3高，主要是对程序的要求  高并发">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://user-images.githubusercontent.com/41108332/105622748-e2c5b580-5e4e-11eb-95c9-b22cdfdd632b.png">
<meta property="article:published_time" content="2020-12-26T17:15:44.000Z">
<meta property="article:modified_time" content="2021-09-18T07:50:32.091Z">
<meta property="article:author" content="Curiosity">
<meta property="article:tag" content="redis">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://user-images.githubusercontent.com/41108332/105622748-e2c5b580-5e4e-11eb-95c9-b22cdfdd632b.png"><link rel="shortcut icon" href="https://user-images.githubusercontent.com/41108332/105622748-e2c5b580-5e4e-11eb-95c9-b22cdfdd632b.png"><link rel="canonical" href="https://lijinzedev.github.io/2020/12/26/Redis%E5%9F%BA%E7%A1%80%E5%85%A5%E9%97%A8/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'mediumZoom',
  Snackbar: undefined,
  source: {
    jQuery: 'https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js',
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/js/jquery.justifiedGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/css/justifiedGallery.min.css'
    },
    fancybox: {
      js: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js',
      css: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: true,
  isanchor: false
};

const saveToLocal = {
  // ttl 單位是 天
  set: function setWithExpiry(key, value, ttl) {
    if (ttl === 0) return
    const now = new Date()
    const expiryDay = ttl * 86400000
    const item = {
      value: value,
      expiry: now.getTime() + expiryDay,
    }
    localStorage.setItem(key, JSON.stringify(item))
  },

  get: function getWithExpiry(key) {
    const itemStr = localStorage.getItem(key)

    if (!itemStr) {
      return undefined
    }
    const item = JSON.parse(itemStr)
    const now = new Date()

    if (now.getTime() > item.expiry) {
      localStorage.removeItem(key)
      return undefined
    }
    return item.value
  }
}

// https://stackoverflow.com/questions/16839698/jquery-getscript-alternative-in-native-javascript
const getScript = url => new Promise((resolve, reject) => {
  const script = document.createElement('script')
  script.src = url
  script.async = true
  script.onerror = reject
  script.onload = script.onreadystatechange = function() {
    const loadState = this.readyState
    if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
    script.onload = script.onreadystatechange = null
    resolve()
  }
  document.head.appendChild(script)
})</script><script id="config_change">var GLOBAL_CONFIG_SITE = { 
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2021-09-18 07:50:32'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(function () {  window.activateDarkMode = function () {
    document.documentElement.setAttribute('data-theme', 'dark')
    if (document.querySelector('meta[name="theme-color"]') !== null) {
      document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
    }
  }
  window.activateLightMode = function () {
    document.documentElement.setAttribute('data-theme', 'light')
   if (document.querySelector('meta[name="theme-color"]') !== null) {
      document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
    }
  }
  const autoChangeMode = 'false'
  const t = saveToLocal.get('theme')
  if (autoChangeMode === '1') {
    const isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
    const isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
    const isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
    const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified
    if (t === undefined) {
      if (isLightMode) activateLightMode()
      else if (isDarkMode) activateDarkMode()
      else if (isNotSpecified || hasNoSupport) {
        const now = new Date()
        const hour = now.getHours()
        const isNight = hour <= 6 || hour >= 18
        isNight ? activateDarkMode() : activateLightMode()
      }
      window.matchMedia('(prefers-color-scheme: dark)').addListener(function (e) {
        if (saveToLocal.get('theme') === undefined) {
          e.matches ? activateDarkMode() : activateLightMode()
        }
      })
    } else if (t === 'light') activateLightMode()
    else activateDarkMode()
  } else if (autoChangeMode === '2') {
    const now = new Date()
    const hour = now.getHours()
    const isNight = hour <= 6 || hour >= 18
    if (t === undefined) isNight ? activateDarkMode() : activateLightMode()
    else if (t === 'light') activateLightMode()
    else activateDarkMode()
  } else {
    if (t === 'dark') activateDarkMode()
    else if (t === 'light') activateLightMode()
  }const asideStatus = saveToLocal.get('aside-status')
if (asideStatus !== undefined) {
   if (asideStatus === 'hide') {
     document.documentElement.classList.add('hide-aside')
   } else {
     document.documentElement.classList.remove('hide-aside')
   }
}})()</script><meta name="generator" content="Hexo 5.4.0"><link rel="stylesheet" href="/css/prism.css" type="text/css"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="author-avatar"><img class="avatar-img" data-lazy-src="https://user-images.githubusercontent.com/41108332/105622748-e2c5b580-5e4e-11eb-95c9-b22cdfdd632b.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data"><div class="data-item is-center"><div class="data-item-link"><a href="/archives/"><div class="headline">文章</div><div class="length-num">84</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/tags/"><div class="headline">标签</div><div class="length-num">57</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/categories/"><div class="headline">分类</div><div class="length-num">46</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> 关于</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">Curiosity的博客</a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> 关于</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">Redis基础入门</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2020-12-26T17:15:44.000Z" title="发表于 2020-12-26 17:15:44">2020-12-26</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2021-09-18T07:50:32.091Z" title="更新于 2021-09-18 07:50:32">2021-09-18</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/redis/">redis</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="redis-基础入门"><a class="markdownIt-Anchor" href="#redis-基础入门"></a> Redis 基础入门</h1>
<h2 id="1-什么是nosql"><a class="markdownIt-Anchor" href="#1-什么是nosql"></a> 1 什么是NoSQL</h2>
<blockquote>
<p>Not Only SQL</p>
</blockquote>
<p><strong>特点</strong></p>
<ul>
<li>解耦（数据之间不存在关系）</li>
<li>方便扩展</li>
<li>大数据量高性能(一秒写八万，读取11万，细颗粒缓存，性能较高)</li>
<li>数据类型是多样性的，不需要事先设计数据库，随取随用</li>
</ul>
<p><strong>3V+3高</strong></p>
<ul>
<li>大数据时代的3V，主要描述问题
<ul>
<li>海量Volume</li>
<li>多样Variety</li>
<li>实时Velocity</li>
</ul>
</li>
<li>大数据时代的3高，主要是对程序的要求
<ul>
<li>高并发</li>
<li>高可扩</li>
<li>高性能</li>
</ul>
</li>
</ul>
<p><strong>为什么单线程还这么快</strong></p>
<blockquote>
<p>核心：redis是将所有的数据全部放到内存中的，所以说使用单线程去操作效率就是最高的，多线程（CPU上下文会切换会耗时）对于内存系统来说，如果没有上下文切换效率就是最高，多次读写在一个CPU上</p>
</blockquote>
<h2 id="2-nosql的四大分类"><a class="markdownIt-Anchor" href="#2-nosql的四大分类"></a> 2 NoSQL的四大分类</h2>
<p><strong>KV键值对</strong></p>
<p><strong>文档型数据库（bson格式）</strong></p>
<ul>
<li>NongoDB
<ul>
<li>基于分布式文件存储的数据库，C++编写，主要处理大量文档</li>
<li>是关系型数据库和非关系型数据库的中间产品，MongoDB是非关系型数据库功能最丰富，最像关系型数据库的</li>
</ul>
</li>
<li>ConthDB</li>
</ul>
<p><strong>列存储数据库</strong></p>
<ul>
<li>HBase</li>
<li>分布式文件系统</li>
</ul>
<p><strong>图关系数据库</strong></p>
<ul>
<li>存放关系，如社交网络，广告推荐</li>
<li>Neo4j，InfoGrid</li>
</ul>
<h2 id="3-redis"><a class="markdownIt-Anchor" href="#3-redis"></a> 3 Redis</h2>
<h3 id="1-概述"><a class="markdownIt-Anchor" href="#1-概述"></a> 1 概述</h3>
<p><strong>Redis是什么</strong></p>
<blockquote>
<p>Redis是远程字典服务，key-value数据库，并提供多种语言的API,</p>
<p>Redis是单线程的！Redis基于内存操作，CPU不是Redis性能瓶颈，Redis瓶颈是根据机器的内存和网络带宽，</p>
</blockquote>
<p><strong>Redis的功能</strong></p>
<ul>
<li>内存存储、持久化（rdb,aof）</li>
<li>效率高，可以高速缓存</li>
<li>发布订阅系统</li>
<li>地图信息分析</li>
<li>计时器，计数器（微信微博，浏览量）</li>
</ul>
<p><strong>Redis的特性</strong></p>
<ul>
<li>多样的数据类型</li>
<li>持久化</li>
<li>集群</li>
<li>事物</li>
</ul>
<h3 id="2-安装"><a class="markdownIt-Anchor" href="#2-安装"></a> 2 安装</h3>
<h4 id="1-linux-安装"><a class="markdownIt-Anchor" href="#1-linux-安装"></a> 1 Linux 安装</h4>
<p>略</p>
<h4 id="2-docker-安装"><a class="markdownIt-Anchor" href="#2-docker-安装"></a> 2 Docker 安装</h4>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 下载镜像</span></span><br><span class="line">docker pull redis </span><br><span class="line"><span class="comment"># 创建目录</span></span><br><span class="line">mkdir -p /home/docker/redis/conf</span><br><span class="line">mkdir -p /home/docker/redis/data</span><br><span class="line"></span><br><span class="line"><span class="comment"># 新增配置文件</span></span><br><span class="line"><span class="built_in">cd</span> /home/docker/redis/conf</span><br><span class="line">vim redis.conf</span><br><span class="line">-----------------</span><br><span class="line"><span class="comment"># 开启远程访问</span></span><br><span class="line"><span class="comment">#bind 127.0.0.1 </span></span><br><span class="line">protected-mode no</span><br><span class="line"><span class="comment"># 开启数据持久化</span></span><br><span class="line">appendonly yes</span><br><span class="line"><span class="comment"># 设置访问密码</span></span><br><span class="line">requirepass 123456 </span><br><span class="line">------------------</span><br><span class="line"><span class="comment"># 创建容器并启动</span></span><br><span class="line">docker run --name redis -p 6379:6379 -v /home/docker/redis/data:/data -v /home/docker/redis/conf/redis.conf:/etc/redis/redis.conf -d redis redis-server /etc/redis/redis.conf </span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="3-redis-benchmark性能测试"><a class="markdownIt-Anchor" href="#3-redis-benchmark性能测试"></a> 3 redis-benchmark性能测试</h3>
<p><img src= "/img/loading.gif" data-lazy-src="/2020/12/26/Redis%E5%9F%BA%E7%A1%80%E5%85%A5%E9%97%A8/image-20201226220537474.png" alt="图片来自菜鸟教程"></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 测试：100个并发连接 100000请求</span></span><br><span class="line">redis-benchmark -h localhost -p 6379 -c 100 -n 1000000</span><br></pre></td></tr></table></figure>
<h3 id="4-基础"><a class="markdownIt-Anchor" href="#4-基础"></a> 4 基础</h3>
<blockquote>
<p>redis默认16个数据库（配置文件配置），默认使用第一个数据库可以通过select 切换数据库</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 切换数据库</span></span><br><span class="line">127.0.0.1:6379&gt; select 2</span><br><span class="line"><span class="comment"># 查看大小</span></span><br><span class="line">127.0.0.1:6379[2]&gt; DBSIZE</span><br><span class="line"><span class="comment"># 查看所有的key</span></span><br><span class="line">127.0.0.1:6379[2]&gt; keys *</span><br><span class="line"><span class="comment"># 清空数据库</span></span><br><span class="line">127.0.0.1:6379[2]&gt; flushdb</span><br><span class="line"><span class="comment"># 清除所有数据库</span></span><br><span class="line">127.0.0.1:6379[2]&gt; flush moall</span><br><span class="line"><span class="comment"># 判断是否存在</span></span><br><span class="line">EXISTS &lt;key&gt;</span><br><span class="line"><span class="comment"># 移除</span></span><br><span class="line">move &lt;key&gt; 1 (1代表当前数据库)</span><br><span class="line"><span class="comment"># 设置过期时间</span></span><br><span class="line">EXPIRE &lt;key&gt; &lt;seconds&gt;</span><br><span class="line"><span class="comment"># 查看当前key的剩余时间</span></span><br><span class="line">ttl &lt;key&gt;</span><br><span class="line"><span class="comment"># 查看当前key的类型</span></span><br><span class="line"><span class="built_in">type</span> &lt;key&gt;</span><br></pre></td></tr></table></figure>
<h3 id="5-数据类型"><a class="markdownIt-Anchor" href="#5-数据类型"></a> 5 数据类型</h3>
<h4 id="1-string"><a class="markdownIt-Anchor" href="#1-string"></a> 1 String</h4>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 追加字符串,如果当前key不存在就创建key</span></span><br><span class="line">APPPEND &lt;key&gt; &lt;value&gt;</span><br><span class="line"><span class="comment"># 查看长度</span></span><br><span class="line">STRLEN &lt;key&gt;</span><br><span class="line"><span class="comment"># 自增命令 自增 1</span></span><br><span class="line">incr &lt;key&gt; </span><br><span class="line"><span class="comment"># 自减命令 自减 1</span></span><br><span class="line">decr &lt;key&gt;</span><br><span class="line"><span class="comment"># 自增设置步长</span></span><br><span class="line">INCRBY &lt;key&gt; &lt;increment&gt;</span><br><span class="line"><span class="comment"># 自减设置步长</span></span><br><span class="line">DECRBY &lt;key&gt; &lt;increment&gt;</span><br><span class="line"><span class="comment"># 截取字符串 </span></span><br><span class="line">GETRANGE &lt;key&gt; &lt;start&gt; &lt;end&gt;</span><br><span class="line"><span class="comment"># 截取 Hello world 字符串</span></span><br><span class="line">GETRANGE a 0 4 Hell</span><br><span class="line"><span class="comment"># 获取全部字符</span></span><br><span class="line">GETRANGE a 0 -1</span><br><span class="line"><span class="comment"># 替换指定位置开始的字符串</span></span><br><span class="line">SETRANGE &lt;key&gt; &lt;start&gt; &lt;str&gt;</span><br><span class="line"><span class="comment"># setex &lt;&gt; (set with expire ) 设置过期时间</span></span><br><span class="line">setex </span><br><span class="line"><span class="comment"># setnx (set if not exist) 不存在就设置 (分布式锁中会常常使用)</span></span><br><span class="line">setnx &lt;k&gt; &lt;v&gt;</span><br><span class="line"><span class="comment"># 批量 set (原子性操作)</span></span><br><span class="line">mset &lt;key&gt; &lt;v1&gt; &lt;k2&gt; &lt;v2&gt;</span><br><span class="line"><span class="comment"># 批量 get</span></span><br><span class="line">mget &lt;k1&gt; &lt;k2&gt; &lt;k3&gt;</span><br><span class="line"><span class="comment"># 对象</span></span><br><span class="line"><span class="built_in">set</span> user:1 &#123;name:1,age:3&#125; <span class="comment"># 设置user对象值位json</span></span><br><span class="line"><span class="comment"># 巧妙的使用mset替换对象对应的字符串</span></span><br><span class="line">mset user:1:name 1 user:1:age 3</span><br><span class="line">mget user:1:name user:1:age </span><br><span class="line"><span class="comment"># getset 命令 如果存在就返回旧的值,设置新的值,不存在就返回null,设置新的值</span></span><br></pre></td></tr></table></figure>
<p><strong>应用场景</strong></p>
<ul>
<li>计数器</li>
<li>统计多单位的数量</li>
<li>粉丝数</li>
<li>对象缓存</li>
</ul>
<h4 id="2-list"><a class="markdownIt-Anchor" href="#2-list"></a> 2 List</h4>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 将一个值,或者多个值,插入到表头</span></span><br><span class="line">LPUSH &lt;key&gt; 1 2 3 </span><br><span class="line"><span class="comment"># 将一个值或多个值插入表尾</span></span><br><span class="line">RPUSH &lt;key&gt; 4 5 6</span><br><span class="line"><span class="comment"># 查询所有的值</span></span><br><span class="line">LRANGE &lt;key&gt; 0 -1</span><br><span class="line"><span class="comment"># 左边移除第一个元素</span></span><br><span class="line">LPOP &lt;key&gt;</span><br><span class="line"><span class="comment"># 移除最后一个元素</span></span><br><span class="line">RPOP &lt;key&gt;</span><br><span class="line"><span class="comment"># 根据数组下标获取指定的值</span></span><br><span class="line">LINDEX &lt;key&gt; &lt;index&gt;</span><br><span class="line"><span class="comment"># 获取list长度</span></span><br><span class="line">LLEN &lt;key&gt;</span><br><span class="line"><span class="comment"># 移除指定的值</span></span><br><span class="line">LREM list &lt;移除个数&gt; &lt;对应value&gt;</span><br><span class="line">LREM list 1 one</span><br><span class="line"><span class="comment"># 截取指定返回的list</span></span><br><span class="line">LTRIM &lt;key&gt; &lt;start&gt; &lt;end&gt;</span><br><span class="line"><span class="comment"># 例如 a,b,c,d 截取 2,3 则为 a bs</span></span><br><span class="line"><span class="comment"># 移除并添加命令 从一个list 转移到另一个list</span></span><br><span class="line">rpoplpush &lt;<span class="built_in">source</span>&gt; &lt;dest&gt;</span><br><span class="line"><span class="comment"># 将列表中指定下标的值替换为新的值,如果不存在key就会报错，存在就没有问题</span></span><br><span class="line">lset &lt;key&gt; &lt;newVlue&gt;</span><br><span class="line"><span class="comment"># 将某一个具体的value，插入list中某个value的前面或者后面</span></span><br><span class="line">linsert &lt;key&gt; &lt;before|after&gt; &lt;value&gt; &lt;new value&gt;</span><br></pre></td></tr></table></figure>
<h4 id="3-set"><a class="markdownIt-Anchor" href="#3-set"></a> 3 Set</h4>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># set集合添加元素</span></span><br><span class="line">127.0.0.1:6379&gt; sadd myset <span class="string">&quot;hello&quot;</span> <span class="string">&quot;world&quot;</span></span><br><span class="line">(<span class="built_in">integer</span>) 2</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看set的成员</span></span><br><span class="line">127.0.0.1:6379&gt; smembers myset</span><br><span class="line">1) <span class="string">&quot;hello&quot;</span></span><br><span class="line">2) <span class="string">&quot;world&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 判断指定value在不在set集合中</span></span><br><span class="line">127.0.0.1:6379&gt; sismember myset hello</span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br><span class="line">127.0.0.1:6379&gt; </span><br><span class="line"></span><br><span class="line"><span class="comment"># 移除set中指定的元素</span></span><br><span class="line">127.0.0.1:6379&gt; srem myset hello</span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br><span class="line"></span><br><span class="line"><span class="comment"># 随机抽选中一个或多个 元素</span></span><br><span class="line">127.0.0.1:6379&gt; srandmember myset 1</span><br><span class="line">1) <span class="string">&quot;2&quot;</span></span><br><span class="line">127.0.0.1:6379&gt; srandmember myset 1</span><br><span class="line">1) <span class="string">&quot;1&quot;</span></span><br><span class="line">127.0.0.1:6379&gt; srandmember myset 1</span><br><span class="line">1) <span class="string">&quot;world&quot;</span></span><br><span class="line"><span class="comment"># 随机删除set集合中的元素</span></span><br><span class="line">127.0.0.1:6379&gt; spop myset</span><br><span class="line"><span class="string">&quot;3&quot;</span></span><br><span class="line"><span class="comment"># 将一个指定的值移动到另一个结合中</span></span><br><span class="line">smove myset myset2 <span class="string">&quot;111&quot;</span></span><br><span class="line"><span class="comment"># 交集</span></span><br><span class="line">sinter &lt;key1&gt; &lt;key2&gt;</span><br><span class="line"><span class="comment"># 差集</span></span><br><span class="line">sdiff &lt;key1&gt; &lt;key2&gt;</span><br><span class="line"><span class="comment"># 并集</span></span><br><span class="line">sunion &lt;key1&gt; &lt;key2&gt; <span class="comment"># 共同好友</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><strong>应用</strong></p>
<ul>
<li>共同爱好，共同关注，推荐好友</li>
</ul>
<h4 id="4-hash"><a class="markdownIt-Anchor" href="#4-hash"></a> 4 Hash</h4>
<blockquote>
<p>Map集合</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># set</span></span><br><span class="line">127.0.0.1:6379&gt; hset myhash f1 111 f2 222 f3 333 </span><br><span class="line">(<span class="built_in">integer</span>) 3</span><br><span class="line"></span><br><span class="line"><span class="comment"># 获取一个字段值 </span></span><br><span class="line">127.0.0.1:6379&gt; hget myhash f1</span><br><span class="line"><span class="string">&quot;111&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置多个字段值</span></span><br><span class="line">127.0.0.1:6379&gt; hmset myhash f4 444</span><br><span class="line">OK</span><br><span class="line"></span><br><span class="line"><span class="comment"># 获取全部字段值</span></span><br><span class="line">127.0.0.1:6379&gt; hgetall myhash</span><br><span class="line">1) <span class="string">&quot;f1&quot;</span></span><br><span class="line">2) <span class="string">&quot;111&quot;</span></span><br><span class="line">3) <span class="string">&quot;f2&quot;</span></span><br><span class="line">4) <span class="string">&quot;222&quot;</span></span><br><span class="line">5) <span class="string">&quot;f3&quot;</span></span><br><span class="line">6) <span class="string">&quot;333&quot;</span></span><br><span class="line">7) <span class="string">&quot;f4&quot;</span></span><br><span class="line">8) <span class="string">&quot;444&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 删除一个字段值</span></span><br><span class="line">127.0.0.1:6379&gt; hdel myhash f1</span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br><span class="line">127.0.0.1:6379&gt; hgetall myhash</span><br><span class="line">1) <span class="string">&quot;f2&quot;</span></span><br><span class="line">2) <span class="string">&quot;222&quot;</span></span><br><span class="line">3) <span class="string">&quot;f3&quot;</span></span><br><span class="line">4) <span class="string">&quot;333&quot;</span></span><br><span class="line">5) <span class="string">&quot;f4&quot;</span></span><br><span class="line">6) <span class="string">&quot;444&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 获取hash的字段数量</span></span><br><span class="line">127.0.0.1:6379&gt; hlen myhash</span><br><span class="line">(<span class="built_in">integer</span>) 3</span><br><span class="line"></span><br><span class="line"><span class="comment"># 判断hash中的key是否存在</span></span><br><span class="line">127.0.0.1:6379&gt; hexists myhash f1</span><br><span class="line">(<span class="built_in">integer</span>) 0</span><br><span class="line"></span><br><span class="line"><span class="comment"># 只获取所有的filed字段</span></span><br><span class="line">127.0.0.1:6379&gt; hkeys myhash</span><br><span class="line">1) <span class="string">&quot;f2&quot;</span></span><br><span class="line">2) <span class="string">&quot;f3&quot;</span></span><br><span class="line">3) <span class="string">&quot;f4&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 只获取所有的value字段</span></span><br><span class="line">127.0.0.1:6379&gt; hvals myhash</span><br><span class="line">1) <span class="string">&quot;222&quot;</span></span><br><span class="line">2) <span class="string">&quot;333&quot;</span></span><br><span class="line">3) <span class="string">&quot;444&quot;</span></span><br><span class="line">127.0.0.1:6379&gt; </span><br><span class="line"></span><br><span class="line"><span class="comment"># 指定增量</span></span><br><span class="line">127.0.0.1:6379&gt; hincrby myhash f2 1</span><br><span class="line">(<span class="built_in">integer</span>) 223</span><br><span class="line"></span><br><span class="line"><span class="comment"># 如果存在就设置</span></span><br><span class="line">127.0.0.1:6379&gt; hsetnx myhash f4 1</span><br><span class="line">(<span class="built_in">integer</span>) 0</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><strong>应用</strong></p>
<ul>
<li>用户信息保存</li>
<li>适合对象存储</li>
</ul>
<h4 id="5-zset"><a class="markdownIt-Anchor" href="#5-zset"></a> 5 Zset</h4>
<blockquote>
<p>有序的set</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 添加值 </span></span><br><span class="line">127.0.0.1:6379&gt; zadd myzset 1 a</span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br><span class="line">127.0.0.1:6379&gt; zadd myzset 2 b</span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br><span class="line">127.0.0.1:6379&gt; zadd myzset 3 c</span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br><span class="line"><span class="comment"># 显示全部的数据 可以指定范围</span></span><br><span class="line">127.0.0.1:6379&gt; zrangebyscore myzset -inf +inf </span><br><span class="line">1) <span class="string">&quot;a&quot;</span></span><br><span class="line">2) <span class="string">&quot;b&quot;</span></span><br><span class="line">3) <span class="string">&quot;c&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 显示小于100的数据</span></span><br><span class="line">127.0.0.1:6379&gt; zrangebyscore myzset -inf 100 </span><br><span class="line">1) <span class="string">&quot;a&quot;</span></span><br><span class="line">2) <span class="string">&quot;b&quot;</span></span><br><span class="line">3) <span class="string">&quot;c&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 移除元素</span></span><br><span class="line">127.0.0.1:6379&gt; zrem myzhash f1</span><br><span class="line"></span><br><span class="line"><span class="comment"># 获取有序集合中的个数</span></span><br><span class="line">127.0.0.1:6379&gt; zcard myzhash </span><br><span class="line"></span><br><span class="line"><span class="comment"># 从大到小排序</span></span><br><span class="line">127.0.0.1:6379&gt; zrevrange myzhash 0 -1</span><br><span class="line"></span><br><span class="line"><span class="comment"># 获得指定区间的成员数量</span></span><br><span class="line">127.0.0.1:6379&gt; zcpunt myzhash 0 3</span><br></pre></td></tr></table></figure>
<p><strong>场景</strong></p>
<ul>
<li>消息，带权重判断</li>
<li>排行榜</li>
<li>TOP N</li>
</ul>
<h4 id="6-geospatial"><a class="markdownIt-Anchor" href="#6-geospatial"></a> 6 geospatial</h4>
<blockquote>
<p>地理位置，附近的人</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 添加经纬度</span></span><br><span class="line">127.0.0.1:6379&gt; geoadd china:city 116.40 39.40 beijing</span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br><span class="line">127.0.0.1:6379&gt; geoadd china:city 121.47 31.23 shanghai</span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br><span class="line">127.0.0.1:6379&gt; geoadd china:city 106.50 29.53 chongqing</span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br><span class="line">127.0.0.1:6379&gt; geoadd china:city 120.16 30.24 hangzhou</span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br><span class="line"></span><br><span class="line"><span class="comment"># 获取指定</span></span><br><span class="line">127.0.0.1:6379&gt; geopos china:city beijing</span><br><span class="line">   1) <span class="string">&quot;116.39999896287918091&quot;</span></span><br><span class="line">   2) <span class="string">&quot;39.40000099577971326&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 定位距离(千米)</span></span><br><span class="line">geodist china:city beijing shanghai km</span><br><span class="line"></span><br><span class="line"><span class="comment"># “附近的人” 以给定的经纬度为圆心找到附近的</span></span><br><span class="line"><span class="comment"># 查询110 30 为圆心 半径1000km的key</span></span><br><span class="line">127.0.0.1:6379&gt; georadius china:city 110 30 1000 km</span><br><span class="line">1) <span class="string">&quot;chongqing&quot;</span></span><br><span class="line">2) <span class="string">&quot;hangzhou&quot;</span></span><br><span class="line"><span class="comment"># 附加直线距离信息</span></span><br><span class="line">127.0.0.1:6379&gt; georadius china:city 110 30 1000 km withdist</span><br><span class="line">1) 1) <span class="string">&quot;chongqing&quot;</span></span><br><span class="line">   2) <span class="string">&quot;341.9374&quot;</span></span><br><span class="line">2) 1) <span class="string">&quot;hangzhou&quot;</span></span><br><span class="line">   2) <span class="string">&quot;977.5143&quot;</span></span><br><span class="line"><span class="comment"># 附加经纬度</span></span><br><span class="line">127.0.0.1:6379&gt; georadius china:city 110 30 1000 km withcoord</span><br><span class="line"><span class="comment"># 限制数量</span></span><br><span class="line">127.0.0.1:6379&gt; georadius china:city 110 30 1000 km withcoord count 1</span><br><span class="line"></span><br><span class="line"><span class="comment">#  找出指定元素的其他元素</span></span><br><span class="line">georadiusbymember china：city beijing 1000 km</span><br><span class="line"></span><br><span class="line"><span class="comment"># 将二维经纬度转化为一位的hash，字符串越接近，距离越近</span></span><br><span class="line">genhash china:city beijing chongqing</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用Zset操作geo</span></span><br><span class="line">zrange china:city 0 -1</span><br><span class="line"></span><br><span class="line"><span class="comment"># 移除元素</span></span><br><span class="line">zrem china:city beijing</span><br></pre></td></tr></table></figure>
<h4 id="7-hyperloglog"><a class="markdownIt-Anchor" href="#7-hyperloglog"></a> 7 Hyperloglog</h4>
<blockquote>
<p>基数统计。内存小，2^64不同的元素，需要12kb内存，有0.81%的错误率</p>
</blockquote>
<p><strong>什么是基数？</strong></p>
<blockquote>
<p>不重复的元素</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建第一组元素</span></span><br><span class="line">127.0.0.1:6379&gt; pfadd mykey 1 2 3 4 5 6 7 8 9 10</span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br><span class="line">127.0.0.1:6379&gt; pfadd mykey2 1  3  5  7  9 </span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br><span class="line"><span class="comment"># 统计基数数量</span></span><br><span class="line">127.0.0.1:6379&gt; pfcount mykey</span><br><span class="line">(<span class="built_in">integer</span>) 10</span><br><span class="line">127.0.0.1:6379&gt; pfcount mykey2</span><br><span class="line">(<span class="built_in">integer</span>) 5</span><br><span class="line"><span class="comment"># 合并两组</span></span><br><span class="line">127.0.0.1:6379&gt; pfmerge mykey3 mykey1 mykey2</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; pfcount mykey3</span><br><span class="line">(<span class="built_in">integer</span>) 5</span><br></pre></td></tr></table></figure>
<h4 id="8-bitmaps"><a class="markdownIt-Anchor" href="#8-bitmaps"></a> 8 Bitmaps</h4>
<blockquote>
<p>位存储，数据结构，操作二进制来进行记录，只有0和1两种状态</p>
</blockquote>
<p><strong>应用</strong></p>
<ul>
<li>统计用户信息，活跃，不活跃</li>
<li>登录，未登录</li>
<li>两个状态的</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 记录打卡状态</span></span><br><span class="line">127.0.0.1:6379&gt; setbit sign 0 1</span><br><span class="line">(<span class="built_in">integer</span>) 0</span><br><span class="line">127.0.0.1:6379&gt; setbit sign 1 1</span><br><span class="line">(<span class="built_in">integer</span>) 0</span><br><span class="line">127.0.0.1:6379&gt; setbit sign 2 0</span><br><span class="line">(<span class="built_in">integer</span>) 0</span><br><span class="line"><span class="comment"># 查看某一天打卡没</span></span><br><span class="line">127.0.0.1:6379&gt; getbit sign 2</span><br><span class="line">(<span class="built_in">integer</span>) 0</span><br><span class="line">127.0.0.1:6379&gt; getbit sign 1</span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br><span class="line"><span class="comment"># 统计打卡记录</span></span><br><span class="line">127.0.0.1:6379&gt; bitcount sign</span><br><span class="line">(<span class="built_in">integer</span>) 2</span><br></pre></td></tr></table></figure>
<h3 id="6-事务"><a class="markdownIt-Anchor" href="#6-事务"></a> 6 事务</h3>
<blockquote>
<p>Redis单条命令是保存原子性的，但是事物不保证原子性</p>
<p>Redis事物的本质是一组命令的集合，一个事物中的所有命令都会被序列化，按照顺序执行</p>
<p>一次性、顺序性、排他行</p>
<p>Redis事物没有隔离级别的概念</p>
</blockquote>
<p><strong>redis事务</strong></p>
<ul>
<li>开启事务（multi）</li>
<li>命令入队(…)</li>
<li>执行事务(exec)</li>
</ul>
<h4 id="1-执行事务"><a class="markdownIt-Anchor" href="#1-执行事务"></a> 1 执行事务</h4>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; multi 开启事物</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; <span class="built_in">set</span> 1 1</span><br><span class="line">QUEUED</span><br><span class="line">127.0.0.1:6379&gt; <span class="built_in">set</span> 2 2</span><br><span class="line">QUEUED</span><br><span class="line">127.0.0.1:6379&gt; <span class="built_in">set</span> 3 3</span><br><span class="line">QUEUED</span><br><span class="line">127.0.0.1:6379&gt; <span class="built_in">exec</span> 执行事物</span><br><span class="line">1) OK</span><br><span class="line">2) OK</span><br><span class="line">3) OK</span><br></pre></td></tr></table></figure>
<h4 id="2-取消事务"><a class="markdownIt-Anchor" href="#2-取消事务"></a> 2 取消事务</h4>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">DISCARD 事务中的队列都不会执行</span><br><span class="line"></span><br><span class="line">127.0.0.1:6379&gt; multi</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; <span class="built_in">set</span> 4 4 </span><br><span class="line">QUEUED</span><br><span class="line">127.0.0.1:6379&gt; <span class="built_in">set</span> 5 5</span><br><span class="line">QUEUED</span><br><span class="line">127.0.0.1:6379&gt; discard</span><br><span class="line">OK</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h4 id="3-命令有错事务中所有的命令都不会被执行"><a class="markdownIt-Anchor" href="#3-命令有错事务中所有的命令都不会被执行"></a> 3 命令有错，事务中所有的命令都不会被执行</h4>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; multi </span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; <span class="built_in">set</span> 1 1</span><br><span class="line">QUEUED</span><br><span class="line">127.0.0.1:6379&gt; <span class="built_in">set</span> 2 2</span><br><span class="line">QUEUED</span><br><span class="line">127.0.0.1:6379&gt; <span class="built_in">set</span> 3 3</span><br><span class="line">QUEUED</span><br><span class="line">127.0.0.1:6379&gt; getset 8</span><br><span class="line">(error) ERR wrong number of arguments <span class="keyword">for</span> <span class="string">&#x27;getset&#x27;</span> <span class="built_in">command</span></span><br><span class="line">127.0.0.1:6379&gt; <span class="built_in">set</span> 5 5</span><br><span class="line">QUEUED</span><br><span class="line">127.0.0.1:6379&gt; <span class="built_in">exec</span></span><br><span class="line">(error) EXECABORT Transaction discarded because of previous errors.</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h4 id="4-事务存在语法性执行命令的时候其他命令是可以正常执行的错误的命令会抛出异常"><a class="markdownIt-Anchor" href="#4-事务存在语法性执行命令的时候其他命令是可以正常执行的错误的命令会抛出异常"></a> 4 事务存在语法性，执行命令的时候，其他命令是可以正常执行的，错误的命令会抛出异常</h4>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; <span class="built_in">set</span> 1 <span class="string">&quot;adasd&quot;</span></span><br><span class="line">QUEUED</span><br><span class="line">127.0.0.1:6379&gt; incr 1 </span><br><span class="line">QUEUED</span><br><span class="line">127.0.0.1:6379&gt; <span class="built_in">set</span> 2 2</span><br><span class="line">QUEUED</span><br><span class="line">127.0.0.1:6379&gt; <span class="built_in">exec</span></span><br><span class="line">1) OK</span><br><span class="line">2) (error) ERR value is not an <span class="built_in">integer</span> or out of range</span><br><span class="line">3) OK</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="7-乐观锁"><a class="markdownIt-Anchor" href="#7-乐观锁"></a> 7 乐观锁</h3>
<blockquote>
<ul>
<li>乐观，认为什么时候都不会出现问题，所以不会上锁，更新数据的时候去判断一下，在此期间是否有人修改过这个数据</li>
<li>获取version</li>
<li>更新的时候比较version</li>
</ul>
</blockquote>
<p><strong>正常情况</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; <span class="built_in">set</span> money 100</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; <span class="built_in">set</span> out 0</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; watch money</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; multi </span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; decrby money 20</span><br><span class="line">QUEUED</span><br><span class="line">127.0.0.1:6379&gt; incrby out 20</span><br><span class="line">QUEUED</span><br><span class="line">127.0.0.1:6379&gt; <span class="built_in">exec</span></span><br><span class="line">1) (<span class="built_in">integer</span>) 80</span><br><span class="line">2) (<span class="built_in">integer</span>) 20</span><br></pre></td></tr></table></figure>
<p>多线程修改值之后，监视失败，使用watch可以当做redis的乐观锁操作</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">unwatch  <span class="comment"># 如果事物执行失败就先解锁</span></span><br><span class="line">watch money <span class="comment"># 获取最新的值进行监视</span></span><br></pre></td></tr></table></figure>
<h3 id="8-jedis"><a class="markdownIt-Anchor" href="#8-jedis"></a> 8 Jedis</h3>
<blockquote>
<p>官网推荐的Java连接工具</p>
</blockquote>
<h4 id="1-事物"><a class="markdownIt-Anchor" href="#1-事物"></a> 1 事物</h4>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 创建对象</span></span><br><span class="line">Jedis jedis = <span class="keyword">new</span> Jedis(<span class="string">&quot;42.193.118.181&quot;</span>, <span class="number">6379</span>);</span><br><span class="line">Transaction multi = jedis.multi();</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    jedis.set(<span class="string">&quot;user1&quot;</span>, <span class="string">&quot;1&quot;</span>);</span><br><span class="line">    jedis.set(<span class="string">&quot;user1&quot;</span>, <span class="string">&quot;2&quot;</span>);</span><br><span class="line">    <span class="comment">// 执行事物</span></span><br><span class="line">    multi.exec();</span><br><span class="line">&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">    <span class="comment">// 放弃事物</span></span><br><span class="line">    multi.discard();</span><br><span class="line">    e.printStackTrace();</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>
<h3 id="9-springboot整合"><a class="markdownIt-Anchor" href="#9-springboot整合"></a> 9 SpringBoot整合</h3>
<blockquote>
<p>SpringBoot 2.X之后，jedis被替换了为lettuce</p>
<p>jedis采用直连，多个线程操作的话是不安全的，如果想要避免不安全，使用jedispoolianjiechi1，bio</p>
<p>lettuce：采用netty，实例可以再多个线程中共享，不存在线程不安全的情况，可以减少线程数据NIO</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">	&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">	&lt;artifactId&gt;spring-boot-starter-data-redis&lt;/artifactId&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure>
<p><strong>源码配置</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration(proxyBeanMethods = false)</span></span><br><span class="line"><span class="meta">@ConditionalOnClass(RedisOperations.class)</span></span><br><span class="line"><span class="meta">@EnableConfigurationProperties(RedisProperties.class)</span></span><br><span class="line"><span class="meta">@Import(&#123; LettuceConnectionConfiguration.class, JedisConnectionConfiguration.class &#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RedisAutoConfiguration</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Bean</span></span><br><span class="line">	<span class="meta">@ConditionalOnMissingBean(name = &quot;redisTemplate&quot;)</span></span><br><span class="line">	<span class="meta">@ConditionalOnSingleCandidate(RedisConnectionFactory.class)</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> RedisTemplate&lt;Object, Object&gt; <span class="title">redisTemplate</span><span class="params">(RedisConnectionFactory redisConnectionFactory)</span> </span>&#123;</span><br><span class="line">		RedisTemplate&lt;Object, Object&gt; template = <span class="keyword">new</span> RedisTemplate&lt;&gt;();</span><br><span class="line">		template.setConnectionFactory(redisConnectionFactory);</span><br><span class="line">		<span class="keyword">return</span> template;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Bean</span></span><br><span class="line">	<span class="meta">@ConditionalOnMissingBean</span></span><br><span class="line">	<span class="meta">@ConditionalOnSingleCandidate(RedisConnectionFactory.class)</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> StringRedisTemplate <span class="title">stringRedisTemplate</span><span class="params">(RedisConnectionFactory redisConnectionFactory)</span> </span>&#123;</span><br><span class="line">		StringRedisTemplate template = <span class="keyword">new</span> StringRedisTemplate();</span><br><span class="line">		template.setConnectionFactory(redisConnectionFactory);</span><br><span class="line">		<span class="keyword">return</span> template;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><strong>序列化</strong></p>
<blockquote>
<p>如果对象不实现Serializable接口直接写入会报错</p>
</blockquote>
<h4 id="1-自定义redistemplate"><a class="markdownIt-Anchor" href="#1-自定义redistemplate"></a> 1 自定义RedisTemplate</h4>
<p><strong>略</strong></p>
<h3 id="10-redisconf详解"><a class="markdownIt-Anchor" href="#10-redisconf详解"></a> 10 redis.conf详解</h3>
<h4 id="1-设置密码"><a class="markdownIt-Anchor" href="#1-设置密码"></a> 1 设置密码</h4>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 获取密码</span></span><br><span class="line">config get requirepass</span><br><span class="line"><span class="comment"># 设置密码</span></span><br><span class="line">config <span class="built_in">set</span> requirepass <span class="string">&quot;123456&quot;</span></span><br><span class="line"><span class="comment"># 登录</span></span><br><span class="line">auth 123456</span><br></pre></td></tr></table></figure>
<blockquote>
<p>redis配置文件对大小写不敏感</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 不同redis server可以使用同一个模版配置作为主配置，并引用其它配置文件用于本server的个性# 化设置</span></span><br><span class="line"><span class="comment"># include并不会被CONFIG REWRITE命令覆盖。但是主配置文件的选项会被覆盖。</span></span><br><span class="line"><span class="comment"># 想故意覆盖主配置的话就把include放文件前面，否则最好放末尾</span></span><br><span class="line"><span class="comment"># include /path/to/local.conf</span></span><br><span class="line"><span class="comment"># include /path/to/other.conf</span></span><br><span class="line"></span><br><span class="line"><span class="comment">######################### 网络 #########################</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 不指定bind的话redis将会监听所有网络接口。这个配置是肯定需要指定的。</span></span><br><span class="line"><span class="comment"># Examples:</span></span><br><span class="line"><span class="comment"># bind 192.168.1.100 10.0.0.1</span></span><br><span class="line"><span class="comment"># bind 127.0.0.1 ::1</span></span><br><span class="line"><span class="comment"># 下面这个配置是只允许本地客户端访问。</span></span><br><span class="line"><span class="built_in">bind</span> 127.0.0.1</span><br><span class="line"></span><br><span class="line"><span class="comment"># 是否开启保护模式。默认开启，如果没有设置bind项的ip和redis密码的话，服务将只允许本地访 问。</span></span><br><span class="line">protected-mode yes</span><br><span class="line"></span><br><span class="line"><span class="comment"># 端口设置，默认为 6379</span></span><br><span class="line"><span class="comment"># 如果port设置为0 redis将不会监听tcp socket</span></span><br><span class="line">port 6379</span><br><span class="line"></span><br><span class="line"><span class="comment"># 在高并发环境下需要一个高backlog值来避免慢客户端连接问题。注意Linux内核默默将这个值减小到/proc/sys/net/core/somaxconn的值，所以需要确认增大somaxconn和tcp_max_syn_backlog 两个值来达到需要的效果。</span></span><br><span class="line">tcp-backlog 511</span><br><span class="line"></span><br><span class="line"><span class="comment"># 指定用来监听Unix套套接字的路径。没有默认值，没有指定的情况下Redis不会监听Unix socket</span></span><br><span class="line"><span class="comment"># unixsocket /tmp/redis.sock</span></span><br><span class="line"><span class="comment"># unixsocketperm 700</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 客户端空闲多少秒后关闭连接（0为不关闭）timeout 0# tcp-keepalive设置。如果非零，则设置SO_KEEPALIVE选项来向空闲连接的客户端发送ACK，用途如下：</span></span><br><span class="line"><span class="comment"># 1）能够检测无响应的对端</span></span><br><span class="line"><span class="comment"># 2）让该连接中间的网络设备知道这个连接还存活</span></span><br><span class="line"><span class="comment"># 在Linux上，这个指定的值(单位秒)就是发送ACK的时间间隔。</span></span><br><span class="line"><span class="comment"># 注意：要关闭这个连接需要两倍的这个时间值。</span></span><br><span class="line"><span class="comment"># 在其他内核上这个时间间隔由内核配置决定# 从redis3.2.1开始默认值为300秒</span></span><br><span class="line">tcp-keepalive 300</span><br><span class="line"></span><br><span class="line"><span class="comment">######################### 通用 #########################</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 是否将Redis作为守护进程运行。如果需要的话配置成&#x27;yes&#x27;</span></span><br><span class="line"><span class="comment"># 注意配置成守护进程后Redis会将进程号写入文件/var/run/redis.pid</span></span><br><span class="line">daemonize no</span><br><span class="line"></span><br><span class="line"><span class="comment"># 是否通过upstart或systemd管理守护进程。默认no没有服务监控，其它选项有upstart, systemd, auto</span></span><br><span class="line">supervised no</span><br><span class="line"></span><br><span class="line"><span class="comment"># pid文件在redis启动时创建，退出时删除。最佳实践为配置该项。</span></span><br><span class="line">pidfile /var/run/redis_6379.pid</span><br><span class="line"></span><br><span class="line"><span class="comment"># 配置日志级别。选项有debug, verbose, notice, warning</span></span><br><span class="line">loglevel notice</span><br><span class="line"></span><br><span class="line"><span class="comment"># 日志名称。空字符串表示标准输出。注意如果redis配置为后台进程，标准输出中信息会发送到/dev/null</span></span><br><span class="line">logfile <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 是否启动系统日志记录。</span></span><br><span class="line"><span class="comment"># syslog-enabled no</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 指定系统日志身份。</span></span><br><span class="line"><span class="comment"># syslog-ident redis</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 指定syslog设备。必须是user或LOCAL0 ~ LOCAL7之一。</span></span><br><span class="line"><span class="comment"># syslog-facility local0</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置数据库个数。默认数据库是 DB 0</span></span><br><span class="line"><span class="comment"># 可以通过SELECT where dbid is a number between 0 and &#x27;databases&#x27;-1为每个连接使用不同的数据库。</span></span><br><span class="line">databases 16</span><br><span class="line"></span><br><span class="line"><span class="comment"># 是否显示log</span></span><br><span class="line">always-show-logo yes</span><br><span class="line"></span><br><span class="line"><span class="comment">######################### 备份  #########################</span></span><br><span class="line"><span class="comment"># 持久化设置:</span></span><br><span class="line"><span class="comment"># 下面的例子将会进行把数据写入磁盘的操作:</span></span><br><span class="line"><span class="comment">#  900秒（15分钟）之后，且至少1次变更 进行持久化操作</span></span><br><span class="line"><span class="comment">#  300秒（5分钟）之后，且至少10次变更 进行持久化操作</span></span><br><span class="line"><span class="comment">#  60秒之后，且至少10000次变更 进行持久化操作</span></span><br><span class="line"><span class="comment"># 不写磁盘的话就把所有 &quot;save&quot; 设置注释掉就行了。</span></span><br><span class="line"><span class="comment"># 通过添加一条带空字符串参数的save指令也能移除之前所有配置的save指令，如: save &quot;&quot;</span></span><br><span class="line">save 900 1</span><br><span class="line">save 300 10</span><br><span class="line">save 60 10000</span><br><span class="line"></span><br><span class="line"><span class="comment"># 默认情况下如果上面配置的RDB模式开启且最后一次的保存失败，redis 将停止接受写操作，让用户知道问题的发生。</span></span><br><span class="line"><span class="comment"># 如果后台保存进程重新启动工作了，redis 也将自动的允许写操作。如果有其它监控方式也可关闭。</span></span><br><span class="line"><span class="comment"># 持久化操作出错了,是否需要继续工作</span></span><br><span class="line">stop-writes-on-bgsave-error yes</span><br><span class="line"></span><br><span class="line"><span class="comment"># 是否在备份.rdb文件时是否用LZF压缩字符串，默认设置为yes。如果想节约cpu资源可以把它设置为no。</span></span><br><span class="line"><span class="comment"># 是否压缩rdb文件</span></span><br><span class="line">rdbcompression yes</span><br><span class="line"></span><br><span class="line"><span class="comment"># 因为版本5的RDB有一个CRC64算法的校验和放在了文件的末尾。这将使文件格式更加可靠,</span></span><br><span class="line"><span class="comment"># 但在生产和加载RDB文件时，这有一个性能消耗(大约10%)，可以关掉它来获取最好的性能。</span></span><br><span class="line"><span class="comment"># 生成的关闭校验的RDB文件有一个0的校验和，它将告诉加载代码跳过检查rdbchecksum yes</span></span><br><span class="line"><span class="comment"># rdb文件名称</span></span><br><span class="line">dbfilename dump.rdb</span><br><span class="line"></span><br><span class="line"><span class="comment"># 保存rdb文件的时候,进行校验检查</span></span><br><span class="line">rdbchecksum yes</span><br><span class="line"></span><br><span class="line"><span class="comment"># 备份文件目录，文件名就是上面的 &quot;dbfilename&quot; 的值。累加文件也放这里。</span></span><br><span class="line"><span class="comment"># 注意你这里指定的必须是目录，不是文件名。</span></span><br><span class="line">dir /Users/wuji/redis_data/</span><br><span class="line"></span><br><span class="line"><span class="comment">######################### 主从同步 #########################</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 主从同步配置。</span></span><br><span class="line"><span class="comment"># 1) redis主从同步是异步的，但是可以配置在没有指定slave连接的情况下使master停止写入数据。</span></span><br><span class="line"><span class="comment"># 2) 连接中断一定时间内，slave可以执行部分数据重新同步。</span></span><br><span class="line"><span class="comment"># 3) 同步是自动的，slave可以自动重连且同步数据。</span></span><br><span class="line"><span class="comment"># slaveof &lt;masterip&gt; &lt;masterport&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># master连接密码</span></span><br><span class="line"><span class="comment"># masterauth &lt;master-password&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 当一个slave失去和master的连接，或者同步正在进行中，slave的行为有两种可能：</span></span><br><span class="line"><span class="comment"># 1) 如果 slave-serve-stale-data 设置为 &quot;yes&quot; (默认值)，slave会继续响应客户端请求，可能是正常数据，也可能是还没获得值的空数据。</span></span><br><span class="line"><span class="comment"># 2) 如果 slave-serve-stale-data 设置为 &quot;no&quot;，slave会回复&quot;正在从master同步（SYNC with master in progress）&quot;来处理各种请求，除了 INFO 和 SLAVEOF 命令。</span></span><br><span class="line">slave-serve-stale-data yes</span><br><span class="line"></span><br><span class="line"><span class="comment"># 你可以配置salve实例是否接受写操作。可写的slave实例可能对存储临时数据比较有用(因为写入salve# 的数据在同master同步之后将很容被删除)，但是如果客户端由于配置错误在写入时也可能产生一些问题。</span></span><br><span class="line"><span class="comment"># 从Redis2.6默认所有的slave为只读</span></span><br><span class="line"><span class="comment"># 注意:只读的slave不是为了暴露给互联网上不可信的客户端而设计的。它只是一个防止实例误用的保护层。</span></span><br><span class="line"><span class="comment"># 一个只读的slave支持所有的管理命令比如config,debug等。为了限制你可以用&#x27;rename-command&#x27;来隐藏所有的管理和危险命令来增强只读slave的安全性。</span></span><br><span class="line">slave-read-only yes</span><br><span class="line"></span><br><span class="line"><span class="comment"># 同步策略: 磁盘或socket，默认磁盘方式</span></span><br><span class="line">repl-diskless-sync no</span><br><span class="line"></span><br><span class="line"><span class="comment"># 如果非磁盘同步方式开启，可以配置同步延迟时间，以等待master产生子进程通过socket传输RDB数据给slave。</span></span><br><span class="line"><span class="comment"># 默认值为5秒，设置为0秒则每次传输无延迟。</span></span><br><span class="line">repl-diskless-sync-delay 5</span><br><span class="line"></span><br><span class="line"><span class="comment"># slave根据指定的时间间隔向master发送ping请求。默认10秒。</span></span><br><span class="line"><span class="comment"># repl-ping-slave-period 10</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 同步的超时时间</span></span><br><span class="line"><span class="comment"># 1）slave在与master SYNC期间有大量数据传输，造成超时</span></span><br><span class="line"><span class="comment"># 2）在slave角度，master超时，包括数据、ping等</span></span><br><span class="line"><span class="comment"># 3）在master角度，slave超时，当master发送REPLCONF ACK pings# 确保这个值大于指定的repl-ping-slave-period，否则在主从间流量不高时每次都会检测到超时</span></span><br><span class="line"><span class="comment"># repl-timeout 60</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 是否在slave套接字发送SYNC之后禁用 TCP_NODELAY</span></span><br><span class="line"><span class="comment"># 如果选择yes，Redis将使用更少的TCP包和带宽来向slaves发送数据。但是这将使数据传输到slave上有延迟，Linux内核的默认配置会达到40毫秒。</span></span><br><span class="line"><span class="comment"># 如果选择no，数据传输到salve的延迟将会减少但要使用更多的带宽。</span></span><br><span class="line"><span class="comment"># 默认我们会为低延迟做优化，但高流量情况或主从之间的跳数过多时，可以设置为“yes”。</span></span><br><span class="line">repl-disable-tcp-nodelay no</span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置数据备份的backlog大小。backlog是一个slave在一段时间内断开连接时记录salve数据的缓冲，所以一个slave在重新连接时，不必要全量的同步，而是一个增量同步就足够了，将在断开连接的这段# 时间内把slave丢失的部分数据传送给它。</span></span><br><span class="line"><span class="comment"># 同步的backlog越大，slave能够进行增量同步并且允许断开连接的时间就越长。</span></span><br><span class="line"><span class="comment"># backlog只分配一次并且至少需要一个slave连接。</span></span><br><span class="line"><span class="comment"># repl-backlog-size 1mb</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 当master在一段时间内不再与任何slave连接，backlog将会释放。以下选项配置了从最后一个</span></span><br><span class="line"><span class="comment"># slave断开开始计时多少秒后，backlog缓冲将会释放。</span></span><br><span class="line"><span class="comment"># 0表示永不释放backlog</span></span><br><span class="line"><span class="comment"># repl-backlog-ttl 3600</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># slave的优先级是一个整数展示在Redis的Info输出中。如果master不再正常工作了，sentinel将用它来选择一个slave提升为master。</span></span><br><span class="line"><span class="comment"># 优先级数字小的salve会优先考虑提升为master，所以例如有三个slave优先级分别为10，100，25，sentinel将挑选优先级最小数字为10的slave。</span></span><br><span class="line"><span class="comment"># 0作为一个特殊的优先级，标识这个slave不能作为master，所以一个优先级为0的slave永远不会被# sentinel挑选提升为master。</span></span><br><span class="line"><span class="comment"># 默认优先级为100</span></span><br><span class="line">slave-priority 100</span><br><span class="line"></span><br><span class="line"><span class="comment"># 如果master少于N个延时小于等于M秒的已连接slave，就可以停止接收写操作。</span></span><br><span class="line"><span class="comment"># N个slave需要是“oneline”状态。</span></span><br><span class="line"><span class="comment"># 延时是以秒为单位，并且必须小于等于指定值，是从最后一个从slave接收到的ping（通常每秒发送）开始计数。</span></span><br><span class="line"><span class="comment"># 该选项不保证N个slave正确同步写操作，但是限制数据丢失的窗口期。</span></span><br><span class="line"><span class="comment"># 例如至少需要3个延时小于等于10秒的slave用下面的指令：</span></span><br><span class="line"><span class="comment"># min-slaves-to-write 3</span></span><br><span class="line"><span class="comment"># min-slaves-max-lag 10</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 两者之一设置为0将禁用这个功能。</span></span><br><span class="line"><span class="comment"># 默认 min-slaves-to-write 值是0（该功能禁用）并且 min-slaves-max-lag 值是10。</span></span><br><span class="line"></span><br><span class="line"><span class="comment">######################### 安全 #########################</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 要求客户端在处理任何命令时都要验证身份和密码。</span></span><br><span class="line"><span class="comment"># requirepass foobared</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 命令重命名</span></span><br><span class="line"><span class="comment"># 在共享环境下，可以为危险命令改变名字。比如，你可以为 CONFIG 改个其他不太容易猜到的名字，这样内部的工具仍然可以使用。</span></span><br><span class="line"><span class="comment"># 例如：</span></span><br><span class="line"><span class="comment"># rename-command CONFIG b840fc02d524045429941cc15f59e41cb7be6c52</span></span><br><span class="line"><span class="comment"># 也可以通过改名为空字符串来完全禁用一个命令</span></span><br><span class="line"><span class="comment"># rename-command CONFIG &quot;&quot;</span></span><br><span class="line"><span class="comment"># 请注意：改变命令名字被记录到AOF文件或被传送到从服务器可能产生问题。</span></span><br><span class="line"></span><br><span class="line"><span class="comment">######################### 限制 客户端#########################</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置最多同时连接的客户端数量。默认这个限制是10000个客户端，然而如果Redis服务器不能配置</span></span><br><span class="line"><span class="comment"># 处理文件的限制数来满足指定的值，那么最大的客户端连接数就被设置成当前文件限制数减32（因为Redis服务器保留了一些文件描述符作为内部使用）</span></span><br><span class="line"><span class="comment"># 一旦达到这个限制，Redis会关闭所有新连接并发送错误&#x27;max number of clients reached&#x27;</span></span><br><span class="line"><span class="comment"># maxclients 10000</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 不要使用比设置的上限更多的内存。一旦内存使用达到上限，Redis会根据选定的回收策略（参见：maxmemmory-policy）删除key。</span></span><br><span class="line"><span class="comment"># 如果因为删除策略Redis无法删除key，或者策略设置为 &quot;noeviction&quot;，Redis会回复需要更多内存的错误信息给命令。例如，SET,LPUSH等等，但是会继续响应像Get这样的只读命令。</span></span><br><span class="line"><span class="comment"># 在使用Redis作为LRU缓存，或者为实例设置了硬性内存限制的时候（使用 &quot;noeviction&quot; 策略）</span></span><br><span class="line">的时候，这个选项通常事很有用的。</span><br><span class="line"><span class="comment"># 警告：当有多个slave连上达到内存上限时，master为同步slave的输出缓冲区所需内存不计算在使用内存中。这样当移除key时，就不会因网络问题 / 重新同步事件触发移除key的循环，反过来slaves的输出缓冲区充满了key被移除的DEL命令，这将触发删除更多的key，直到这个数据库完全被清空为止。</span></span><br><span class="line"><span class="comment"># 总之，如果你需要附加多个slave，建议你设置一个稍小maxmemory限制，这样系统就会有空闲的内存作为slave的输出缓存区(但是如果最大内存策略设置为&quot;noeviction&quot;的话就没必要了)</span></span><br><span class="line"><span class="comment"># maxmemory &lt;bytes&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 最大内存策略：如果达到内存限制了，Redis如何选择删除key。</span></span><br><span class="line"><span class="comment"># volatile-lru -&gt; 根据LRU算法删除设置过期时间的key</span></span><br><span class="line"><span class="comment"># allkeys-lru -&gt; 根据LRU算法删除任何key</span></span><br><span class="line"><span class="comment"># volatile-random -&gt; 随机移除设置过过期时间的key</span></span><br><span class="line"><span class="comment"># allkeys-random -&gt; 随机移除任何key</span></span><br><span class="line"><span class="comment"># volatile-ttl -&gt; 移除即将过期的key(minor TTL)</span></span><br><span class="line"><span class="comment"># noeviction -&gt; 不移除任何key，只返回一个写错误</span></span><br><span class="line"><span class="comment"># 注意：对所有策略来说，如果Redis找不到合适的可以删除的key都会在写操作时返回一个错误。# 目前为止涉及的命令：set setnx setex append incr decr rpush lpush rpushx lpushx linsert lset rpoplpush sadd sinter sinterstore sunion sunionstore sdiff sdiffstore zadd zincrby zunionstore zinterstore hset hsetnx hmset hincrby incrby decrby getset mset msetnx exec sort</span></span><br><span class="line"><span class="comment"># 默认策略:</span></span><br><span class="line"><span class="comment"># maxmemory-policy noeviction</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># LRU和最小TTL算法的实现都不是很精确，但是很接近（为了省内存），所以你可以用样本量做检测。 例如：默认Redis会检查3个key然后取最旧的那个，你可以通过下面的配置指令来设置样本的个数。</span></span><br><span class="line"><span class="comment"># 默认值为5，数字越大结果越精确但是会消耗更多CPU。</span></span><br><span class="line"><span class="comment"># maxmemory-samples 5</span></span><br><span class="line"></span><br><span class="line"><span class="comment">######################### APPEND ONLY MODE ######################### aof</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 默认情况下，Redis是异步的把数据导出到磁盘上。这种模式在很多应用里已经足够好，但Redis进程出问题或断电时可能造成一段时间的写操作丢失(这取决于配置的save指令)。</span></span><br><span class="line"><span class="comment"># AOF是一种提供了更可靠的替代持久化模式，例如使用默认的数据写入文件策略（参见后面的配置）。</span></span><br><span class="line"><span class="comment"># 在遇到像服务器断电或单写情况下Redis自身进程出问题但操作系统仍正常运行等突发事件时，Redis能只丢失1秒的写操作。</span></span><br><span class="line"><span class="comment"># AOF和RDB持久化能同时启动并且不会有问题。</span></span><br><span class="line"><span class="comment"># 如果AOF开启，那么在启动时Redis将加载AOF文件，它更能保证数据的可靠性。</span></span><br><span class="line">appendonly no</span><br><span class="line"></span><br><span class="line"><span class="comment"># AOF文件名（默认：&quot;appendonly.aof&quot;）</span></span><br><span class="line">appendfilename <span class="string">&quot;appendonly.aof&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># fsync() 系统调用告诉操作系统把数据写到磁盘上，而不是等更多的数据进入输出缓冲区。</span></span><br><span class="line"><span class="comment"># 有些操作系统会真的把数据马上刷到磁盘上；有些则会尽快去尝试这么做。</span></span><br><span class="line"><span class="comment"># Redis支持三种不同的模式：</span></span><br><span class="line"><span class="comment"># no：不要立刻刷，只有在操作系统需要刷的时候再刷。比较快。</span></span><br><span class="line"><span class="comment"># always：每次写操作都立刻写入到aof文件。慢，但是最安全。</span></span><br><span class="line"><span class="comment"># everysec：每秒写一次。折中方案。</span></span><br><span class="line"><span class="comment"># 默认的 &quot;everysec&quot; 通常来说能在速度和数据安全性之间取得比较好的平衡。</span></span><br><span class="line"><span class="comment"># appendfsync always</span></span><br><span class="line">appendfsync everysec</span><br><span class="line"><span class="comment"># appendfsync no</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 如果AOF的同步策略设置成 &quot;always&quot; 或者 &quot;everysec&quot;，并且后台的存储进程（后台存储或写入AOF 日志）会产生很多磁盘I/O开销。某些Linux的配置下会使Redis因为 fsync()系统调用而阻塞很久。</span></span><br><span class="line"><span class="comment"># 注意，目前对这个情况还没有完美修正，甚至不同线程的 fsync() 会阻塞我们同步的write(2)调用。</span></span><br><span class="line"><span class="comment"># 为了缓解这个问题，可以用下面这个选项。它可以在 BGSAVE 或 BGREWRITEAOF 处理时阻止fsync()。</span></span><br><span class="line"><span class="comment"># 这就意味着如果有子进程在进行保存操作，那么Redis就处于&quot;不可同步&quot;的状态。</span></span><br><span class="line"><span class="comment"># 这实际上是说，在最差的情况下可能会丢掉30秒钟的日志数据。（默认Linux设定）</span></span><br><span class="line"><span class="comment"># 如果把这个设置成&quot;yes&quot;带来了延迟问题，就保持&quot;no&quot;，这是保存持久数据的最安全的方式。</span></span><br><span class="line">no-appendfsync-on-rewrite no</span><br><span class="line"></span><br><span class="line"><span class="comment"># 自动重写AOF文件。如果AOF日志文件增大到指定百分比，Redis能够通过 BGREWRITEAOF 自动重写AOF日志文件。# 工作原理：Redis记住上次重写时AOF文件的大小（如果重启后还没有写操作，就直接用启动时的AOF大小）</span></span><br><span class="line"><span class="comment"># 这个基准大小和当前大小做比较。如果当前大小超过指定比例，就会触发重写操作。你还需要指定被重写日志的最小尺寸，这样避免了达到指定百分比但尺寸仍然很小的情况还要重写。</span></span><br><span class="line"><span class="comment"># 指定百分比为0会禁用AOF自动重写特性。</span></span><br><span class="line">auto-aof-rewrite-percentage 100</span><br><span class="line">auto-aof-rewrite-min-size 64mb</span><br><span class="line"></span><br><span class="line"><span class="comment"># 如果设置为yes，如果一个因异常被截断的AOF文件被redis启动时加载进内存，redis将会发送日志通知用户。如果设置为no，erdis将会拒绝启动。此时需要用&quot;redis-check-aof&quot;工具修复文件。</span></span><br><span class="line">aof-load-truncated yes</span><br><span class="line"></span><br><span class="line"><span class="comment">######################### 集群 </span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 只有开启了以下选项，redis才能成为集群服务的一部分</span></span><br><span class="line"><span class="comment"># cluster-enabled yes</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 配置redis自动生成的集群配置文件名。确保同一系统中运行的各redis实例该配置文件不要重名。</span></span><br><span class="line"><span class="comment"># cluster-config-file nodes-6379.conf</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 集群节点超时毫秒数。超时的节点将被视为不可用状态。</span></span><br><span class="line"><span class="comment"># cluster-node-timeout 15000</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 如果数据太旧，集群中的不可用master的slave节点会避免成为备用master。如果slave和master失联时间超过:</span></span><br><span class="line"> (node-timeout * slave-validity-factor) + repl-ping-slave-period</span><br><span class="line">则不会被提升为master。</span><br><span class="line"><span class="comment"># 如node-timeout为30秒，slave-validity-factor为10, 默认default repl-ping-slave-period为10秒,失联时间超过310秒slave就不会成为master。</span></span><br><span class="line"><span class="comment"># 较大的slave-validity-factor值可能允许包含过旧数据的slave成为master，同时较小的值可能会阻止集群选举出新master。</span></span><br><span class="line"><span class="comment">#为了达到最大限度的高可用性，可以设置为0，即slave不管和master失联多久都可以提升为master</span></span><br><span class="line"><span class="comment"># cluster-slave-validity-factor 10</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 只有在之前master有其它指定数量的工作状态下的slave节点时，slave节点才能提升为master。默认为1（即该集群至少有3个节点，1 master＋2 slaves，master宕机，仍有另外1个slave的情况下其中1个slave可以提升）</span></span><br><span class="line"><span class="comment"># 测试环境可设置为0，生成环境中至少设置为1</span></span><br><span class="line"><span class="comment"># cluster-migration-barrier 1</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 默认情况下如果redis集群如果检测到至少有1个hash slot不可用，集群将停止查询数据。</span></span><br><span class="line"><span class="comment"># 如果所有slot恢复则集群自动恢复。</span></span><br><span class="line"><span class="comment"># 如果需要集群部分可用情况下仍可提供查询服务，设置为no。</span></span><br><span class="line"><span class="comment"># cluster-require-full-coverage yes</span></span><br><span class="line"></span><br><span class="line"><span class="comment">######################### 慢查询日志 #########################</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 慢查询日志，记录超过多少微秒的查询命令。查询的执行时间不包括客户端的IO执行和网络通信时间，只是查询命令执行时间。</span></span><br><span class="line"><span class="comment"># 1000000等于1秒，设置为0则记录所有命令</span></span><br><span class="line">slowlog-log-slower-than 10000</span><br><span class="line"></span><br><span class="line"><span class="comment"># 记录大小，可通过SLOWLOG RESET命令重置</span></span><br><span class="line">slowlog-max-len 128</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="11-redis-持久化"><a class="markdownIt-Anchor" href="#11-redis-持久化"></a> 11 Redis 持久化</h3>
<h4 id="1-rdb"><a class="markdownIt-Anchor" href="#1-rdb"></a> 1 RDB</h4>
<p>生产环境备份rdb</p>
<p><img src= "/img/loading.gif" data-lazy-src="https://upload-images.jianshu.io/upload_images/10939682-807dfdd5195f9d20.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1200/format/webp" alt="图片来源简书"></p>
<blockquote>
<p>在指定的时间间隔中,将内存中的数据集快照写入磁盘,恢复的时候,将快照文件直接读取到内存中</p>
<p>Redis会单独创建(fork)一个子进程来进行持久化,会线将数据写入到一个临时文件中,待持久化过程都结束了,再用这个临时文件替换上次持久化好的文件,整个过程中,主进程是不做任何IO操作的,这就确保了极高的性能,如果需要进行大规模的数据恢复,且对于数据恢复的完整性不是非常敏感,那RDB的方式要比AOF的方式更加高效,RDB的缺点是最后一次持久化数据可能会丢失</p>
</blockquote>
<p><strong>触发机制</strong></p>
<ul>
<li>save 的规则满足的情况下,自动出发rdb规则</li>
<li>执行flushall 命令,也会出发rdb规则</li>
<li>退出redis也会生成rdb文件</li>
</ul>
<p><strong>恢复rdb文件</strong></p>
<ul>
<li>只要将rdb文件放在redis的启动目录就可以,redis启动的时候会自动检查dump.rdb恢复其中的数据</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看配文件的位置</span></span><br><span class="line">config get dir</span><br><span class="line"><span class="comment"># 如果在dir目录下存在rdb文件,那么在启动的时候会自动恢复其中的数据</span></span><br></pre></td></tr></table></figure>
<p><strong>优点:</strong></p>
<ol>
<li>适合大规模数据恢复</li>
<li>如果对数据的完整性要求不高</li>
</ol>
<p><strong>缺点:</strong></p>
<ol>
<li>
<p>需要一定的时间间隔进程操作,如果redis宕机了,这个最后一次修改的数据就没了</p>
</li>
<li>
<p>fork进程的时候,会占用一定的内容空间</p>
</li>
</ol>
<h4 id="2-aofappend-only-file"><a class="markdownIt-Anchor" href="#2-aofappend-only-file"></a> 2 AOF(Append Only File)</h4>
<p>将我们的所有命令都记录下来,history,恢复的时候就把这个文件全部执行一遍</p>
<p><img src= "/img/loading.gif" data-lazy-src="/2020/12/26/Redis%E5%9F%BA%E7%A1%80%E5%85%A5%E9%97%A8/image-20201227183918572.png" alt="image-20201227183918572"></p>
<blockquote>
<p>以日志的形式记录每个写操作,将Redis执行过的命令记录写来(读操作不记录)，只许追加文件但不可以改写文件，redis启动之初会读取该文件重新构建数据，换言之，redis重启的话就根据日志文件的内容将写指令从前到后执行一次以完成数据的恢复工作</p>
</blockquote>
<p><code>AOF保存的是 appendonly.aof</code></p>
<p>默认不开启，需要手动配置，将配置文件appendonly改为yes就开启了aof</p>
<p>如果这个apf文件有错位，redis会启动失败，我们需要修复这个文件</p>
<p>redis给我们体用了一个工具 <code>redis-check-aof --fix appendonly.aof</code></p>
<p>如果文件正常，重启就可以恢复</p>
<blockquote>
<p>重写规则，如果AOF文件大于64m，太大了，fork一个新的进程来进行文件的重写</p>
</blockquote>
<p><strong>优点：</strong></p>
<ol>
<li>每一次修改都同步，文件的完整性会更好</li>
<li>每秒同步一次，可能会丢失一秒的数据</li>
<li>从不同步，效率是最高的</li>
</ol>
<p><strong>缺点：</strong></p>
<ol>
<li>相对于数据文件来说，aof远远大于rdb，修复速度也比rdb慢</li>
<li>Aof运行效率也要比rdb慢，所以我们redis默认的配置就是rdb持久化</li>
</ol>
<h3 id="12-redis订阅发布"><a class="markdownIt-Anchor" href="#12-redis订阅发布"></a> 12 Redis订阅发布</h3>
<p><img src= "/img/loading.gif" data-lazy-src="/2020/12/26/Redis%E5%9F%BA%E7%A1%80%E5%85%A5%E9%97%A8/image-20201227201729862.png" alt="image-20201227201729862"></p>
<blockquote>
<p>发布订阅（pub/sub）是一种消息通信模式，发送者（pub）发送消息，订阅者（sub）接收消息，微博，微信，Redis客户端可以订阅任意数量的频道</p>
</blockquote>
<p><img src= "/img/loading.gif" data-lazy-src="/2020/12/26/Redis%E5%9F%BA%E7%A1%80%E5%85%A5%E9%97%A8/image-20201227202915634.png" alt="image-20201227202915634"></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 订阅</span></span><br><span class="line">127.0.0.1:6379&gt; subscribe 1</span><br><span class="line">Reading messages... (press Ctrl-C to quit)</span><br><span class="line">1) <span class="string">&quot;subscribe&quot;</span></span><br><span class="line">2) <span class="string">&quot;1&quot;</span> <span class="comment"># 消息频道</span></span><br><span class="line">3) (<span class="built_in">integer</span>) 1</span><br><span class="line">1) <span class="string">&quot;message&quot;</span> </span><br><span class="line">2) <span class="string">&quot;1&quot;</span>  <span class="comment"># 消息频道</span></span><br><span class="line">3) <span class="string">&quot;111&quot;</span><span class="comment"># 具体内容</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 发布</span></span><br><span class="line">127.0.0.1:6379&gt; publish 1 111</span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br></pre></td></tr></table></figure>
<p><strong>应用</strong></p>
<ul>
<li>聊天室</li>
<li>公众号</li>
</ul>
<h3 id="13-redis集群环境搭建"><a class="markdownIt-Anchor" href="#13-redis集群环境搭建"></a> 13 Redis集群环境搭建</h3>
<blockquote>
<p>主从复制，是指将一台 Redis服务器的数据，复制到其他的 Redist服务器。前者称为主节点( master/leader),后者称为从节点<br>
( slave/ allowed);数据的复制是单向的，只能由主节点到从节点， Master以写为主， Slave以读为主<br>
默认情况下，每台 Redis服务器都是主节点：且一个主节点可以有多个从节点（或没有从节点，但一个从节点只能有一个主节点。</p>
</blockquote>
<p><strong>主从复制的作用</strong></p>
<ul>
<li>数据冗余: 主从复制实现了数据的热备份,是持久化之外的一种冗余方式</li>
<li>故障恢复: 当主节点出现问题时,可以由从节点提供服务,实现快速的故障恢复,实际上是一种服务冗余</li>
<li>负载均衡: 在主从复制的基础上，配合读写分离，可以由主节点提供写服务，由从节点提供读服务（即写 Redis数据时应用连接主节点，读 Redis数时应用连接从节点），分担服务器负載：尤其是在写少读多的场原下，通过多个从节点分担读负载，可以大大提高 Redish服务器的并发量</li>
<li>高可用基石：除了上述作用以外，主从复制还是哨兵和集群能够实施的基础，因此说主从复制是 Redist高可用的基础</li>
</ul>
<p>总的来说，要将 Redis运用于工程项目中，只使用一台 Redis!是万万不能的，原因如下<br>
1、从结构上，单个 Redis服务器会发生单点故障。，井且一台服务器需要处理所有的请求负载，压力较大<br>
2、从容量上，单个 Redis:服务器内存容量有限，就算一台 Redis:服务器内存容量为256G,也不能将所有内存用作 Redis存储内存</p>
<p>一般来说，单台 Redist最大使用内存不应该超过20G电商网站上的商品，一般都是一次上传，无数次浏览的，说专业点也就是”多读少写**</p>
<h4 id="1-环境配置"><a class="markdownIt-Anchor" href="#1-环境配置"></a> 1 环境配置</h4>
<p>只配置从库,无需配置主库</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看当前库的信息</span></span><br><span class="line">127.0.0.1:6379&gt; info replication </span><br><span class="line"><span class="comment"># Replication</span></span><br><span class="line">role:master <span class="comment"># 角色</span></span><br><span class="line">connected_slaves:0 <span class="comment"># 没有从机</span></span><br><span class="line">master_replid:27a8d6b5022631dd44b5eb22816560dcd2b2fc68</span><br><span class="line">master_replid2:0000000000000000000000000000000000000000</span><br><span class="line">master_repl_offset:0</span><br><span class="line">second_repl_offset:-1</span><br><span class="line">repl_backlog_active:0</span><br><span class="line">repl_backlog_size:1048576</span><br><span class="line">repl_backlog_first_byte_offset:0</span><br><span class="line">repl_backlog_histlen:0</span><br><span class="line"></span><br><span class="line"><span class="comment">#########################</span></span><br><span class="line"><span class="comment"># 命令方式</span></span><br><span class="line"><span class="comment">#########################</span></span><br><span class="line"><span class="comment"># 默认启动三台机器每一台机器都是一台主机</span></span><br><span class="line"><span class="comment"># 从机输入命令 SLAVEOF ip port 认定主机</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#########################</span></span><br><span class="line"><span class="comment"># 配置文件</span></span><br><span class="line"><span class="comment">#########################</span></span><br><span class="line">replicaof &lt;ip&gt; &lt;port&gt;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>测试：主机断开连接，从机依旧连接到主机的，但是没有写操作，这个时候，主机如果回来了，从机依旧可以直接获取到主机写的<br>
信息！<br>
如果是使用命令行来配置的主从，这个时如果重启了，就会变回<strong>主机！只要变为从机，立马就会从主机中获取值</strong></p>
</blockquote>
<p><strong>复制原理</strong><br>
Slave启动成功连接到 master 后会发送一个sync同步命令，Master接到命令，启动后台的存盘进程，同时枚集所有接收到的用于修改数据集命令，在后台进程执行完毕之后， master将传送整个数据文件到ave,并完成一次完全同步<br>
<strong>全量复制</strong>：</p>
<p>​		而 slave服务在接收到数据库文件数后，将其存盘井加载到内存中<br>
<strong>增量复制：</strong></p>
<p>​		 Master继续将新的所有收集到的修改命令依次传给slave,完成同步<br>
但是只要是重新连接 master,一次完全同步（全量复制）将被自动执行</p>
<h4 id="2-宕机后手动配置主机"><a class="markdownIt-Anchor" href="#2-宕机后手动配置主机"></a> 2 宕机后手动配置主机</h4>
<p>执行命令</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">slaveof no one <span class="comment"># 从机变成主机命令（即便是主机回来了，变成主机的从机，仍然是主机）</span></span><br></pre></td></tr></table></figure>
<h4 id="3-哨兵模式"><a class="markdownIt-Anchor" href="#3-哨兵模式"></a> 3 哨兵模式</h4>
<blockquote>
<p>当主机挂掉之后，自动推选出一个主机</p>
</blockquote>
<blockquote>
<p>主从切换技术的方法是：当主服务器宕机后，需要手动把一台从服务器切換为主服务器，这就需要人工千预，费事费力，还会造成段时间内服务不可用。这不是一种推荐的方式，更多时候，我们优先考虑哨兵模式。</p>
<p>Redis从2.8开始正式提供了 Sentinel(哨兵）架构来解决这个问题<br>
能够后台监控主机是否故障，如果故了根据投票数自动将从库转换为主库。</p>
<p>消兵模式是一种特殊的模式，首先 Redis提供了哨兵的命令，哨兵是一个独立的进程，作为进程，它会独立运行，其原理是哨兵通<br>
过发送命令，等待 Redis!服务器响应，从而监控运行的多个 Redis实例</p>
</blockquote>
<p><img src= "/img/loading.gif" data-lazy-src="/2020/12/26/Redis%E5%9F%BA%E7%A1%80%E5%85%A5%E9%97%A8/image-20201227211940620.png" alt="image-20201227211940620"></p>
<p><img src= "/img/loading.gif" data-lazy-src="/2020/12/26/Redis%E5%9F%BA%E7%A1%80%E5%85%A5%E9%97%A8/image-20201227212001656.png" alt="image-20201227212001656"></p>
<p><strong>这里的哨兵有两个作用</strong><br>
通过发送命令，让Redis服务器返回监控其运行状态，包括主服务器和从服务器。当哨兵监测到 master宕机，会自动将 slave切換成 master,然后通过发布订阅模式通知其他的从服务器，修改配置文件，让它们切换主机。<br>
然而一个哨兵进程对 Redish服务器进行监控，可能会出现问题，为 此，我们可以使用多个哨兵进行监控。各个哨兵之间还会进行监<br>
控，这样就形成了多哨兵模式。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">vim sentinel.conf</span><br><span class="line">-------------</span><br><span class="line"><span class="comment"># 配置哨兵配置文件</span></span><br><span class="line"><span class="comment"># sentinel monitor &lt;名称&gt;  &lt;ip&gt; &lt;port&gt;  &lt;主机挂机，从机投票，看谁来接替主机，票数最多的成为主机&gt;</span></span><br><span class="line">sentinel nonitor myredis 127.0.0.1 6379 1</span><br><span class="line">-------------</span><br><span class="line"><span class="comment"># 启动哨兵</span></span><br><span class="line">redis-sentinel sentinel.conf</span><br></pre></td></tr></table></figure>
<p>如果主机恢复了，只能归并到新的主机下，当做从机，这就是哨兵模式的规则</p>
<p><strong>优点：</strong></p>
<ol>
<li>
<p>哨兵集群，基于主从复制模式，具备所有的主从配置优点</p>
</li>
<li>
<p>主从可以切换，故障可以转移，系统的可用性为编号</p>
</li>
<li>
<p>哨兵模式就是主从赋值的升级，手动到自动，更加健壮</p>
</li>
</ol>
<p><strong>缺点</strong>：</p>
<ol>
<li>Redis不好在线扩容，集群数量一旦达到上限，在线扩容比较困难</li>
<li>实现哨兵模式的配置很麻烦，有很多选择</li>
</ol>
<h3 id="14-缓存穿透与缓存雪崩"><a class="markdownIt-Anchor" href="#14-缓存穿透与缓存雪崩"></a> 14 缓存穿透与缓存雪崩</h3>
<p>​		Redis缓存的使用，极大的提升了应用程序的性能和效率。，特别是数据查询方面。但同时，它也带来了一些问题。其中，最要害的<br>
问题，就是数据的一致性问题，从严格意义上讲，这个问题无解。如果对数据的一致性要求很高，那么就不能使用缓， 另外的一些典型问题就是，缓存穿透、缓存雪和线存击穿。目前，业界也都有比较流行的解决方案。</p>
<h4 id="1-缓存穿透"><a class="markdownIt-Anchor" href="#1-缓存穿透"></a> 1 缓存穿透</h4>
<p><img src= "/img/loading.gif" data-lazy-src="/2020/12/26/Redis%E5%9F%BA%E7%A1%80%E5%85%A5%E9%97%A8/image-20201227213614378.png" alt="image-20201227213614378"></p>
<p>缓存穿透的概念很简单，用户想要查询一个数据，发现 redis内存数据库没有，也就是缓存没有命中，于是向持久层数据库查询。发现也没有，于是本次直询失败，当用户很多的时候，缓存都没有命中，于是都去请求了持久层数据库，这会给持久层数据库造成很大的压力，这时候就相当于出现了缓存穿透。</p>
<h5 id="1-布过滤器"><a class="markdownIt-Anchor" href="#1-布过滤器"></a> 1 布过滤器</h5>
<p>布过滤器是一种数据结构，对所有可能查询的参数以hash形式存储，在控制层先进行校验，不符合则丢弃，从而避免了对底层存<br>
储系统的查询压力</p>
<p><img src= "/img/loading.gif" data-lazy-src="/2020/12/26/Redis%E5%9F%BA%E7%A1%80%E5%85%A5%E9%97%A8/image-20201227213657749.png" alt="image-20201227213657749"></p>
<h5 id="2-缓存空对象"><a class="markdownIt-Anchor" href="#2-缓存空对象"></a> 2  缓存空对象</h5>
<p>当存储层不命中后，即使返回的空对象也将具缓存起来，同时会设置一个过期时间，之后再访问这个数据将会从缓存中获取，保护了后端数据源。</p>
<p><img src= "/img/loading.gif" data-lazy-src="/2020/12/26/Redis%E5%9F%BA%E7%A1%80%E5%85%A5%E9%97%A8/image-20201227213813078.png" alt="image-20201227213813078"></p>
<p>但是这种方法会存在两个问题<br>
1、如果空值能够被存起来，这就意味着缓存要更多的空间存储更多的键，因为这当中可能会有很多的空值的健<br>
2、即使对空值设置了过期时间，还是会存在援存层和存储层的数据会有一段时间园口的不一致，这对于需要保持一致性的业务会有影响</p>
<h4 id="2-缓存击穿"><a class="markdownIt-Anchor" href="#2-缓存击穿"></a> 2 缓存击穿</h4>
<p>这里需要注意和缓存穿透的区別，缓存击穿，是指一个key非常热点，在不停的扛着大井发，大井发集中对这一个点进行访问，当 这个key在失效的瞬间，持续的大井发就穿破缓存，直接请求数起库，就像在一个屏障上凿开了一个洞。</p>
<p>当某个key在过期的瞬间，有大量的请求并发访问，这类数据一般是热点数据，由于缓存过期，会同时访问数据库来查询最新数据，井且回写缓存，会导致数据库瞬间压力过大</p>
<h5 id="1-设置热点数据永不过期"><a class="markdownIt-Anchor" href="#1-设置热点数据永不过期"></a> 1 设置热点数据永不过期</h5>
<p>从缓存层面来看，没有设置过期时间，所以不会出现key过期后产生的问题</p>
<h5 id="2-加互斥锁"><a class="markdownIt-Anchor" href="#2-加互斥锁"></a> 2 加互斥锁</h5>
<p>分布式锁：使用分布式锁，保证对于每个key同时只有一个线程去查询后服务，其他线程没有获得分布式的权限，因此只需要等待即可。这种方式将高并发的压力转移到了分布式，因此对分布式模的考验很大。</p>
<h4 id="3-缓存雪崩"><a class="markdownIt-Anchor" href="#3-缓存雪崩"></a> 3 缓存雪崩</h4>
<p>缓存雪崩，是指在某一个时间段，缓存集中过期失效， Redis宕机</p>
<p>产生雪崩的原因之一，比如在写本文的时候，马上就要到双十二零点，很快就会迎来一波抢购，这波商品时间比较集中的放入了缓存，假设援存一个小时。那么到了凌晨一点钟的时候，这批商品的援存就都过期了。而对这批商品的访问查询，都落到了数据库上，对于数据库而言，就会产生周期性的压力波峰。于是所有的请求都会达到存储层，存储层的调用量会暴増，造成存储层也会挂掉的情况</p>
<h5 id="1-redis高可用"><a class="markdownIt-Anchor" href="#1-redis高可用"></a> 1 Redis高可用</h5>
<p>这个思想的含义是，既然 tredis?有可能挂掉，那我多增设几台 redis,这样一台挂掉之后其他的还可以继续工作，其实就是搭建的集群(异地多活！)</p>
<h5 id="2-限流降级"><a class="markdownIt-Anchor" href="#2-限流降级"></a> 2 限流降级</h5>
<p>这个解决方案的思想是，在缓存失效后，通过加或者队列来控制读数据库写缓存的线程数量，比如对某个key只允许一个线程查询数据和写缓存，其他线程等待</p>
<h5 id="3-数据预热"><a class="markdownIt-Anchor" href="#3-数据预热"></a> 3 数据预热</h5>
<p>数据加热的含义就是在正式部署之前，我先把可能的数据先预先访问一遍，这样部分可能大量访问的数据就会加载到缓存中。在即将发生大井发访问前手动触发加加载缓存存不同的key,设置不同的过期时间，让缓存失效的时间点，尽量均匀。</p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">Curiosity</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://lijinzedev.github.io/2020/12/26/Redis%E5%9F%BA%E7%A1%80%E5%85%A5%E9%97%A8/">https://lijinzedev.github.io/2020/12/26/Redis%E5%9F%BA%E7%A1%80%E5%85%A5%E9%97%A8/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://lijinzedev.github.io" target="_blank">Curiosity的博客</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/redis/">redis</a></div><div class="post_share"><div class="social-share" data-image="https://user-images.githubusercontent.com/41108332/105622748-e2c5b580-5e4e-11eb-95c9-b22cdfdd632b.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2020/12/28/shell%E7%BE%8E%E5%8C%96oh-my-zsh/"><img class="prev-cover" data-lazy-src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">shell美化oh-my-zsh</div></div></a></div><div class="next-post pull-right"><a href="/2020/12/23/Idea-%E9%9B%86%E6%88%90Docker/"><img class="next-cover" data-lazy-src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">IDEA集成Docker与远程Debug</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span> 相关推荐</span></div><div class="relatedPosts-list"><div><a href="/2021/07/31/redis-分布式锁/" title="redis 分布式锁"><img class="cover" data-lazy-src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-07-31</div><div class="title">redis 分布式锁</div></div></a></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="card-info-avatar is-center"><img class="avatar-img" data-lazy-src="https://user-images.githubusercontent.com/41108332/105622748-e2c5b580-5e4e-11eb-95c9-b22cdfdd632b.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/><div class="author-info__name">Curiosity</div><div class="author-info__description">SpringBoot | Mybatis | Java | Mysql</div></div><div class="card-info-data"><div class="card-info-data-item is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">84</div></a></div><div class="card-info-data-item is-center"><a href="/tags/"><div class="headline">标签</div><div class="length-num">57</div></a></div><div class="card-info-data-item is-center"><a href="/categories/"><div class="headline">分类</div><div class="length-num">46</div></a></div></div><a class="button--animated" id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/lijinzedev"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/lijinzedev" target="_blank" title="Github"><i class="fab fa-github"></i></a><a class="social-icon" href="mailto:2533755010@gmail.com" target="_blank" title="Email"><i class="fas fa-envelope"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn card-announcement-animation"></i><span>公告</span></div><div class="announcement_content">万般皆下品,唯有读书高</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#redis-%E5%9F%BA%E7%A1%80%E5%85%A5%E9%97%A8"><span class="toc-number">1.</span> <span class="toc-text"> Redis 基础入门</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-%E4%BB%80%E4%B9%88%E6%98%AFnosql"><span class="toc-number">1.1.</span> <span class="toc-text"> 1 什么是NoSQL</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-nosql%E7%9A%84%E5%9B%9B%E5%A4%A7%E5%88%86%E7%B1%BB"><span class="toc-number">1.2.</span> <span class="toc-text"> 2 NoSQL的四大分类</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-redis"><span class="toc-number">1.3.</span> <span class="toc-text"> 3 Redis</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E6%A6%82%E8%BF%B0"><span class="toc-number">1.3.1.</span> <span class="toc-text"> 1 概述</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E5%AE%89%E8%A3%85"><span class="toc-number">1.3.2.</span> <span class="toc-text"> 2 安装</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-linux-%E5%AE%89%E8%A3%85"><span class="toc-number">1.3.2.1.</span> <span class="toc-text"> 1 Linux 安装</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-docker-%E5%AE%89%E8%A3%85"><span class="toc-number">1.3.2.2.</span> <span class="toc-text"> 2 Docker 安装</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-redis-benchmark%E6%80%A7%E8%83%BD%E6%B5%8B%E8%AF%95"><span class="toc-number">1.3.3.</span> <span class="toc-text"> 3 redis-benchmark性能测试</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-%E5%9F%BA%E7%A1%80"><span class="toc-number">1.3.4.</span> <span class="toc-text"> 4 基础</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B"><span class="toc-number">1.3.5.</span> <span class="toc-text"> 5 数据类型</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-string"><span class="toc-number">1.3.5.1.</span> <span class="toc-text"> 1 String</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-list"><span class="toc-number">1.3.5.2.</span> <span class="toc-text"> 2 List</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-set"><span class="toc-number">1.3.5.3.</span> <span class="toc-text"> 3 Set</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-hash"><span class="toc-number">1.3.5.4.</span> <span class="toc-text"> 4 Hash</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-zset"><span class="toc-number">1.3.5.5.</span> <span class="toc-text"> 5 Zset</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-geospatial"><span class="toc-number">1.3.5.6.</span> <span class="toc-text"> 6 geospatial</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7-hyperloglog"><span class="toc-number">1.3.5.7.</span> <span class="toc-text"> 7 Hyperloglog</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#8-bitmaps"><span class="toc-number">1.3.5.8.</span> <span class="toc-text"> 8 Bitmaps</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-%E4%BA%8B%E5%8A%A1"><span class="toc-number">1.3.6.</span> <span class="toc-text"> 6 事务</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-%E6%89%A7%E8%A1%8C%E4%BA%8B%E5%8A%A1"><span class="toc-number">1.3.6.1.</span> <span class="toc-text"> 1 执行事务</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-%E5%8F%96%E6%B6%88%E4%BA%8B%E5%8A%A1"><span class="toc-number">1.3.6.2.</span> <span class="toc-text"> 2 取消事务</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-%E5%91%BD%E4%BB%A4%E6%9C%89%E9%94%99%E4%BA%8B%E5%8A%A1%E4%B8%AD%E6%89%80%E6%9C%89%E7%9A%84%E5%91%BD%E4%BB%A4%E9%83%BD%E4%B8%8D%E4%BC%9A%E8%A2%AB%E6%89%A7%E8%A1%8C"><span class="toc-number">1.3.6.3.</span> <span class="toc-text"> 3 命令有错，事务中所有的命令都不会被执行</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-%E4%BA%8B%E5%8A%A1%E5%AD%98%E5%9C%A8%E8%AF%AD%E6%B3%95%E6%80%A7%E6%89%A7%E8%A1%8C%E5%91%BD%E4%BB%A4%E7%9A%84%E6%97%B6%E5%80%99%E5%85%B6%E4%BB%96%E5%91%BD%E4%BB%A4%E6%98%AF%E5%8F%AF%E4%BB%A5%E6%AD%A3%E5%B8%B8%E6%89%A7%E8%A1%8C%E7%9A%84%E9%94%99%E8%AF%AF%E7%9A%84%E5%91%BD%E4%BB%A4%E4%BC%9A%E6%8A%9B%E5%87%BA%E5%BC%82%E5%B8%B8"><span class="toc-number">1.3.6.4.</span> <span class="toc-text"> 4 事务存在语法性，执行命令的时候，其他命令是可以正常执行的，错误的命令会抛出异常</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-%E4%B9%90%E8%A7%82%E9%94%81"><span class="toc-number">1.3.7.</span> <span class="toc-text"> 7 乐观锁</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-jedis"><span class="toc-number">1.3.8.</span> <span class="toc-text"> 8 Jedis</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-%E4%BA%8B%E7%89%A9"><span class="toc-number">1.3.8.1.</span> <span class="toc-text"> 1 事物</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9-springboot%E6%95%B4%E5%90%88"><span class="toc-number">1.3.9.</span> <span class="toc-text"> 9 SpringBoot整合</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-%E8%87%AA%E5%AE%9A%E4%B9%89redistemplate"><span class="toc-number">1.3.9.1.</span> <span class="toc-text"> 1 自定义RedisTemplate</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#10-redisconf%E8%AF%A6%E8%A7%A3"><span class="toc-number">1.3.10.</span> <span class="toc-text"> 10 redis.conf详解</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-%E8%AE%BE%E7%BD%AE%E5%AF%86%E7%A0%81"><span class="toc-number">1.3.10.1.</span> <span class="toc-text"> 1 设置密码</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#11-redis-%E6%8C%81%E4%B9%85%E5%8C%96"><span class="toc-number">1.3.11.</span> <span class="toc-text"> 11 Redis 持久化</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-rdb"><span class="toc-number">1.3.11.1.</span> <span class="toc-text"> 1 RDB</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-aofappend-only-file"><span class="toc-number">1.3.11.2.</span> <span class="toc-text"> 2 AOF(Append Only File)</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#12-redis%E8%AE%A2%E9%98%85%E5%8F%91%E5%B8%83"><span class="toc-number">1.3.12.</span> <span class="toc-text"> 12 Redis订阅发布</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#13-redis%E9%9B%86%E7%BE%A4%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA"><span class="toc-number">1.3.13.</span> <span class="toc-text"> 13 Redis集群环境搭建</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE"><span class="toc-number">1.3.13.1.</span> <span class="toc-text"> 1 环境配置</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-%E5%AE%95%E6%9C%BA%E5%90%8E%E6%89%8B%E5%8A%A8%E9%85%8D%E7%BD%AE%E4%B8%BB%E6%9C%BA"><span class="toc-number">1.3.13.2.</span> <span class="toc-text"> 2 宕机后手动配置主机</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-%E5%93%A8%E5%85%B5%E6%A8%A1%E5%BC%8F"><span class="toc-number">1.3.13.3.</span> <span class="toc-text"> 3 哨兵模式</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#14-%E7%BC%93%E5%AD%98%E7%A9%BF%E9%80%8F%E4%B8%8E%E7%BC%93%E5%AD%98%E9%9B%AA%E5%B4%A9"><span class="toc-number">1.3.14.</span> <span class="toc-text"> 14 缓存穿透与缓存雪崩</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-%E7%BC%93%E5%AD%98%E7%A9%BF%E9%80%8F"><span class="toc-number">1.3.14.1.</span> <span class="toc-text"> 1 缓存穿透</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-%E5%B8%83%E8%BF%87%E6%BB%A4%E5%99%A8"><span class="toc-number">1.3.14.1.1.</span> <span class="toc-text"> 1 布过滤器</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-%E7%BC%93%E5%AD%98%E7%A9%BA%E5%AF%B9%E8%B1%A1"><span class="toc-number">1.3.14.1.2.</span> <span class="toc-text"> 2  缓存空对象</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-%E7%BC%93%E5%AD%98%E5%87%BB%E7%A9%BF"><span class="toc-number">1.3.14.2.</span> <span class="toc-text"> 2 缓存击穿</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-%E8%AE%BE%E7%BD%AE%E7%83%AD%E7%82%B9%E6%95%B0%E6%8D%AE%E6%B0%B8%E4%B8%8D%E8%BF%87%E6%9C%9F"><span class="toc-number">1.3.14.2.1.</span> <span class="toc-text"> 1 设置热点数据永不过期</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-%E5%8A%A0%E4%BA%92%E6%96%A5%E9%94%81"><span class="toc-number">1.3.14.2.2.</span> <span class="toc-text"> 2 加互斥锁</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-%E7%BC%93%E5%AD%98%E9%9B%AA%E5%B4%A9"><span class="toc-number">1.3.14.3.</span> <span class="toc-text"> 3 缓存雪崩</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-redis%E9%AB%98%E5%8F%AF%E7%94%A8"><span class="toc-number">1.3.14.3.1.</span> <span class="toc-text"> 1 Redis高可用</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-%E9%99%90%E6%B5%81%E9%99%8D%E7%BA%A7"><span class="toc-number">1.3.14.3.2.</span> <span class="toc-text"> 2 限流降级</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-%E6%95%B0%E6%8D%AE%E9%A2%84%E7%83%AD"><span class="toc-number">1.3.14.3.3.</span> <span class="toc-text"> 3 数据预热</span></a></li></ol></li></ol></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2021/09/16/mac-%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/" title="mac 常用命令">mac 常用命令</a><time datetime="2021-09-16T10:26:20.000Z" title="发表于 2021-09-16 10:26:20">2021-09-16</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2021/09/15/%E5%8D%95%E7%82%B9%E7%99%BB%E9%99%86/" title="单点登陆">单点登陆</a><time datetime="2021-09-15T17:56:56.000Z" title="发表于 2021-09-15 17:56:56">2021-09-15</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2021/09/14/mac-%E5%AE%89%E8%A3%85brew/" title="mac 安装brew">mac 安装brew</a><time datetime="2021-09-14T15:16:12.000Z" title="发表于 2021-09-14 15:16:12">2021-09-14</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2021/09/14/mac-man%E6%B1%89%E5%8C%96/" title="mac man汉化">mac man汉化</a><time datetime="2021-09-14T14:19:43.000Z" title="发表于 2021-09-14 14:19:43">2021-09-14</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2021/09/02/%E5%9C%A8YAML%E4%B8%AD%E4%BD%BF%E7%94%A8Maven%E5%8F%98%E9%87%8F/" title="在YAML中使用Maven变量">在YAML中使用Maven变量</a><time datetime="2021-09-02T16:06:42.000Z" title="发表于 2021-09-02 16:06:42">2021-09-02</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2021 By Curiosity</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><div class="search-dialog__title" id="local-search-title">本地搜索</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div></div><hr/><div id="local-search-results"></div><span class="search-close-button"><i class="fas fa-times"></i></span></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/medium-zoom/dist/medium-zoom.min.js"></script><script src="https://cdn.jsdelivr.net/npm/vanilla-lazyload/dist/lazyload.iife.min.js"></script><script src="/js/search/local-search.js"></script><div class="js-pjax"></div><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>