<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Spring MVC 相关组件以及组件初始化 | Curiosity的博客</title><meta name="keywords" content="源码"><meta name="author" content="Curiosity"><meta name="copyright" content="Curiosity"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="[toc]  1 相关组件及其初始化  1 相关组件列表   WebAsyncManager（异步请求管理器）  用于异步请求和响应提供支持    LocaleResolver（本地化解析器）  用于解析请求对应的Locale。可以是其子接口LocaleContextResolver本地化上下文解析器，额外添加获取时区的功能    ThemeResovler（主题解析器）  用于封装不同主题对应的">
<meta property="og:type" content="article">
<meta property="og:title" content="Spring MVC 相关组件以及组件初始化">
<meta property="og:url" content="https://lijinzedev.github.io/2020/11/29/Spring-MVC-%E7%9B%B8%E5%85%B3%E7%BB%84%E4%BB%B6%E4%BB%A5%E5%8F%8A%E7%BB%84%E4%BB%B6%E5%88%9D%E5%A7%8B%E5%8C%96/index.html">
<meta property="og:site_name" content="Curiosity的博客">
<meta property="og:description" content="[toc]  1 相关组件及其初始化  1 相关组件列表   WebAsyncManager（异步请求管理器）  用于异步请求和响应提供支持    LocaleResolver（本地化解析器）  用于解析请求对应的Locale。可以是其子接口LocaleContextResolver本地化上下文解析器，额外添加获取时区的功能    ThemeResovler（主题解析器）  用于封装不同主题对应的">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://user-images.githubusercontent.com/41108332/105622748-e2c5b580-5e4e-11eb-95c9-b22cdfdd632b.png">
<meta property="article:published_time" content="2020-11-29T14:07:20.000Z">
<meta property="article:modified_time" content="2024-07-19T06:03:08.581Z">
<meta property="article:author" content="Curiosity">
<meta property="article:tag" content="源码">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://user-images.githubusercontent.com/41108332/105622748-e2c5b580-5e4e-11eb-95c9-b22cdfdd632b.png"><link rel="shortcut icon" href="https://user-images.githubusercontent.com/41108332/105622748-e2c5b580-5e4e-11eb-95c9-b22cdfdd632b.png"><link rel="canonical" href="https://lijinzedev.github.io/2020/11/29/Spring-MVC-%E7%9B%B8%E5%85%B3%E7%BB%84%E4%BB%B6%E4%BB%A5%E5%8F%8A%E7%BB%84%E4%BB%B6%E5%88%9D%E5%A7%8B%E5%8C%96/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'mediumZoom',
  Snackbar: undefined,
  source: {
    jQuery: 'https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js',
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/js/jquery.justifiedGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/css/justifiedGallery.min.css'
    },
    fancybox: {
      js: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js',
      css: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: true,
  isanchor: false
};

const saveToLocal = {
  // ttl 單位是 天
  set: function setWithExpiry(key, value, ttl) {
    if (ttl === 0) return
    const now = new Date()
    const expiryDay = ttl * 86400000
    const item = {
      value: value,
      expiry: now.getTime() + expiryDay,
    }
    localStorage.setItem(key, JSON.stringify(item))
  },

  get: function getWithExpiry(key) {
    const itemStr = localStorage.getItem(key)

    if (!itemStr) {
      return undefined
    }
    const item = JSON.parse(itemStr)
    const now = new Date()

    if (now.getTime() > item.expiry) {
      localStorage.removeItem(key)
      return undefined
    }
    return item.value
  }
}

// https://stackoverflow.com/questions/16839698/jquery-getscript-alternative-in-native-javascript
const getScript = url => new Promise((resolve, reject) => {
  const script = document.createElement('script')
  script.src = url
  script.async = true
  script.onerror = reject
  script.onload = script.onreadystatechange = function() {
    const loadState = this.readyState
    if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
    script.onload = script.onreadystatechange = null
    resolve()
  }
  document.head.appendChild(script)
})</script><script id="config_change">var GLOBAL_CONFIG_SITE = { 
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2024-07-19 06:03:08'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(function () {  window.activateDarkMode = function () {
    document.documentElement.setAttribute('data-theme', 'dark')
    if (document.querySelector('meta[name="theme-color"]') !== null) {
      document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
    }
  }
  window.activateLightMode = function () {
    document.documentElement.setAttribute('data-theme', 'light')
   if (document.querySelector('meta[name="theme-color"]') !== null) {
      document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
    }
  }
  const autoChangeMode = 'false'
  const t = saveToLocal.get('theme')
  if (autoChangeMode === '1') {
    const isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
    const isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
    const isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
    const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified
    if (t === undefined) {
      if (isLightMode) activateLightMode()
      else if (isDarkMode) activateDarkMode()
      else if (isNotSpecified || hasNoSupport) {
        const now = new Date()
        const hour = now.getHours()
        const isNight = hour <= 6 || hour >= 18
        isNight ? activateDarkMode() : activateLightMode()
      }
      window.matchMedia('(prefers-color-scheme: dark)').addListener(function (e) {
        if (saveToLocal.get('theme') === undefined) {
          e.matches ? activateDarkMode() : activateLightMode()
        }
      })
    } else if (t === 'light') activateLightMode()
    else activateDarkMode()
  } else if (autoChangeMode === '2') {
    const now = new Date()
    const hour = now.getHours()
    const isNight = hour <= 6 || hour >= 18
    if (t === undefined) isNight ? activateDarkMode() : activateLightMode()
    else if (t === 'light') activateLightMode()
    else activateDarkMode()
  } else {
    if (t === 'dark') activateDarkMode()
    else if (t === 'light') activateLightMode()
  }const asideStatus = saveToLocal.get('aside-status')
if (asideStatus !== undefined) {
   if (asideStatus === 'hide') {
     document.documentElement.classList.add('hide-aside')
   } else {
     document.documentElement.classList.remove('hide-aside')
   }
}})()</script><meta name="generator" content="Hexo 5.4.2"><link rel="stylesheet" href="/css/prism.css" type="text/css"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="author-avatar"><img class="avatar-img" data-lazy-src="https://user-images.githubusercontent.com/41108332/105622748-e2c5b580-5e4e-11eb-95c9-b22cdfdd632b.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data"><div class="data-item is-center"><div class="data-item-link"><a href="/archives/"><div class="headline">文章</div><div class="length-num">155</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/tags/"><div class="headline">标签</div><div class="length-num">83</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/categories/"><div class="headline">分类</div><div class="length-num">112</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> 关于</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">Curiosity的博客</a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> 关于</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">Spring MVC 相关组件以及组件初始化</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2020-11-29T14:07:20.000Z" title="发表于 2020-11-29 14:07:20">2020-11-29</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2024-07-19T06:03:08.581Z" title="更新于 2024-07-19 06:03:08">2024-07-19</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E6%BA%90%E7%A0%81/">源码</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E6%BA%90%E7%A0%81/SpringMvc%E6%BA%90%E7%A0%81/">SpringMvc源码</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><p>[toc]</p>
<h1 id="1-相关组件及其初始化"><a class="markdownIt-Anchor" href="#1-相关组件及其初始化"></a> 1 相关组件及其初始化</h1>
<h2 id="1-相关组件列表"><a class="markdownIt-Anchor" href="#1-相关组件列表"></a> 1 相关组件列表</h2>
<ul>
<li>
<p>WebAsyncManager（异步请求管理器）</p>
<blockquote>
<p>用于异步请求和响应提供支持</p>
</blockquote>
</li>
<li>
<p>LocaleResolver（本地化解析器）</p>
<blockquote>
<p>用于解析请求对应的Locale。可以是其子接口LocaleContextResolver本地化上下文解析器，额外添加获取时区的功能</p>
</blockquote>
</li>
<li>
<p>ThemeResovler（主题解析器）</p>
<blockquote>
<p>用于封装不同主题对应的资源包，通过主题源的getTheme方法，可以根据主题名获取对应的主题资源包</p>
</blockquote>
</li>
<li>
<p>ThemeSource（主题源）</p>
<blockquote>
<p>用于封装不同主题对应的资源包。通过主题源的getTheme方法，可以根据主题名获取对应的主题资源包</p>
</blockquote>
</li>
<li>
<p>MessageSource（消息源）</p>
<blockquote>
<p>用于对国际化提供支持，消息源封装了不同Code在不同Locale中对应的消息字符串</p>
</blockquote>
</li>
<li>
<p>FlashMapMannger（闪存管理器）</p>
<blockquote>
<p>用于提供重定向跨请求传递Model参数，其中存储内容在下次请求发生后即清空。同时该管理器还用于获取上次请求输出的FlashMap作为本地请求输入的FlashMap，把当前请求的输出FlashMap保存起来作为下一次请求的输入FlashMap</p>
</blockquote>
</li>
<li>
<p>MultipartResolver（多块请求解析器）</p>
<blockquote>
<p>用于判断请求是否为多块请求，对于多块请求进行一些预先解析</p>
</blockquote>
</li>
<li>
<p>List&lt;HandlerMapping&gt; （处理器映射列表）</p>
<blockquote>
<p>用于根据请求查找对应的处理器执行链</p>
</blockquote>
</li>
<li>
<p>List&lt;HandlerAdapter&gt; (处理器适配器列表)</p>
<blockquote>
<p>用于对处理器执行链进行适配执行</p>
</blockquote>
</li>
<li>
<p>ViewNameTranslator（视图名翻译器）</p>
<blockquote>
<p>类型为RequestToViewNameTranslator，用于通过请求获取请求对应的默认视图名</p>
</blockquote>
</li>
<li>
<p>List&lt;HandlerExceptionResolver&gt; (处理器异常解析器列表)</p>
<blockquote>
<p>用于解析整个处理过程发生的异常，把异常解析为ModelAndView的模型视图结果，并执行统一的渲染逻辑</p>
</blockquote>
</li>
<li>
<p>List&lt;ViewResolver&gt; （视图解析器列表）</p>
<blockquote>
<p>用于根据视图名解析获取对应的视图</p>
</blockquote>
</li>
</ul>
<p><strong>总结：</strong></p>
<blockquote>
<p>除了WebAsyncManager、ThemeSource、MessageSource不是在Dispatchcher中定义的之外，其他九大组件均在DispatchServlet中定义的，这就是常说的DispatchServlet的九大组件。其属性定义的源码如下</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** MultipartResolver used by this servlet. */</span></span><br><span class="line"><span class="meta">@Nullable</span></span><br><span class="line"><span class="keyword">private</span> MultipartResolver multipartResolver;</span><br><span class="line"></span><br><span class="line"><span class="comment">/** LocaleResolver used by this servlet. */</span></span><br><span class="line"><span class="meta">@Nullable</span></span><br><span class="line"><span class="keyword">private</span> LocaleResolver localeResolver;</span><br><span class="line"></span><br><span class="line"><span class="comment">/** ThemeResolver used by this servlet. */</span></span><br><span class="line"><span class="meta">@Nullable</span></span><br><span class="line"><span class="keyword">private</span> ThemeResolver themeResolver;</span><br><span class="line"></span><br><span class="line"><span class="comment">/** List of HandlerMappings used by this servlet. */</span></span><br><span class="line"><span class="meta">@Nullable</span></span><br><span class="line"><span class="keyword">private</span> List&lt;HandlerMapping&gt; handlerMappings;</span><br><span class="line"></span><br><span class="line"><span class="comment">/** List of HandlerAdapters used by this servlet. */</span></span><br><span class="line"><span class="meta">@Nullable</span></span><br><span class="line"><span class="keyword">private</span> List&lt;HandlerAdapter&gt; handlerAdapters;</span><br><span class="line"></span><br><span class="line"><span class="comment">/** List of HandlerExceptionResolvers used by this servlet. */</span></span><br><span class="line"><span class="meta">@Nullable</span></span><br><span class="line"><span class="keyword">private</span> List&lt;HandlerExceptionResolver&gt; handlerExceptionResolvers;</span><br><span class="line"></span><br><span class="line"><span class="comment">/** RequestToViewNameTranslator used by this servlet. */</span></span><br><span class="line"><span class="meta">@Nullable</span></span><br><span class="line"><span class="keyword">private</span> RequestToViewNameTranslator viewNameTranslator;</span><br><span class="line"></span><br><span class="line"><span class="comment">/** FlashMapManager used by this servlet. */</span></span><br><span class="line"><span class="meta">@Nullable</span></span><br><span class="line"><span class="keyword">private</span> FlashMapManager flashMapManager;</span><br><span class="line"></span><br><span class="line"><span class="comment">/** List of ViewResolvers used by this servlet. */</span></span><br><span class="line"><span class="meta">@Nullable</span></span><br><span class="line"><span class="keyword">private</span> List&lt;ViewResolver&gt; viewResolvers;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h2 id="2-组件初始化"><a class="markdownIt-Anchor" href="#2-组件初始化"></a> 2 组件初始化</h2>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 初始化本类使用的多块请求解析器</span></span><br><span class="line"><span class="comment"> * 如果在ApplicationContext 中没有一个MultipartResovler类型且名称为multipartResolver的Bean被定义，则默认为空，不对多块请求进行特殊处理</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">initMultipartResolver</span><span class="params">(ApplicationContext context)</span> &#123;</span><br><span class="line">   <span class="keyword">try</span> &#123;</span><br><span class="line">       <span class="comment">// 从application中获取name为multipartResolver，类型为MultipartResolver的Bean</span></span><br><span class="line">      <span class="built_in">this</span>.multipartResolver = context.getBean(MULTIPART_RESOLVER_BEAN_NAME, MultipartResolver.class);</span><br><span class="line">      <span class="keyword">if</span> (logger.isTraceEnabled()) &#123;</span><br><span class="line">         logger.trace(<span class="string">&quot;Detected &quot;</span> + <span class="built_in">this</span>.multipartResolver);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">else</span> <span class="keyword">if</span> (logger.isDebugEnabled()) &#123;</span><br><span class="line">         logger.debug(<span class="string">&quot;Detected &quot;</span> + <span class="built_in">this</span>.multipartResolver.getClass().getSimpleName());</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">catch</span> (NoSuchBeanDefinitionException ex) &#123;</span><br><span class="line">      <span class="comment">// Default is no multipart resolver.</span></span><br><span class="line">       <span class="comment">//没有这种bean的时候，设置null</span></span><br><span class="line">      <span class="built_in">this</span>.multipartResolver = <span class="literal">null</span>;</span><br><span class="line">      <span class="keyword">if</span> (logger.isTraceEnabled()) &#123;</span><br><span class="line">         logger.trace(<span class="string">&quot;No MultipartResolver &#x27;&quot;</span> + MULTIPART_RESOLVER_BEAN_NAME + <span class="string">&quot;&#x27; declared&quot;</span>);</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>​			组件初始化是延迟加载，也就是第一个请求耗时比较长的原因，可以通过指定配置项<code>spring.mvc.servlet.load-on-startup</code>为任意非负数强制指定启动时执行初始化，默认为-1.</p>
</blockquote>
<p>​			在HttpServeletBean的init方法中，先为当前DispatcherServlet实例绑定ServletContext，中初始化的一些属性（在Spring Boot中为空，此段逻辑不执行），接着执行initServletBean方法，该方法由DispatchServlet的父类FrameworkServlet实现。</p>
<p>​			在FrameworkServlet的initServletBean方法，执行了本类initwebApplicationContext方法，此方法就是核心的初始化方法入口，在该方法中调用onRefresh方法，即上面DisorderServlet初始化入口方法，</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 初始化此Servlet的Web应用上下文</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> the WebApplicationContext instance</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@see</span> #FrameworkServlet(WebApplicationContext)</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@see</span> #setContextClass</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@see</span> #setContextConfigLocation</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">protected</span> WebApplicationContext <span class="title function_">initWebApplicationContext</span><span class="params">()</span> &#123;</span><br><span class="line">       <span class="comment">//  先尝试Servlet上下文获取已初始化的Web应用上下文作为根上文</span></span><br><span class="line">       <span class="comment">//  此处已经可以获取rootContext，设置该值的代码在第七章中提到的selfInitialize方法的prepareWebApplicationContext方法中</span></span><br><span class="line">	<span class="type">WebApplicationContext</span> <span class="variable">rootContext</span> <span class="operator">=</span></span><br><span class="line">			WebApplicationContextUtils.getWebApplicationContext(getServletContext());</span><br><span class="line">       <span class="comment">// 定义最终要返回的Web应用上下文</span></span><br><span class="line">	<span class="type">WebApplicationContext</span> <span class="variable">wac</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">	<span class="comment">// 如果当前Web应用上下文不为空 </span></span><br><span class="line">	<span class="keyword">if</span> (<span class="built_in">this</span>.webApplicationContext != <span class="literal">null</span>) &#123;</span><br><span class="line">		<span class="comment">// 在默认情况下，在DispatcherServlet作为Bean初始化的时候，就通过setApplicationContext设置其值</span></span><br><span class="line">		wac = <span class="built_in">this</span>.webApplicationContext;</span><br><span class="line">           <span class="comment">// 如果当前Web应用上下文是可配置的Web应用上下文</span></span><br><span class="line">		<span class="keyword">if</span> (wac <span class="keyword">instanceof</span> ConfigurableWebApplicationContext) &#123;</span><br><span class="line">			<span class="type">ConfigurableWebApplicationContext</span> <span class="variable">cwac</span> <span class="operator">=</span> (ConfigurableWebApplicationContext) wac;</span><br><span class="line">      		<span class="comment">// 且Web应用上下文还刷新，则执行此逻辑。默认情况下，该上下文未刷新，不执行此逻辑</span></span><br><span class="line">			<span class="keyword">if</span> (!cwac.isActive()) &#123;</span><br><span class="line">                   <span class="comment">// 当其父上下文为空时</span></span><br><span class="line">				<span class="keyword">if</span> (cwac.getParent() == <span class="literal">null</span>) &#123;</span><br><span class="line">					<span class="comment">// 则设置其父上下文未上面获取的根本上下文</span></span><br><span class="line">					cwac.setParent(rootContext);</span><br><span class="line">				&#125;</span><br><span class="line">				configureAndRefreshWebApplicationContext(cwac);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span> (wac == <span class="literal">null</span>) &#123;</span><br><span class="line">		<span class="comment">// 如果在上一逻辑未获取到Web上下文，此时执行查找逻辑获取</span></span><br><span class="line">           <span class="comment">// 该方法内部通过查找Servlet上下文中本类指定的contextAttribute属性名对应的属性值找到Web上下文</span></span><br><span class="line">		wac = findWebApplicationContext();</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span> (wac == <span class="literal">null</span>) &#123;</span><br><span class="line">		 <span class="comment">// 在上一逻辑未获取到Web上下文，则创建一个</span></span><br><span class="line">            <span class="comment">// 在Springboot中第一逻辑获取到了Web应用上下文，故不执行此逻辑</span></span><br><span class="line">		wac = createWebApplicationContext(rootContext);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">// 如果此时已接受过用上下文刷新事件，则不执行下面的if块逻辑</span></span><br><span class="line">       <span class="comment">// 在上下文刷新时间中，也会执行onRefresh的方法</span></span><br><span class="line">       <span class="comment">// 如果已经执行了onRefresh方法，则不再执行</span></span><br><span class="line">	<span class="keyword">if</span> (!<span class="built_in">this</span>.refreshEventReceived) &#123;</span><br><span class="line">		<span class="comment">// 执行onRefresh方法，其中执行整个Servlet中组件的初始化操作</span></span><br><span class="line">		<span class="keyword">synchronized</span> (<span class="built_in">this</span>.onRefreshMonitor) &#123;</span><br><span class="line">			onRefresh(wac);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">// 如果配置发布Web应用上下文到Servlet上下文</span></span><br><span class="line">	<span class="keyword">if</span> (<span class="built_in">this</span>.publishContext) &#123;</span><br><span class="line">		<span class="comment">// 同时把Web应用上下文添加到Servlet上下文属性中，以供整个Web应用使用</span></span><br><span class="line">		<span class="type">String</span> <span class="variable">attrName</span> <span class="operator">=</span> getServletContextAttributeName();</span><br><span class="line">		getServletContext().setAttribute(attrName, wac);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> wac;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<blockquote>
<p>以上便是初始化此Servlet对应的Web应用上下文的过程，在这个过程中执行了DispatcherServlet中使用到的组件初始化，因为一些初始化逻辑需要使用Web应用上下文获取组件，故需先执行此处逻辑</p>
</blockquote>
<h1 id="2-组件初始化过程"><a class="markdownIt-Anchor" href="#2-组件初始化过程"></a> 2 组件初始化过程</h1>
<h3 id="1-multipartresolver"><a class="markdownIt-Anchor" href="#1-multipartresolver"></a> 1 MultipartResolver</h3>
<blockquote>
<p>​		对于MultipartResolver，已知是通过初始化Web应用上下文获取、</p>
<p>​		MultipartResolver类型为StandardServletMultipartResolver，查找此类的所有使用，发现是在MultipartAutoConfiguration类中创建了此类的实例</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="comment">// 只要是基于Servlet的Web应用，就存在这三个类</span></span><br><span class="line"><span class="meta">@ConditionalOnClass(&#123;Servlet.class, StandardServletMultipartResolver.class, MultipartConfigElement.class&#125;)</span></span><br><span class="line"><span class="comment">// 在属性spring.servlet.multipart.enabled不为flase或不存在时候此配置生效</span></span><br><span class="line"><span class="meta">@ConditionalOnProperty(</span></span><br><span class="line"><span class="meta">    prefix = &quot;spring.servlet.multipart&quot;,</span></span><br><span class="line"><span class="meta">    name = &#123;&quot;enabled&quot;&#125;,</span></span><br><span class="line"><span class="meta">    matchIfMissing = true</span></span><br><span class="line"><span class="meta">)</span></span><br><span class="line">@当Web类型为Servlet的时候生效</span><br><span class="line"><span class="meta">@ConditionalOnWebApplication(</span></span><br><span class="line"><span class="meta">    type = Type.SERVLET</span></span><br><span class="line"><span class="meta">)</span></span><br><span class="line"><span class="meta">@EnableConfigurationProperties(&#123;MultipartProperties.class&#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MultipartAutoConfiguration</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> MultipartProperties multipartProperties;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">MultipartAutoConfiguration</span><span class="params">(MultipartProperties multipartProperties)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.multipartProperties = multipartProperties;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">  <span class="meta">@ConditionalOnMissingBean(&#123;MultipartConfigElement.class, CommonsMultipartResolver.class&#125;)</span></span><br><span class="line">    <span class="keyword">public</span> MultipartConfigElement <span class="title function_">multipartConfigElement</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.multipartProperties.createMultipartConfig();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean(</span></span><br><span class="line"><span class="meta">        name = &#123;&quot;multipartResolver&quot;&#125;</span></span><br><span class="line"><span class="meta">    )</span></span><br><span class="line">    <span class="meta">@ConditionalOnMissingBean(&#123;MultipartResolver.class&#125;)</span></span><br><span class="line">    <span class="keyword">public</span> StandardServletMultipartResolver <span class="title function_">multipartResolver</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// 创建实例</span></span><br><span class="line">        <span class="type">StandardServletMultipartResolver</span> <span class="variable">multipartResolver</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StandardServletMultipartResolver</span>();</span><br><span class="line">        <span class="comment">// 根据属性源spring.servlet.multipart.resolvelazily的值，设置multipartProperties中的Resolverlazily属性值，表示对多块请求是否执行懒解析，如果为懒解析则在用多块钱请求数据的时候才对请求进行解析</span></span><br><span class="line">        multipartResolver.setResolveLazily(<span class="built_in">this</span>.multipartProperties.isResolveLazily());</span><br><span class="line">        <span class="keyword">return</span> multipartResolver;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>总结：</strong></p>
<blockquote>
<p>​		MultipartAutoConfiguration本身是自动配置类，在该类中用@Bean的方式标记方法，返回值都会注册到当前应用上下文中，这就应用上下文该组件的来源了</p>
</blockquote>
<h3 id="2-localeresovler"><a class="markdownIt-Anchor" href="#2-localeresovler"></a> 2 LocaleResovler</h3>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">initLocaleResolver</span><span class="params">(ApplicationContext context)</span> &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">// 从上下文中获取</span></span><br><span class="line">        <span class="built_in">this</span>.localeResolver = (LocaleResolver)context.getBean(<span class="string">&quot;localeResolver&quot;</span>, LocaleResolver.class);</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">this</span>.logger.isTraceEnabled()) &#123;</span><br><span class="line">            <span class="built_in">this</span>.logger.trace(<span class="string">&quot;Detected &quot;</span> + <span class="built_in">this</span>.localeResolver);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="built_in">this</span>.logger.isDebugEnabled()) &#123;</span><br><span class="line">            <span class="built_in">this</span>.logger.debug(<span class="string">&quot;Detected &quot;</span> + <span class="built_in">this</span>.localeResolver.getClass().getSimpleName());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (NoSuchBeanDefinitionException var3) &#123;</span><br><span class="line">        <span class="comment">// 上下文中没有使用默认策略</span></span><br><span class="line">        <span class="built_in">this</span>.localeResolver = (LocaleResolver)<span class="built_in">this</span>.getDefaultStrategy(context, LocaleResolver.class);</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">this</span>.logger.isTraceEnabled()) &#123;</span><br><span class="line">            <span class="built_in">this</span>.logger.trace(<span class="string">&quot;No LocaleResolver &#x27;localeResolver&#x27;: using default [&quot;</span> + <span class="built_in">this</span>.localeResolver.getClass().getSimpleName() + <span class="string">&quot;]&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>​		获取默认组件的策略是通过加载jar包中的DispatcherServlet.properties属性文件，获取其中的key:value。key为组件的类型接口全限定名，value为默认的组件类型名，初始化策略为获取组件接口属性名对应的组件类型属性值，并通过反射，作为默认组件使用。其中DispatchServlet.properties文件内容如下</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Default implementation classes for DispatcherServlet&#x27;s strategy interfaces.</span></span><br><span class="line"><span class="comment"># Used as fallback when no matching beans are found in the DispatcherServlet context.</span></span><br><span class="line"><span class="comment"># Not meant to be customized by application developers.</span></span><br><span class="line"></span><br><span class="line"><span class="attr">org.springframework.web.servlet.LocaleResolver</span>=<span class="string">org.springframework.web.servlet.i18n.AcceptHeaderLocaleResolver</span></span><br><span class="line"></span><br><span class="line"><span class="attr">org.springframework.web.servlet.ThemeResolver</span>=<span class="string">org.springframework.web.servlet.theme.FixedThemeResolver</span></span><br><span class="line"></span><br><span class="line"><span class="attr">org.springframework.web.servlet.HandlerMapping</span>=<span class="string">org.springframework.web.servlet.handler.BeanNameUrlHandlerMapping,\</span></span><br><span class="line"><span class="string">	org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerMapping</span></span><br><span class="line"></span><br><span class="line"><span class="attr">org.springframework.web.servlet.HandlerAdapter</span>=<span class="string">org.springframework.web.servlet.mvc.HttpRequestHandlerAdapter,\</span></span><br><span class="line"><span class="string">	org.springframework.web.servlet.mvc.SimpleControllerHandlerAdapter,\</span></span><br><span class="line"><span class="string">	org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter</span></span><br><span class="line"></span><br><span class="line"><span class="attr">org.springframework.web.servlet.HandlerExceptionResolver</span>=<span class="string">org.springframework.web.servlet.mvc.method.annotation.ExceptionHandlerExceptionResolver,\</span></span><br><span class="line"><span class="string">	org.springframework.web.servlet.mvc.annotation.ResponseStatusExceptionResolver,\</span></span><br><span class="line"><span class="string">	org.springframework.web.servlet.mvc.support.DefaultHandlerExceptionResolver</span></span><br><span class="line"></span><br><span class="line"><span class="attr">org.springframework.web.servlet.RequestToViewNameTranslator</span>=<span class="string">org.springframework.web.servlet.view.DefaultRequestToViewNameTranslator</span></span><br><span class="line"></span><br><span class="line"><span class="attr">org.springframework.web.servlet.ViewResolver</span>=<span class="string">org.springframework.web.servlet.view.InternalResourceViewResolver</span></span><br><span class="line"></span><br><span class="line"><span class="attr">org.springframework.web.servlet.FlashMapManager</span>=<span class="string">org.springframework.web.servlet.support.SessionFlashMapManager</span></span><br></pre></td></tr></table></figure>
<p><strong>注意：</strong></p>
<blockquote>
<p>​		上面有些key配置了用逗号隔开的多个class类名，因为有些最贱是list类型，list类型通过方法getDefaultStrategies获取</p>
</blockquote>
<p>​		除此之外，在配置<code>spring.mvc.locale-resolver=FIXED</code>与<code>spring.mvc.locale-zh_CN</code>后，初始化LocaleResolver就不会通过默认策略进行初始化，而是直接通过应用上下文获取LocaleResolver类型的Bean，为FixedLocaleResolver。通过查找FixedLocaleResolver的构造器引用位置，找到了该Bean的定义位子在WebMvcAutoConfiguration自动配置类的WebMvcAutoConfigurationAdapter</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">        <span class="meta">@Bean</span></span><br><span class="line">        <span class="meta">@ConditionalOnMissingBean</span></span><br><span class="line"><span class="comment">// 只有配置了spring.mvc.locale属性的时候，该Bean才会被定义</span></span><br><span class="line">        <span class="meta">@ConditionalOnProperty(</span></span><br><span class="line"><span class="meta">            prefix = &quot;spring.mvc&quot;,</span></span><br><span class="line"><span class="meta">            name = &#123;&quot;locale&quot;&#125;</span></span><br><span class="line"><span class="meta">        )</span></span><br><span class="line">        <span class="keyword">public</span> LocaleResolver <span class="title function_">localeResolver</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="comment">// 通过MvcProperties封装spirng.mvc下的所有的配置</span></span><br><span class="line">           </span><br><span class="line">            <span class="keyword">if</span> (<span class="built_in">this</span>.mvcProperties.getLocaleResolver() == org.springframework.boot.autoconfigure.web.servlet.WebMvcProperties.LocaleResolver.FIXED) &#123;</span><br><span class="line">                <span class="comment">// 使用spring.mvc.locale配置的locale作为构成参数传入，即固定取此Locale</span></span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">FixedLocaleResolver</span>(<span class="built_in">this</span>.mvcProperties.getLocale());</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="comment">// 否则使用请求头Locale解析器</span></span><br><span class="line">                <span class="type">AcceptHeaderLocaleResolver</span> <span class="variable">localeResolver</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AcceptHeaderLocaleResolver</span>();</span><br><span class="line">                <span class="comment">// 并设置配置值为；localeResolver未解析到Locale时的默认值</span></span><br><span class="line">                localeResolver.setDefaultLocale(<span class="built_in">this</span>.mvcProperties.getLocale());</span><br><span class="line">                <span class="keyword">return</span> localeResolver;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>
<h3 id="3-themeresolver"><a class="markdownIt-Anchor" href="#3-themeresolver"></a> 3 ThemeResolver</h3>
<blockquote>
<p>​		主题解析器ThemeResolver的初始化逻辑通过方法initThemeResolver执行，该组件在默认情况下同LocaleResolver组件，在应用上下文中无此类型的Bean，最终通过执行降级的初始化方法获取该类型的默认实例</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">initThemeResolver</span><span class="params">(ApplicationContext context)</span> &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.themeResolver = (ThemeResolver)context.getBean(<span class="string">&quot;themeResolver&quot;</span>, ThemeResolver.class);</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">this</span>.logger.isTraceEnabled()) &#123;</span><br><span class="line">            <span class="built_in">this</span>.logger.trace(<span class="string">&quot;Detected &quot;</span> + <span class="built_in">this</span>.themeResolver);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="built_in">this</span>.logger.isDebugEnabled()) &#123;</span><br><span class="line">            <span class="built_in">this</span>.logger.debug(<span class="string">&quot;Detected &quot;</span> + <span class="built_in">this</span>.themeResolver.getClass().getSimpleName());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (NoSuchBeanDefinitionException var3) &#123;</span><br><span class="line">        <span class="built_in">this</span>.themeResolver = (ThemeResolver)<span class="built_in">this</span>.getDefaultStrategy(context, ThemeResolver.class);</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">this</span>.logger.isTraceEnabled()) &#123;</span><br><span class="line">            <span class="built_in">this</span>.logger.trace(<span class="string">&quot;No ThemeResolver &#x27;themeResolver&#x27;: using default [&quot;</span> + <span class="built_in">this</span>.themeResolver.getClass().getSimpleName() + <span class="string">&quot;]&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="4-handlermapping"><a class="markdownIt-Anchor" href="#4-handlermapping"></a> 4 HandlerMapping</h3>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 如果没定义HandlerMapping组件类型的Bean的时候。默认使用组件RequestMappingHandlerMapping BeanNameUrlHandlerMapping.</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">initHandlerMappings</span><span class="params">(ApplicationContext context)</span> &#123;</span><br><span class="line">		<span class="built_in">this</span>.handlerMappings = <span class="literal">null</span>;</span><br><span class="line"><span class="comment">// 是否查找当前BeanFactory与其所有父BeanFactory中HandlerMapping组件，默认为true</span></span><br><span class="line">		<span class="keyword">if</span> (<span class="built_in">this</span>.detectAllHandlerMappings) &#123;</span><br><span class="line">			<span class="comment">// Find all HandlerMappings in the ApplicationContext, including ancestor contexts.</span></span><br><span class="line">            <span class="comment">// 查找当前以及所有祖先BeanFactory中的HandlerMapping类型的Bean，返回Map类型，key为BeanName，value为Bean实例</span></span><br><span class="line">			Map&lt;String, HandlerMapping&gt; matchingBeans =</span><br><span class="line">					BeanFactoryUtils.beansOfTypeIncludingAncestors(context, HandlerMapping.class, <span class="literal">true</span>, <span class="literal">false</span>);</span><br><span class="line">			<span class="keyword">if</span> (!matchingBeans.isEmpty()) &#123;</span><br><span class="line">				<span class="built_in">this</span>.handlerMappings = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;(matchingBeans.values());</span><br><span class="line">				<span class="comment">// We keep HandlerMappings in sorted order.</span></span><br><span class="line">                <span class="comment">// 排序</span></span><br><span class="line">				AnnotationAwareOrderComparator.sort(<span class="built_in">this</span>.handlerMappings);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// 否则，只查找BeanName为handlerMapping的Bean作为唯一HandlerMapping组件使用</span></span><br><span class="line">			<span class="keyword">try</span> &#123;</span><br><span class="line">				<span class="type">HandlerMapping</span> <span class="variable">hm</span> <span class="operator">=</span> context.getBean(HANDLER_MAPPING_BEAN_NAME, HandlerMapping.class);</span><br><span class="line">				<span class="built_in">this</span>.handlerMappings = Collections.singletonList(hm);</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">catch</span> (NoSuchBeanDefinitionException ex) &#123;</span><br><span class="line">				<span class="comment">// Ignore, we&#x27;ll add a default HandlerMapping later.</span></span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="comment">// Ensure we have at least one HandlerMapping, by registering</span></span><br><span class="line">		<span class="comment">// a default HandlerMapping if no other mappings are found.</span></span><br><span class="line">        <span class="comment">// 当Bean策略查找不到的时候使用默认策略</span></span><br><span class="line">		<span class="keyword">if</span> (<span class="built_in">this</span>.handlerMappings == <span class="literal">null</span>) &#123;</span><br><span class="line">			<span class="built_in">this</span>.handlerMappings = getDefaultStrategies(context, HandlerMapping.class);</span><br><span class="line">			<span class="keyword">if</span> (logger.isTraceEnabled()) &#123;</span><br><span class="line">				logger.trace(<span class="string">&quot;No HandlerMappings declared for servlet &#x27;&quot;</span> + getServletName() +</span><br><span class="line">						<span class="string">&quot;&#x27;: using default strategies from DispatcherServlet.properties&quot;</span>);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>​		在默认情况下，会通过当前BeanFactory与其祖先BeanFactory中获取所有的HandlerMapping类型的Bean作为HandlerMapping组件列表使用。默认包括以下组件</p>
<table>
<thead>
<tr>
<th style="text-align:center">Bean的名称</th>
<th style="text-align:center">Bean的类型</th>
<th style="text-align:center">作用</th>
<th style="text-align:center">初始化位置</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">faviconHandlerMapping</td>
<td style="text-align:center">org.springframework.<br>web.servlet.handler.<br>SimpleUrlHandlerMapping</td>
<td style="text-align:center">简单URl映射，处理**/favicon.ico路径请求，返回网站小图标</td>
<td style="text-align:center">WebMvcAutoConfiguration.<br>WebMvcAutoConfigurationAdapter.<br>FaviconConfiguration.faviconHandlerMapping</td>
</tr>
<tr>
<td style="text-align:center">requestMappingHandlerMapping</td>
<td style="text-align:center">org.springframework<br>.web.servlet.mvc.<br>method.annotation.<br>RequestMappingHandlerMapping</td>
<td style="text-align:center">处理@RequestMapping注解注册的请求处理器</td>
<td style="text-align:center">WebMvcAutoConfiguration.<br>EnableWebMvcConfiguration.<br>requestMappingHandlerMapping</td>
</tr>
<tr>
<td style="text-align:center">beanNameHandlerMapping</td>
<td style="text-align:center">org.springframework.<br>web.servlet.handler.<br>BeanNameHandlerMapping</td>
<td style="text-align:center">用于通过URL映射到Bean的处理器</td>
<td style="text-align:center">EnableWebMvcConfiguration的祖先类<br>WebMVcConfigurationSupport.<br>beanNameHandlerMappinging()</td>
</tr>
<tr>
<td style="text-align:center">resourceHandlerMapping</td>
<td style="text-align:center">org.springframework.<br>web.servlet.handler.<br>SimpleUrlHandlerMapping</td>
<td style="text-align:center">用于处理静态资源映射</td>
<td style="text-align:center">EnableWebMvcConfiguration的祖先类<br>WebMVcConfigurationSupport.<br>resourceHandlerMapping()</td>
</tr>
<tr>
<td style="text-align:center">WelcomePageHandlerMapping</td>
<td style="text-align:center">org.springframework.<br>boot.autoconfigure.web.servlet<br>WelcomePageHandlerMapping</td>
<td style="text-align:center">用于处理默认首页请求跳转到index.html</td>
<td style="text-align:center">EnableWebMvcConfiguration的祖先类<br>WebMVcConfigurationSupport.<br>weclomePageHandlerMapping()</td>
</tr>
</tbody>
</table>
<blockquote>
<p>​		大部分组件Bean的初始化都在WebMvcAutoConfiguration类、EnableWebMvcConfiguration类及其父类WebMvcConfigurationSupport中</p>
<p>​		在WebMvcAutoConfiguration自动配置类中，又包含WebMVCAutoConfigurationAdapter配置类，在这个配置中，通过@Import注解引入EnableWebMvcConfiguration类作为配置类，使得EnableWebMvcConfiguration配置类称为Spring Mvc 所有相关组件定义的核心配置类，在该配置类中，包括全部Mvc需要使用到组件的初始化逻辑</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Configuration equivalent to &#123;<span class="doctag">@code</span> <span class="doctag">@EnableWebMvc</span>&#125;.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Configuration(proxyBeanMethods = false)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">EnableWebMvcConfiguration</span> <span class="keyword">extends</span> <span class="title class_">DelegatingWebMvcConfiguration</span> <span class="keyword">implements</span> <span class="title class_">ResourceLoaderAware</span> &#123;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">private</span> <span class="keyword">final</span> ResourceProperties resourceProperties;</span><br><span class="line">	<span class="comment">// 配置属性映射类</span></span><br><span class="line">   <span class="keyword">private</span> <span class="keyword">final</span> WebMvcProperties mvcProperties;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">private</span> <span class="keyword">final</span> ListableBeanFactory beanFactory;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">private</span> <span class="keyword">final</span> WebMvcRegistrations mvcRegistrations;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">private</span> ResourceLoader resourceLoader;</span><br><span class="line">	</span><br><span class="line"><span class="comment">//....省略其他方法</span></span><br><span class="line">   <span class="comment">// 声明为Primary，当过Bean类型获取Bean时，如果有多个Bean存在，则使用标记了@primary的Bean作为结果</span></span><br><span class="line">   <span class="meta">@Bean</span></span><br><span class="line">   <span class="meta">@Primary</span></span><br><span class="line">   <span class="meta">@Override</span></span><br><span class="line">   <span class="keyword">public</span> RequestMappingHandlerMapping <span class="title function_">requestMappingHandlerMapping</span><span class="params">(</span></span><br><span class="line"><span class="params">         <span class="meta">@Qualifier(&quot;mvcContentNegotiationManager&quot;)</span> ContentNegotiationManager contentNegotiationManager,</span></span><br><span class="line"><span class="params">         <span class="meta">@Qualifier(&quot;mvcConversionService&quot;)</span> FormattingConversionService conversionService,</span></span><br><span class="line"><span class="params">         <span class="meta">@Qualifier(&quot;mvcResourceUrlProvider&quot;)</span> ResourceUrlProvider resourceUrlProvider)</span> &#123;</span><br><span class="line">      <span class="comment">// Must be @Primary for MvcUriComponentsBuilder to work</span></span><br><span class="line">      <span class="comment">// 标记Primary后MvcUriComponetsBuilder才能正常工作，此部分内容读者可自行了解</span></span><br><span class="line">       <span class="comment">// 调用父类方法初始化RequestMappingHandlerMapping组件</span></span><br><span class="line">      <span class="keyword">return</span> <span class="built_in">super</span>.requestMappingHandlerMapping(contentNegotiationManager, conversionService,</span><br><span class="line">            resourceUrlProvider);</span><br><span class="line">   &#125;</span><br><span class="line">/</span><br><span class="line">   <span class="meta">@Bean</span></span><br><span class="line">   <span class="keyword">public</span> WelcomePageHandlerMapping <span class="title function_">welcomePageHandlerMapping</span><span class="params">(ApplicationContext applicationContext,</span></span><br><span class="line"><span class="params">         FormattingConversionService mvcConversionService, ResourceUrlProvider mvcResourceUrlProvider)</span> &#123;</span><br><span class="line">      <span class="type">WelcomePageHandlerMapping</span> <span class="variable">welcomePageHandlerMapping</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">WelcomePageHandlerMapping</span>(</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">TemplateAvailabilityProviders</span>(applicationContext), applicationContext, getWelcomePage(),</span><br><span class="line">            <span class="built_in">this</span>.mvcProperties.getStaticPathPattern());</span><br><span class="line">      welcomePageHandlerMapping.setInterceptors(getInterceptors(mvcConversionService, mvcResourceUrlProvider));</span><br><span class="line">      welcomePageHandlerMapping.setCorsConfigurations(getCorsConfigurations());</span><br><span class="line">      <span class="keyword">return</span> welcomePageHandlerMapping;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">private</span> Optional&lt;Resource&gt; <span class="title function_">getWelcomePage</span><span class="params">()</span> &#123;</span><br><span class="line">      String[] locations = getResourceLocations(<span class="built_in">this</span>.resourceProperties.getStaticLocations());</span><br><span class="line">      <span class="keyword">return</span> Arrays.stream(locations).map(<span class="built_in">this</span>::getIndexHtml).filter(<span class="built_in">this</span>::isReadable).findFirst();</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">private</span> Resource <span class="title function_">getIndexHtml</span><span class="params">(String location)</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="built_in">this</span>.resourceLoader.getResource(location + <span class="string">&quot;index.html&quot;</span>);</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">private</span> <span class="type">boolean</span> <span class="title function_">isReadable</span><span class="params">(Resource resource)</span> &#123;</span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">         <span class="keyword">return</span> resource.exists() &amp;&amp; (resource.getURL() != <span class="literal">null</span>);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">catch</span> (Exception ex) &#123;</span><br><span class="line">         <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">   <span class="meta">@Override</span></span><br><span class="line">   <span class="keyword">protected</span> RequestMappingHandlerMapping <span class="title function_">createRequestMappingHandlerMapping</span><span class="params">()</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (<span class="built_in">this</span>.mvcRegistrations != <span class="literal">null</span> &amp;&amp; <span class="built_in">this</span>.mvcRegistrations.getRequestMappingHandlerMapping() != <span class="literal">null</span>) &#123;</span><br><span class="line">         <span class="keyword">return</span> <span class="built_in">this</span>.mvcRegistrations.getRequestMappingHandlerMapping();</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> <span class="built_in">super</span>.createRequestMappingHandlerMapping();</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>​		以上代码可以看到并不是在本类中创建的RequestMappingHandlerMapping实例，而是在父类中创建的。其父类为DelegatingWebMvcConfiguration，该类中也没有此方法，所以requestmappingHandlerMapping最终调用的是，WebMvcConfigurationSupport中的方法。</p>
<p>​		DelegatingWebMvcConfiguration类的作用是为实现通过WebMvcConfigurer类型的Bean作为配置器List，并在父类WebMvcConfigurationSupport执行组件配置方式时，遍历这个list，逐一进行组件配置。</p>
<pre><code>  	WebMvcConfigurationSupport类的作用则是为Mvc组件定义与配置提供支持，所有组件Bean的定义都在这个类中，同时该类在定义组件前后会执行一些配置方法。Spring boot引入的配置类EnableWebMvcConfiguration作用仅仅是为了通过spring.nvc相关配置来定制其中一些组件的特性，就如上面代码中看到的RequestMappngHandlerAdapter的定义一样，这也是通过配置来定制组件特性的实现原理。
</code></pre>
<p>​		DelegatingWebMvcConfiguration实现了这些配置方法，通过其中保存的WebMvcConfigur配置器列表执行所有配置器的对应方法。</p>
</blockquote>
<h3 id="5-handleradapter"><a class="markdownIt-Anchor" href="#5-handleradapter"></a> 5 HandlerAdapter</h3>
<blockquote>
<p>​		HandlerAdapter组件是处理请求的核心组件，该组件为列表。其初始化逻辑与HandlerMapping初始化逻辑相同，当BeanFactory中无HandlerAdapter组件时，使用默认组件列表：HttpRequestHandlerAdapter、SimpleControllerHandlerAdapter、RequestMappingHandlerAdapter。在SpringBoot中，默认情况是通过BeanFactory获取组件列表</p>
</blockquote>
<table>
<thead>
<tr>
<th>Bean名称</th>
<th>Bean类型</th>
<th>作用</th>
<th>初始化配置</th>
</tr>
</thead>
<tbody>
<tr>
<td>requestMappingHandlerAdapter</td>
<td>RequestMappingHandlerAdapter</td>
<td>处理@RequestMapping标记注解生成的处理器</td>
<td>WebMVcConfigurationSupport.<br>reqeustMappingHandlerAdapter()</td>
</tr>
<tr>
<td>httpRequestHandlerAdapter</td>
<td>HttpRequestHandlerAdapter</td>
<td>处理HttpRequestHandler类型的处理器</td>
<td>WebMVcConfigurationSupport.<br>httpRequestHandlerAdapter()</td>
</tr>
<tr>
<td>simpleControlerHandlerAdapter</td>
<td>impleControlerHandlerAdapter</td>
<td>处理Controller类型的处理器</td>
<td>WebMVcConfigurationSupport.<br>simpleControlerHandlerAdapter()</td>
</tr>
</tbody>
</table>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> HttpRequestHandlerAdapter <span class="title function_">httpRequestHandlerAdapter</span><span class="params">()</span> &#123;</span><br><span class="line">   <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">HttpRequestHandlerAdapter</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> SimpleControllerHandlerAdapter <span class="title function_">simpleControllerHandlerAdapter</span><span class="params">()</span> &#123;</span><br><span class="line">   <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">SimpleControllerHandlerAdapter</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>WebConfigurationSupport仅仅是WebMvc配置支持类，本身并不是配置类，所以其内部定义@Bean标记的方法并不会产生Bean所以在实际环境中还需要创建一个配置类，继承该配置支持类，来实现该类作为配置类的目的。</p>
<p>在SpringMvc中，由配置类DelegatingWebMvcConfiguration中还添加了通过WebMvcConfigurer配置器组件配置WebMVc组件功能。在SpringBoot中，又通过EnableWebMvcConfiguration继承了DelegatingWebMvcConfiguration，从而实现更强大的通过配置文件定义的属性来配置组件功能。</p>
<h3 id="6-handlerexceptionresolver"><a class="markdownIt-Anchor" href="#6-handlerexceptionresolver"></a> 6 HandlerExceptionResolver</h3>
<blockquote>
<p>​		HandlerExceptionResolver组件为一个列表，其初始化逻辑与HandlerMapping初始化逻辑相同，默认组件列表为HandlerExceptionResolver、ResponseStatusExceptionResolver、DefaultHandlerExceptionResovler，在SpringBoot默认通过BeanFactory获取组件列表如下</p>
</blockquote>
<table>
<thead>
<tr>
<th>Bean的名称</th>
<th>Bean的类型</th>
<th>作用</th>
<th>初始化位置</th>
</tr>
</thead>
<tbody>
<tr>
<td>errorAttributes</td>
<td>DefaultErrorAttributes</td>
<td>用于发生异常时保存异常信息到请求属性中</td>
<td>ErrorMvcConfoguration.<br>errorAttributes()</td>
</tr>
<tr>
<td>handlerExceptionResolver</td>
<td>HandlerExceptionResolver-Composite</td>
<td>用于组合已有的处理器异常解析器组件</td>
<td>WebMvcconfigurationSupport.-handlerExceptionResolver</td>
</tr>
</tbody>
</table>
<blockquote>
<p>​		在handlerExceptionResolver这个HandlerExceptionResolverComposite组合组件中，还包含了三个处理器，改组件用于包装这三个处理器异常解析器，顺序执行其中三个HandlerExceptionResolver、ResponseStatusExceptionResovler、DefaultHandlerExceptionResolver，这三个组件都是在WebMvcConfigurationSupport.handlerExceptionResolver方法中初始化</p>
<p>​		在该方法中，调用了本类的configurationHandlerExceptionResolvers方法，配置处理器异常解析器。在实际运行时，该方法执行的实例在其子类WebMvcAutoConfiguration.EnableWebMvcConfiguration中定义，子类重写了该方法。</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">extendHandlerExceptionResolvers</span><span class="params">(List&lt;HandlerExceptionResolver&gt; exceptionResolvers)</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">super</span>.extendHandlerExceptionResolvers(exceptionResolvers);</span><br><span class="line">    <span class="comment">// 为异常添加记录</span></span><br><span class="line">    <span class="comment">//如果spring.mvc.log-resolved-exception为true,则为异常添加日志u记录</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">this</span>.mvcProperties.isLogResolvedException()) &#123;</span><br><span class="line">        <span class="keyword">for</span> (HandlerExceptionResolver resolver : exceptionResolvers) &#123;</span><br><span class="line">            <span class="keyword">if</span> (resolver <span class="keyword">instanceof</span> AbstractHandlerExceptionResolver) &#123;</span><br><span class="line">                ((AbstractHandlerExceptionResolver) resolver).setWarnLogCategory(resolver.getClass().getName());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> HandlerExceptionResolver <span class="title function_">handlerExceptionResolver</span><span class="params">(</span></span><br><span class="line"><span class="params">    <span class="meta">@Qualifier(&quot;mvcContentNegotiationManager&quot;)</span> ContentNegotiationManager contentNegotiationManager)</span> &#123;</span><br><span class="line">    </span><br><span class="line">    List&lt;HandlerExceptionResolver&gt; exceptionResolvers = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        <span class="comment">// 执行父类方法 ，其中的逻辑为执行所有WebMvcConfigur类型的Bean的configureHandlerExceptionResolvers方法，配置异常处理器，默认无此类型的Bean故不作处理器</span></span><br><span class="line">    configureHandlerExceptionResolvers(exceptionResolvers);</span><br><span class="line">    <span class="comment">// 默认情况主席那个默认异常处理逻辑</span></span><br><span class="line">    <span class="keyword">if</span> (exceptionResolvers.isEmpty()) &#123;</span><br><span class="line">        addDefaultHandlerExceptionResolvers(exceptionResolvers, contentNegotiationManager);</span><br><span class="line">    &#125;</span><br><span class="line">    extendHandlerExceptionResolvers(exceptionResolvers);</span><br><span class="line">    <span class="type">HandlerExceptionResolverComposite</span> <span class="variable">composite</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HandlerExceptionResolverComposite</span>();</span><br><span class="line">    composite.setOrder(<span class="number">0</span>);</span><br><span class="line">    composite.setExceptionResolvers(exceptionResolvers);</span><br><span class="line">    <span class="keyword">return</span> composite;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">protected</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title function_">addDefaultHandlerExceptionResolvers</span><span class="params">(List&lt;HandlerExceptionResolver&gt; exceptionResolvers,ContentNegotiationManager mvcContentNegotiationManager)</span> &#123;</span><br><span class="line"> <span class="comment">// 创建ExceptionHandlerExceptionResolver添加到异常处理器列表</span></span><br><span class="line">    <span class="type">ExceptionHandlerExceptionResolver</span> <span class="variable">exceptionHandlerResolver</span> <span class="operator">=</span> createExceptionHandlerExceptionResolver();</span><br><span class="line">    <span class="comment">// 配置异常处理器的内容协商器</span></span><br><span class="line">    exceptionHandlerResolver.setContentNegotiationManager(mvcContentNegotiationManager);</span><br><span class="line">    <span class="comment">// 设置异常处理器用到的消息转换器</span></span><br><span class="line">    exceptionHandlerResolver.setMessageConverters(getMessageConverters());</span><br><span class="line">    <span class="comment">// 设置异常处理器使用的参数有解析器</span></span><br><span class="line">    exceptionHandlerResolver.setCustomArgumentResolvers(getArgumentResolvers());</span><br><span class="line">    <span class="comment">// 设置异常解析器的返回值处理器</span></span><br><span class="line">    exceptionHandlerResolver.setCustomReturnValueHandlers(getReturnValueHandlers());</span><br><span class="line">    <span class="comment">// 如果在jackson2的库,则添加一个响应体增强其</span></span><br><span class="line">    <span class="keyword">if</span> (jackson2Present) &#123;</span><br><span class="line">        exceptionHandlerResolver.setResponseBodyAdvice(</span><br><span class="line">            Collections.singletonList(<span class="keyword">new</span> <span class="title class_">JsonViewResponseBodyAdvice</span>()));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 设置异常处理器的应用上下文</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">this</span>.applicationContext != <span class="literal">null</span>) &#123;</span><br><span class="line">        exceptionHandlerResolver.setApplicationContext(<span class="built_in">this</span>.applicationContext);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 执行异常处理器的初始化方法</span></span><br><span class="line">    exceptionHandlerResolver.afterPropertiesSet();</span><br><span class="line">    <span class="comment">// 添加异常处理器列表</span></span><br><span class="line">    exceptionResolvers.add(exceptionHandlerResolver);</span><br><span class="line"></span><br><span class="line">    <span class="type">ResponseStatusExceptionResolver</span> <span class="variable">responseStatusResolver</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ResponseStatusExceptionResolver</span>();</span><br><span class="line">    <span class="comment">//设置该异常解析器的信息源</span></span><br><span class="line">    responseStatusResolver.setMessageSource(<span class="built_in">this</span>.applicationContext);</span><br><span class="line">    <span class="comment">// 添加异常解析器列表</span></span><br><span class="line">    exceptionResolvers.add(responseStatusResolver);</span><br><span class="line"></span><br><span class="line">    exceptionResolvers.add(<span class="keyword">new</span> <span class="title class_">DefaultHandlerExceptionResolver</span>());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="7requesttoviewnametranslator"><a class="markdownIt-Anchor" href="#7requesttoviewnametranslator"></a> 7RequestToViewNameTranslator</h3>
<blockquote>
<p>​		RequestToViewNameTranslator组件又叫做ViewNameTranslator组件,该组件在DispatcherServlet中存在一个.其初始化策略与Locale组件相同,默认情况下BeanFactory中未提供该组件,使用默认策略指定的DefalutRequestToViewNameTranslator组件</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Initialize the RequestToViewNameTranslator used by this servlet instance.</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;If no implementation is configured then we default to DefaultRequestToViewNameTranslator.</span></span><br><span class="line"><span class="comment"> * Beanfactory中没有定义时,使用默认的</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">initRequestToViewNameTranslator</span><span class="params">(ApplicationContext context)</span> &#123;</span><br><span class="line">	<span class="keyword">try</span> &#123;</span><br><span class="line">           <span class="comment">// 默认无组件,触发NoSuchBeanDefinitionEception异常</span></span><br><span class="line">		<span class="built_in">this</span>.viewNameTranslator =</span><br><span class="line">				context.getBean(REQUEST_TO_VIEW_NAME_TRANSLATOR_BEAN_NAME, RequestToViewNameTranslator.class);</span><br><span class="line">		<span class="keyword">if</span> (logger.isTraceEnabled()) &#123;</span><br><span class="line">			logger.trace(<span class="string">&quot;Detected &quot;</span> + <span class="built_in">this</span>.viewNameTranslator.getClass().getSimpleName());</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span> <span class="keyword">if</span> (logger.isDebugEnabled()) &#123;</span><br><span class="line">			logger.debug(<span class="string">&quot;Detected &quot;</span> + <span class="built_in">this</span>.viewNameTranslator);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">catch</span> (NoSuchBeanDefinitionException ex) &#123;</span><br><span class="line">		<span class="comment">// We need to use the default.</span></span><br><span class="line">           <span class="comment">// 使用默认策略</span></span><br><span class="line">		<span class="built_in">this</span>.viewNameTranslator = getDefaultStrategy(context, RequestToViewNameTranslator.class);</span><br><span class="line">		<span class="keyword">if</span> (logger.isTraceEnabled()) &#123;</span><br><span class="line">			logger.trace(<span class="string">&quot;No RequestToViewNameTranslator &#x27;&quot;</span> + REQUEST_TO_VIEW_NAME_TRANSLATOR_BEAN_NAME +</span><br><span class="line">					<span class="string">&quot;&#x27;: using default [&quot;</span> + <span class="built_in">this</span>.viewNameTranslator.getClass().getSimpleName() + <span class="string">&quot;]&quot;</span>);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>​		该类型组件同样可以通过在ApplicationContext中定义来实现替换该类型的默认组件</p>
</blockquote>
<h3 id="8-viewresolver"><a class="markdownIt-Anchor" href="#8-viewresolver"></a> 8 ViewResolver</h3>
<blockquote>
<p>​		ViewResolver组件为组件列表,其初始化策略与HandlerMapping组件列表相同,在只加入Thymeleaf模板引擎的依赖时.默认BeanFactory中包含五个该组件.</p>
</blockquote>
<table>
<thead>
<tr>
<th>Bean的名称</th>
<th>Bean的类型</th>
<th>作用</th>
<th>初始化的位置</th>
</tr>
</thead>
<tbody>
<tr>
<td>beanNameViewResovler</td>
<td>BeanNameViewResovler</td>
<td>用于支持默认的Bean名称是哦图解析器</td>
<td>ErrorMvcAutoConfiguration.-whitelabelErrorViewConfiguration.-beanNameViewResolver</td>
</tr>
<tr>
<td>mvcViewResolver</td>
<td>ViewResovlerComposite</td>
<td>提供configure-ViewResolver方法添加VIewResolver的功能<br>也支持通过BeanFactory获取所有ViewResolver类型的Bean</td>
<td>EnableWebMvcConfiguration-的祖先类WebMvcConfigurationSupport.<br>mvcViewResolver</td>
</tr>
<tr>
<td>defaultViewResolver</td>
<td>InternalResource-ViewResolver</td>
<td>默认的视图解析器，用于解析html、jsp等内置的静态页面资源</td>
<td>WebMvcAutoConfiguration.-WebMvcAuto-ConfigurationAdapter.defaultViewResolver</td>
</tr>
<tr>
<td>viewResolver</td>
<td>ContentNegotiating-ViewResolver</td>
<td>内容协商视图解析器，用于支持根据请求接受内容类型与视图内容类型自动匹配视图功能</td>
<td>WebMvcAutoConfiguration.-WebMvcAuto-ConfigurationAdapter.ViewResolver(BeanFactory beanfactory)</td>
</tr>
<tr>
<td>thymeleafViewResolver</td>
<td>ThymeleafViewResolver</td>
<td>用于支持Thymeleaf类型的模板视图</td>
<td>ThymeleaAutoConfiguration.-ThymeleaWebMvcConfiguration.-ThymeleafViewResolverConfiguration.-thymeleafViewResolver</td>
</tr>
</tbody>
</table>
<blockquote>
<p>​		其中beanNameViewResolver在WebMvcAutoConfigurationAdapter.beanNameViewResolver（）也进行了初始化，但因ErrorMvcAutoConfiguration的执行顺序在前（通过@AutoConfigureBefore（WebMvcAutoConfiguration.class）指定顺序），故ErrorMvcAutoConfiguration中的beanNameViewResolver有限</p>
<p>​	另外，Thymeleaf模板视图是在引用Thymeleaf依赖后自动添加的，同此原理，其他类型模板的依赖引入后，也会自动添加对应类型的视图解析器。如freeMarkerViewResolve。关于ThymeLeaf的自动配置，依赖于ThymeleftAutoConfiguration自动配置类，在该自动配置类中判断ThymeLeaf依赖是否存在。存在是则创建ThymeLeaf对应的视图解析器。</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 指定配置类</span></span><br><span class="line"><span class="meta">@Configuration(proxyBeanMethods = false)</span></span><br><span class="line"><span class="comment">// 在servlet容器中使用</span></span><br><span class="line"><span class="meta">@ConditionalOnWebApplication(type = Type.SERVLET)</span></span><br><span class="line"><span class="comment">//当为true或者不存在的时候启用</span></span><br><span class="line"><span class="meta">@ConditionalOnProperty(name = &quot;spring.thymeleaf.enabled&quot;, matchIfMissing = true)</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">ThymeleafWebMvcConfiguration</span> &#123;</span><br><span class="line">	</span><br><span class="line">   <span class="meta">@Bean</span></span><br><span class="line">   <span class="meta">@ConditionalOnEnabledResourceChain</span></span><br><span class="line">   <span class="meta">@ConditionalOnMissingFilterBean(ResourceUrlEncodingFilter.class)</span></span><br><span class="line">   FilterRegistrationBean&lt;ResourceUrlEncodingFilter&gt; <span class="title function_">resourceUrlEncodingFilter</span><span class="params">()</span> &#123;</span><br><span class="line">      FilterRegistrationBean&lt;ResourceUrlEncodingFilter&gt; registration = <span class="keyword">new</span> <span class="title class_">FilterRegistrationBean</span>&lt;&gt;(</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">ResourceUrlEncodingFilter</span>());</span><br><span class="line">      registration.setDispatcherTypes(DispatcherType.REQUEST, DispatcherType.ERROR);</span><br><span class="line">      <span class="keyword">return</span> registration;</span><br><span class="line">   &#125;</span><br><span class="line"><span class="comment">// 声明ThymeLeaf的ViewResolver组件</span></span><br><span class="line">   <span class="meta">@Configuration(proxyBeanMethods = false)</span></span><br><span class="line">   <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">ThymeleafViewResolverConfiguration</span> &#123;</span><br><span class="line">		<span class="comment">// 声明ThymeLeaf的ViewResolver组件</span></span><br><span class="line">      <span class="meta">@Bean</span></span><br><span class="line">       <span class="comment">// 不存在thymeLeafViewResolver时创建</span></span><br><span class="line">      <span class="meta">@ConditionalOnMissingBean(name = &quot;thymeleafViewResolver&quot;)</span></span><br><span class="line">      ThymeleafViewResolver <span class="title function_">thymeleafViewResolver</span><span class="params">(ThymeleafProperties properties,</span></span><br><span class="line"><span class="params">            SpringTemplateEngine templateEngine)</span> &#123;</span><br><span class="line">          <span class="comment">// 构造</span></span><br><span class="line">         <span class="type">ThymeleafViewResolver</span> <span class="variable">resolver</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ThymeleafViewResolver</span>();</span><br><span class="line">          <span class="comment">// 设置模板引擎</span></span><br><span class="line">         resolver.setTemplateEngine(templateEngine);</span><br><span class="line">          <span class="comment">// 设置编码</span></span><br><span class="line">         resolver.setCharacterEncoding(properties.getEncoding().name());</span><br><span class="line">          <span class="comment">// 设置contenttype</span></span><br><span class="line">         resolver.setContentType(</span><br><span class="line">               appendCharset(properties.getServlet().getContentType(), resolver.getCharacterEncoding()));</span><br><span class="line">          <span class="comment">// </span></span><br><span class="line">         resolver.setProducePartialOutputWhileProcessing(</span><br><span class="line">               properties.getServlet().isProducePartialOutputWhileProcessing());</span><br><span class="line">          <span class="comment">// 设根据配置文件置需要排除的视图名</span></span><br><span class="line">         resolver.setExcludedViewNames(properties.getExcludedViewNames());</span><br><span class="line">          <span class="comment">//根据配置文件设置需要解析的视图名</span></span><br><span class="line">         resolver.setViewNames(properties.getViewNames());</span><br><span class="line">         <span class="comment">// This resolver acts as a fallback resolver (e.g. like a</span></span><br><span class="line">         <span class="comment">// InternalResourceViewResolver) so it needs to have low precedence</span></span><br><span class="line">          <span class="comment">// 指定顺序比最低的优先级高一个优先级，由InternalResourceViewResolver兜底</span></span><br><span class="line">         resolver.setOrder(Ordered.LOWEST_PRECEDENCE - <span class="number">5</span>);</span><br><span class="line">          <span class="comment">// 根据配置文件设置是否启用缓存</span></span><br><span class="line">         resolver.setCache(properties.isCache());</span><br><span class="line">         <span class="keyword">return</span> resolver;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">private</span> String <span class="title function_">appendCharset</span><span class="params">(MimeType type, String charset)</span> &#123;</span><br><span class="line">         <span class="keyword">if</span> (type.getCharset() != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> type.toString();</span><br><span class="line">         &#125;</span><br><span class="line">         LinkedHashMap&lt;String, String&gt; parameters = <span class="keyword">new</span> <span class="title class_">LinkedHashMap</span>&lt;&gt;();</span><br><span class="line">         parameters.put(<span class="string">&quot;charset&quot;</span>, charset);</span><br><span class="line">         parameters.putAll(type.getParameters());</span><br><span class="line">         <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">MimeType</span>(type, parameters).toString();</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="9-flashmapmannger组件"><a class="markdownIt-Anchor" href="#9-flashmapmannger组件"></a> 9 FlashMapMannger组件</h3>
<blockquote>
<p>​		在DispatcherServlet中只存在一个FalshMapManager组件.其初始化策略与LocaleResolver组件相同,默认情况下BeanFacotry中没有提供该组件,使用默认策略指定的SessionFlashMapManager组件</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">initFlashMapManager</span><span class="params">(ApplicationContext context)</span> &#123;</span><br><span class="line">   <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="built_in">this</span>.flashMapManager = context.getBean(FLASH_MAP_MANAGER_BEAN_NAME, FlashMapManager.class);</span><br><span class="line">      <span class="keyword">if</span> (logger.isTraceEnabled()) &#123;</span><br><span class="line">         logger.trace(<span class="string">&quot;Detected &quot;</span> + <span class="built_in">this</span>.flashMapManager.getClass().getSimpleName());</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">else</span> <span class="keyword">if</span> (logger.isDebugEnabled()) &#123;</span><br><span class="line">         logger.debug(<span class="string">&quot;Detected &quot;</span> + <span class="built_in">this</span>.flashMapManager);</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">catch</span> (NoSuchBeanDefinitionException ex) &#123;</span><br><span class="line">      <span class="comment">// We need to use the default.</span></span><br><span class="line">       <span class="comment">// 默认使用SessionFlashMapManage</span></span><br><span class="line">      <span class="built_in">this</span>.flashMapManager = getDefaultStrategy(context, FlashMapManager.class);</span><br><span class="line">      <span class="keyword">if</span> (logger.isTraceEnabled()) &#123;</span><br><span class="line">         logger.trace(<span class="string">&quot;No FlashMapManager &#x27;&quot;</span> + FLASH_MAP_MANAGER_BEAN_NAME +</span><br><span class="line">               <span class="string">&quot;&#x27;: using default [&quot;</span> + <span class="built_in">this</span>.flashMapManager.getClass().getSimpleName() + <span class="string">&quot;]&quot;</span>);</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>​		通过初始化代码可知,该类型组件可以在Application中重新定义,但该组件类型较为复杂</p>
</blockquote>
<h3 id="10-webasyncmanager组件"><a class="markdownIt-Anchor" href="#10-webasyncmanager组件"></a> 10 WebAsyncManager组件</h3>
<blockquote>
<p>​		WebAsyncManager组件并不属于DispatcherServlet中的组件,但其也是处理过程中非常重要的组件,该组件的获取是通过方法WebAsyncUtils.getAsyncManage实现</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 根据请求获取该请求对应的异步管理器</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> WebAsyncManager <span class="title function_">getAsyncManager</span><span class="params">(ServletRequest servletRequest)</span> &#123;</span><br><span class="line">    <span class="type">WebAsyncManager</span> <span class="variable">asyncManager</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">    <span class="comment">// 在当前请求属性中尝试获取</span></span><br><span class="line">    <span class="type">Object</span> <span class="variable">asyncManagerAttr</span> <span class="operator">=</span> servletRequest.getAttribute(WEB_ASYNC_MANAGER_ATTRIBUTE);</span><br><span class="line">    <span class="keyword">if</span> (asyncManagerAttr <span class="keyword">instanceof</span> WebAsyncManager) &#123;</span><br><span class="line">        asyncManager = (WebAsyncManager) asyncManagerAttr;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//不存在创建，并添加到属性当中</span></span><br><span class="line">    <span class="keyword">if</span> (asyncManager == <span class="literal">null</span>) &#123;</span><br><span class="line">        asyncManager = <span class="keyword">new</span> <span class="title class_">WebAsyncManager</span>();</span><br><span class="line">        servletRequest.setAttribute(WEB_ASYNC_MANAGER_ATTRIBUTE, asyncManager);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> asyncManager;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>​		在配置文件中，可以通过spring.mvc.async.request.request-timeout指定异步请求超时，同时也可以通过WebMvcConfigurer接口实现类Bean的configureAsyncSupport方法配置更多的属性。</p>
<p>​		已知MvcProperties为spring.mvc下所有配置属性的表现类，那其中也必然有spring.mvc.async.request-timeout的绑定属性，为MvcProperties.async.requestTimeout，通过查找该属性的使用位置，找到了使用该值进行配置的逻辑，即在WebMvcAutoConfiguration.WebMvcAutoConfigurationAdapter的configureAsyncSupport方法中。<br>
​		可以看到WebMvcAutoConfigurationAdapter正是WebMvcConfigurer配置器接口实现类，即改配置其实是通过配置接口的实现类Bean实现的，</p>
<p>​		那么配置器是如何生效的呢，在RequestMapping组件初始化中，已经讲述过EnableWebMVCConfiguration与其父类DelegatingWebMvcConfiguration及再上一级的父类WebMvcConfigurationSupport的大致作用，可以就以Async的配置为例，简述其代码的实现原理。一样通过反查法的方式推断。</p>
<p>​		通过查找WebMvcConfigurer.configureAsyncSupport方法的调用，可以找到两处。第一处是DelegatingWebMvcConfiguration的configureAsyncSupport方法，第二处是WebMvcConfigurerComposite的configureAsyncSupport方法，第一次调用的就是第二次的方法。</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DelegatingWebMvcConfiguration</span> <span class="keyword">extends</span> <span class="title class_">WebMvcConfigurationSupport</span> &#123;</span><br><span class="line"><span class="comment">// 创建WebMvc配置类组合类，用于组合全部配置器实例</span></span><br><span class="line">   <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">WebMvcConfigurerComposite</span> <span class="variable">configurers</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">WebMvcConfigurerComposite</span>();</span><br><span class="line">    </span><br><span class="line">      <span class="comment">// 自定注入当前应用上下文所有MVC配置类</span></span><br><span class="line">    <span class="meta">@Autowired(required = false)</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setConfigurers</span><span class="params">(List&lt;WebMvcConfigurer&gt; configurers)</span> &#123;</span><br><span class="line">		<span class="keyword">if</span> (!CollectionUtils.isEmpty(configurers)) &#123;</span><br><span class="line">			<span class="built_in">this</span>.configurers.addWebMvcConfigurers(configurers);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">    、</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">	<span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">configureAsyncSupport</span><span class="params">(AsyncSupportConfigurer configurer)</span> &#123;</span><br><span class="line">		<span class="comment">// 配置时，调用配置类组合器的配置方法</span></span><br><span class="line">        <span class="built_in">this</span>.configurers.configureAsyncSupport(configurer);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//配置器组合器，同样实现配置器接口</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">WebMvcConfigurerComposite</span> <span class="keyword">implements</span> <span class="title class_">WebMvcConfigurer</span> &#123;</span><br><span class="line">	<span class="comment">// 全部配置类Bean实例列表，名字叫做delegates代理，即代理Bean的调用</span></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">final</span> List&lt;WebMvcConfigurer&gt; delegates = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//添加需要代理执行的配置类</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addWebMvcConfigurers</span><span class="params">(List&lt;WebMvcConfigurer&gt; configurers)</span> &#123;</span><br><span class="line">		<span class="keyword">if</span> (!CollectionUtils.isEmpty(configurers)) &#123;</span><br><span class="line">			<span class="built_in">this</span>.delegates.addAll(configurers);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 代理执行配置方法</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">configureAsyncSupport</span><span class="params">(AsyncSupportConfigurer configurer)</span> &#123;</span><br><span class="line">		<span class="keyword">for</span> (WebMvcConfigurer delegate : <span class="built_in">this</span>.delegates) &#123;</span><br><span class="line">			delegate.configureAsyncSupport(configurer);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>​		可以看到配置器组合类的目的是代理多个配置器的配置方法调用，所以该方法的真实调用其实是DelegatingWebMvcConfigureration的ConfigureAsyncSupport</p>
<p>方法，该方法重写了父类WebMvcConfigureationSupport方法</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> RequestMappingHandlerAdapter <span class="title function_">requestMappingHandlerAdapter</span><span class="params">(</span></span><br><span class="line"><span class="params">      <span class="meta">@Qualifier(&quot;mvcContentNegotiationManager&quot;)</span> ContentNegotiationManager contentNegotiationManager,</span></span><br><span class="line"><span class="params">      <span class="meta">@Qualifier(&quot;mvcConversionService&quot;)</span> FormattingConversionService conversionService,</span></span><br><span class="line"><span class="params">      <span class="meta">@Qualifier(&quot;mvcValidator&quot;)</span> Validator validator)</span> &#123;</span><br><span class="line"><span class="comment">//...省略</span></span><br><span class="line">    <span class="comment">// 创建Async配置支持</span></span><br><span class="line">   <span class="type">AsyncSupportConfigurer</span> <span class="variable">configurer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AsyncSupportConfigurer</span>();</span><br><span class="line">    <span class="comment">//调用 Async配置方法，子类重写该方法实现通过WevMvcConfigurer配置Async的目的</span></span><br><span class="line">   configureAsyncSupport(configurer);</span><br><span class="line">    <span class="comment">// 配置完成之后获取Async相关配置与组件并设置到RequestMappingHandlerAdapter组件中</span></span><br><span class="line">   <span class="keyword">if</span> (configurer.getTaskExecutor() != <span class="literal">null</span>) &#123;</span><br><span class="line">      adapter.setTaskExecutor(configurer.getTaskExecutor());</span><br><span class="line">   &#125;</span><br><span class="line">    /</span><br><span class="line">   <span class="keyword">if</span> (configurer.getTimeout() != <span class="literal">null</span>) &#123;</span><br><span class="line">      adapter.setAsyncRequestTimeout(configurer.getTimeout());</span><br><span class="line">   &#125;</span><br><span class="line">   adapter.setCallableInterceptors(configurer.getCallableInterceptors());</span><br><span class="line">   adapter.setDeferredResultInterceptors(configurer.getDeferredResultInterceptors());</span><br><span class="line"></span><br><span class="line">   <span class="keyword">return</span> adapter;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="11-themesource-主题源"><a class="markdownIt-Anchor" href="#11-themesource-主题源"></a> 11  ThemeSource 主题源</h3>
<blockquote>
<p>​		主题源也不是DispatchServlet原始组件的一部分，其在DispatcherServlet的doService方法中设置到请求属性中，通过DispatcherServlet的getThemeSource方法获取了主题源。在默认情况，获取到的主题源是Web应用上下文自身，因为默认Web应用上下文实现类ThemeSource接口。</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//获取主题源</span></span><br><span class="line"><span class="meta">@Nullable</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> ThemeSource <span class="title function_">getThemeSource</span><span class="params">()</span> &#123;</span><br><span class="line">   <span class="keyword">return</span> (getWebApplicationContext() <span class="keyword">instanceof</span> ThemeSource ? (ThemeSource) getWebApplicationContext() : <span class="literal">null</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<blockquote>
<p>​		而在Web应用上下文中，其实现的ThemeSource接口的getTheme方法其实是个代理方法，真正执行的是当前Web应用上下文实例中保存的ThemeSource主题源实例。</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 代理方法</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="meta">@Nullable</span></span><br><span class="line"><span class="keyword">public</span> Theme <span class="title function_">getTheme</span><span class="params">(String themeName)</span> &#123;</span><br><span class="line">   Assert.state(<span class="built_in">this</span>.themeSource != <span class="literal">null</span>, <span class="string">&quot;No ThemeSource available&quot;</span>);</span><br><span class="line">    <span class="comment">// 实际执行本类主题源实例的该方法</span></span><br><span class="line">   <span class="keyword">return</span> <span class="built_in">this</span>.themeSource.getTheme(themeName);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>​		那么上面代码中主题源实例何时初始化的呢？通过查找其引用，找到了设置值的位置为GenericWebApplicationContext上下文类的onRefresh方法，通过UiApplicationContextUtils的initThemeSource方法进行初始化</p>
<p>​		在initThemeSource方法中，则尝试先从BeanFactory中或其父BeanFactory中获取名称为themesource，类型为ThemeSource的bean作为主题源。</p>
</blockquote>
<h3 id="12-messagesource信息源"><a class="markdownIt-Anchor" href="#12-messagesource信息源"></a> 12 MessageSource信息源</h3>
<h3 id="13-springboot-配置类简单解析"><a class="markdownIt-Anchor" href="#13-springboot-配置类简单解析"></a> 13 SpringBoot 配置类简单解析</h3>
<p><img src= "/img/loading.gif" data-lazy-src="/2020/11/29/Spring-MVC-%E7%9B%B8%E5%85%B3%E7%BB%84%E4%BB%B6%E4%BB%A5%E5%8F%8A%E7%BB%84%E4%BB%B6%E5%88%9D%E5%A7%8B%E5%8C%96/image-20201206164605785.png" alt="image-20201206164605785"></p>
<ul>
<li><code>WebMvcConfigurer</code></li>
</ul>
<blockquote>
<p>暂时理解为WebMvc的配置扩展类</p>
</blockquote>
<ul>
<li><code>WebMvcConfigurerComposite</code></li>
</ul>
<blockquote>
<p>WebMvcConfigurer的组合器</p>
</blockquote>
<ul>
<li><code>WebMvcConfigurerSupport</code></li>
</ul>
<blockquote>
<p>为Mvc组件的定义与组件配置提供支持，所有的Bean的定义都在这个组类中，同时该类在定义前后会执行一些配置方法。SpringBoot引入配置类<code>EnableWebMvcConfiguration</code>的作用仅仅是为了通过spring.mvc相关配置来定制其中的一些组件的特性</p>
</blockquote>
<ul>
<li><code>DelegatingWebMvcConfiguration</code></li>
</ul>
<blockquote>
<p>为实现通过WebMvcConfigurer接口实现类Bean进行Mvc配置的目的。其中注入当前上下文中全部WebMvcConfigurer类型的Bean作为配置器List，并在父类WebMvcConfigurationSupport执行组件配置方式时，遍历这个配置器list，实现逐一配置。实现类内部@Bean定义组件的目的，同时DelegatingWebMvcconfiguration中还添加了通过WebMvcConfigurer配置器组件配置WebMvc组件功能</p>
</blockquote>
<ul>
<li><code>WebMvcAutoConfigurer</code></li>
</ul>
<blockquote>
<p>在此类中包含<code>WebMvcAutoConfigurationAdapter</code>类</p>
</blockquote>
<ul>
<li><code>EnableWebMvcConfiguration</code></li>
</ul>
<blockquote>
<p>为了通过spring.mvc相关配置来定制其中的一些组件的特性，并且包含全部的MVC需要使用到组件初始化逻辑</p>
</blockquote>
<ul>
<li><code>WebMvcAutoConfigurationAdapter</code></li>
</ul>
<blockquote>
<p>引入了EnableWebMvcConfigureation类作为配置类，在该配置类中包含全部的MVC需要使用到组件初始化逻辑，并且配置一部分MvcProperties属性</p>
</blockquote>
<p><strong>总结：</strong></p>
<blockquote>
<p>Spring Mvc 组件配置核心就是在SpringBoot中为WebMvcAutoconfiguration自动配置类，其中根据提供的配置属性定制、创建一些MVC中的组件。同时还提供了WebMvcAutoConfigurationAdapter，该类为WEbMvcConfigurer配置器的实现类，其中的配置方法里又根据配置文件中提供的配置属性定制了MVC组件特性，又提供了EnableWebMvcConfiguration这个核心的MVC配置类，内部提供了MVC全部组件的注册与配置逻辑，用于实现无法通过WebMvcConfigurer达到配置的功能。</p>
</blockquote>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">Curiosity</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://lijinzedev.github.io/2020/11/29/Spring-MVC-%E7%9B%B8%E5%85%B3%E7%BB%84%E4%BB%B6%E4%BB%A5%E5%8F%8A%E7%BB%84%E4%BB%B6%E5%88%9D%E5%A7%8B%E5%8C%96/">https://lijinzedev.github.io/2020/11/29/Spring-MVC-%E7%9B%B8%E5%85%B3%E7%BB%84%E4%BB%B6%E4%BB%A5%E5%8F%8A%E7%BB%84%E4%BB%B6%E5%88%9D%E5%A7%8B%E5%8C%96/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://lijinzedev.github.io" target="_blank">Curiosity的博客</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E6%BA%90%E7%A0%81/">源码</a></div><div class="post_share"><div class="social-share" data-image="https://user-images.githubusercontent.com/41108332/105622748-e2c5b580-5e4e-11eb-95c9-b22cdfdd632b.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2020/11/29/CentOS%E5%B8%B8%E7%94%A8Linux%E5%91%BD%E4%BB%A4/"><img class="prev-cover" data-lazy-src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">后端常用Linux命令</div></div></a></div><div class="next-post pull-right"><a href="/2020/11/19/DispatcherServlet%E8%AF%A6%E8%A7%A3/"><img class="next-cover" data-lazy-src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">DispatcherServlet详解</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span> 相关推荐</span></div><div class="relatedPosts-list"><div><a href="/2020/12/09/Mybatis源码学习/" title="Mybatis源码学习"><img class="cover" data-lazy-src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2020-12-09</div><div class="title">Mybatis源码学习</div></div></a></div><div><a href="/2020/12/06/Spring-MVC多块请求解析器/" title="Spring MVC多块请求解析器"><img class="cover" data-lazy-src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2020-12-06</div><div class="title">Spring MVC多块请求解析器</div></div></a></div><div><a href="/2020/11/19/DispatcherServlet详解/" title="DispatcherServlet详解"><img class="cover" data-lazy-src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2020-11-19</div><div class="title">DispatcherServlet详解</div></div></a></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="card-info-avatar is-center"><img class="avatar-img" data-lazy-src="https://user-images.githubusercontent.com/41108332/105622748-e2c5b580-5e4e-11eb-95c9-b22cdfdd632b.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/><div class="author-info__name">Curiosity</div><div class="author-info__description">SpringBoot | Mybatis | Java | Mysql</div></div><div class="card-info-data"><div class="card-info-data-item is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">155</div></a></div><div class="card-info-data-item is-center"><a href="/tags/"><div class="headline">标签</div><div class="length-num">83</div></a></div><div class="card-info-data-item is-center"><a href="/categories/"><div class="headline">分类</div><div class="length-num">112</div></a></div></div><a class="button--animated" id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/lijinzedev"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/lijinzedev" target="_blank" title="Github"><i class="fab fa-github"></i></a><a class="social-icon" href="mailto:2533755010@gmail.com" target="_blank" title="Email"><i class="fas fa-envelope"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn card-announcement-animation"></i><span>公告</span></div><div class="announcement_content">万般皆下品,唯有读书高</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#1-%E7%9B%B8%E5%85%B3%E7%BB%84%E4%BB%B6%E5%8F%8A%E5%85%B6%E5%88%9D%E5%A7%8B%E5%8C%96"><span class="toc-number">1.</span> <span class="toc-text"> 1 相关组件及其初始化</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-%E7%9B%B8%E5%85%B3%E7%BB%84%E4%BB%B6%E5%88%97%E8%A1%A8"><span class="toc-number">1.1.</span> <span class="toc-text"> 1 相关组件列表</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-%E7%BB%84%E4%BB%B6%E5%88%9D%E5%A7%8B%E5%8C%96"><span class="toc-number">1.2.</span> <span class="toc-text"> 2 组件初始化</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#2-%E7%BB%84%E4%BB%B6%E5%88%9D%E5%A7%8B%E5%8C%96%E8%BF%87%E7%A8%8B"><span class="toc-number">2.</span> <span class="toc-text"> 2 组件初始化过程</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-multipartresolver"><span class="toc-number">2.0.1.</span> <span class="toc-text"> 1 MultipartResolver</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-localeresovler"><span class="toc-number">2.0.2.</span> <span class="toc-text"> 2 LocaleResovler</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-themeresolver"><span class="toc-number">2.0.3.</span> <span class="toc-text"> 3 ThemeResolver</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-handlermapping"><span class="toc-number">2.0.4.</span> <span class="toc-text"> 4 HandlerMapping</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-handleradapter"><span class="toc-number">2.0.5.</span> <span class="toc-text"> 5 HandlerAdapter</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-handlerexceptionresolver"><span class="toc-number">2.0.6.</span> <span class="toc-text"> 6 HandlerExceptionResolver</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7requesttoviewnametranslator"><span class="toc-number">2.0.7.</span> <span class="toc-text"> 7RequestToViewNameTranslator</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-viewresolver"><span class="toc-number">2.0.8.</span> <span class="toc-text"> 8 ViewResolver</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9-flashmapmannger%E7%BB%84%E4%BB%B6"><span class="toc-number">2.0.9.</span> <span class="toc-text"> 9 FlashMapMannger组件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#10-webasyncmanager%E7%BB%84%E4%BB%B6"><span class="toc-number">2.0.10.</span> <span class="toc-text"> 10 WebAsyncManager组件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#11-themesource-%E4%B8%BB%E9%A2%98%E6%BA%90"><span class="toc-number">2.0.11.</span> <span class="toc-text"> 11  ThemeSource 主题源</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#12-messagesource%E4%BF%A1%E6%81%AF%E6%BA%90"><span class="toc-number">2.0.12.</span> <span class="toc-text"> 12 MessageSource信息源</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#13-springboot-%E9%85%8D%E7%BD%AE%E7%B1%BB%E7%AE%80%E5%8D%95%E8%A7%A3%E6%9E%90"><span class="toc-number">2.0.13.</span> <span class="toc-text"> 13 SpringBoot 配置类简单解析</span></a></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2024/07/19/%E5%BC%80%E5%9C%BA/" title="无题"><img data-lazy-src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="无题"/></a><div class="content"><a class="title" href="/2024/07/19/%E5%BC%80%E5%9C%BA/" title="无题">无题</a><time datetime="2024-07-19T06:03:08.609Z" title="发表于 2024-07-19 06:03:08">2024-07-19</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/07/18/git-%E6%81%A2%E5%A4%8D%E6%96%87%E4%BB%B6%E8%84%9A%E6%9C%AC/" title="git 恢复文件脚本">git 恢复文件脚本</a><time datetime="2024-07-18T17:43:13.000Z" title="发表于 2024-07-18 17:43:13">2024-07-18</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/05/13/centos7-%E5%AE%89%E8%A3%85datahub/" title="centos7 安装datahub">centos7 安装datahub</a><time datetime="2024-05-13T13:49:07.000Z" title="发表于 2024-05-13 13:49:07">2024-05-13</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/04/22/windows-Java%E5%A4%9A%E7%89%88%E6%9C%AC%E5%88%87%E6%8D%A2/" title="windows Java多版本切换">windows Java多版本切换</a><time datetime="2024-04-22T10:37:48.000Z" title="发表于 2024-04-22 10:37:48">2024-04-22</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/04/05/Ubuntu%E8%BD%AF%E4%BB%B6%E6%BA%90/" title="Ubuntu软件源">Ubuntu软件源</a><time datetime="2024-04-05T23:33:57.000Z" title="发表于 2024-04-05 23:33:57">2024-04-05</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2024 By Curiosity</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><div class="search-dialog__title" id="local-search-title">本地搜索</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div></div><hr/><div id="local-search-results"></div><span class="search-close-button"><i class="fas fa-times"></i></span></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/medium-zoom/dist/medium-zoom.min.js"></script><script src="https://cdn.jsdelivr.net/npm/vanilla-lazyload/dist/lazyload.iife.min.js"></script><script src="/js/search/local-search.js"></script><div class="js-pjax"></div><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>